<!DOCTYPE html> <html style lang=en-us><!--
 Page saved with SingleFile 
 url: https://corymollet.com/posts/github-release-ansible-task/ 
 saved date: Mon Jul 17 2023 00:53:09 GMT-0700 (Pacific Daylight Time)
--><meta charset=utf-8>
<meta name=viewport content="width=device-width, initial-scale=1.0">
<meta http-equiv=X-UA-Compatible content="ie=edge">
<meta itemprop=name content="Cory's Corner">
<meta itemprop=description content>
<style>/*! normalize.css v8.0.0 | MIT License | github.com/necolas/normalize.css */html{-webkit-text-size-adjust:100%}body{margin:0}h1{font-size:2em;margin:0.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}a{background-color:transparent}code{font-size:1em}small{font-size:80%}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}/*!
 * animate.css -https://daneden.github.io/animate.css/
 * Version - 3.7.0
 * Licensed under the MIT license - http://opensource.org/licenses/MIT
 *
 * Copyright (c) 2018 Daniel Eden
 */@-webkit-keyframes bounceInRight{0%,60%,75%,90%,to{-webkit-animation-timing-function:cubic-bezier(0.215,0.61,0.355,1);animation-timing-function:cubic-bezier(0.215,0.61,0.355,1)}0%{opacity:0;-webkit-transform:translate3d(3000px,0,0);transform:translate3d(3000px,0,0)}60%{opacity:1;-webkit-transform:translate3d(-25px,0,0);transform:translate3d(-25px,0,0)}75%{-webkit-transform:translate3d(10px,0,0);transform:translate3d(10px,0,0)}90%{-webkit-transform:translate3d(-5px,0,0);transform:translate3d(-5px,0,0)}to{-webkit-transform:translateZ(0);transform:translateZ(0)}}@keyframes bounceInRight{0%,60%,75%,90%,to{-webkit-animation-timing-function:cubic-bezier(0.215,0.61,0.355,1);animation-timing-function:cubic-bezier(0.215,0.61,0.355,1)}0%{opacity:0;-webkit-transform:translate3d(3000px,0,0);transform:translate3d(3000px,0,0)}60%{opacity:1;-webkit-transform:translate3d(-25px,0,0);transform:translate3d(-25px,0,0)}75%{-webkit-transform:translate3d(10px,0,0);transform:translate3d(10px,0,0)}90%{-webkit-transform:translate3d(-5px,0,0);transform:translate3d(-5px,0,0)}to{-webkit-transform:translateZ(0);transform:translateZ(0)}}@-webkit-keyframes bounceOutRight{20%{opacity:1;-webkit-transform:translate3d(-20px,0,0);transform:translate3d(-20px,0,0)}to{opacity:0;-webkit-transform:translate3d(2000px,0,0);transform:translate3d(2000px,0,0)}}@keyframes bounceOutRight{20%{opacity:1;-webkit-transform:translate3d(-20px,0,0);transform:translate3d(-20px,0,0)}to{opacity:0;-webkit-transform:translate3d(2000px,0,0);transform:translate3d(2000px,0,0)}}@-webkit-keyframes fadeIn{0%{opacity:0}to{opacity:1}}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}.fadeIn{-webkit-animation-name:fadeIn;animation-name:fadeIn}@-webkit-keyframes slideInUp{0%{-webkit-transform:translate3d(0,100%,0);transform:translate3d(0,100%,0);visibility:visible}to{-webkit-transform:translateZ(0);transform:translateZ(0)}}@keyframes slideInUp{0%{-webkit-transform:translate3d(0,100%,0);transform:translate3d(0,100%,0);visibility:visible}to{-webkit-transform:translateZ(0);transform:translateZ(0)}}@-webkit-keyframes slideOutDown{0%{-webkit-transform:translateZ(0);transform:translateZ(0)}to{visibility:hidden;-webkit-transform:translate3d(0,100%,0);transform:translate3d(0,100%,0)}}@keyframes slideOutDown{0%{-webkit-transform:translateZ(0);transform:translateZ(0)}to{visibility:hidden;-webkit-transform:translate3d(0,100%,0);transform:translate3d(0,100%,0)}}.animated{-webkit-animation-duration:1s;-webkit-animation-fill-mode:both;animation-fill-mode:both}.animated.faster{-webkit-animation-duration:.5s;animation-duration:.5s}@media (prefers-reduced-motion){.animated{-webkit-animation:unset!important;animation:unset!important;-webkit-transition:none!important;transition:none!important}}.gg-clipboard{box-sizing:border-box;position:relative;display:block;transform:scale(var(--ggs,1));width:18px;height:18px;border:2px solid;border-radius:2px}.gg-clipboard::after,.gg-clipboard::before{content:"";display:block;box-sizing:border-box;position:absolute;border-radius:2px;width:10px;left:2px}.gg-clipboard::before{border:2px solid;border-bottom-left-radius:3px;border-bottom-right-radius:3px;top:-2px;height:6px}.gg-clipboard::after{height:2px;background:currentColor;box-shadow:0-4px 0 0;bottom:2px}::-webkit-scrollbar{width:8px;height:8px;background:#31333d}::-webkit-scrollbar-thumb{background:#888}html{background:#494f5c;line-height:1.6;letter-spacing:0.06em}body{color:#c6cddb;font-family:"Trebuchet MS",Verdana,"Verdana Ref","Segoe UI",Candara,"Lucida Grande","Lucida Sans Unicode","Lucida Sans",Tahoma,sans-serif}pre,code{font-family:Consolas,"Andale Mono WT","Andale Mono",Menlo,Monaco,"Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L","Courier New",Courier,"YaHei Consolas Hybrid",monospace,"Segoe UI Emoji","PingFang SC","Microsoft YaHei"}pre{max-height:40em;padding:0.7em 1.1em;overflow:auto;font-size:0.9em;line-height:1.5;letter-spacing:normal;white-space:pre-wrap;word-wrap:break-word;border-radius:4px}pre code{padding:0;margin:0;background:#31333d}code{color:#eee;background:#7d828a;border-radius:3px;padding:0 3px;margin:0 4px;word-break:break-all;letter-spacing:normal}a{color:#c6cddb;text-decoration:none;transition-duration:0.4s;transition-timing-function:ease-out}a:hover{color:#fff}a:focus{outline:none}hr{opacity:0.2;border-width:0 0 5px 0;border-style:dashed;background:transparent;width:50%;margin:1.8em auto}.section-inner{margin:0 auto;max-width:1200px;width:93%}.thin{max-width:720px;margin:auto}.feather{display:inline-block;vertical-align:-0.125em;width:1em;height:1em}.post-header{margin-top:1.2em;line-height:normal}.post-header .post-meta{font-size:0.9em;letter-spacing:normal;opacity:0.6}.post-header h1{margin-top:0.1em}.content{text-align:justify}.content a{word-break:break-all;border:none;box-shadow:inset 0-4px 0#018574;transition-property:background-color}.content a:hover{background-color:#018574}.post-info svg{margin-right:0.8em}@media (min-width:800px){.site-main{margin-top:3em}}@media (min-width:960px){.site-main{margin-top:6em}}@media (min-width:1300px){.site-main{margin-top:8em}}@media (min-width:1800px){.site-main{margin-top:10em}.section-inner{max-width:1600px}.thin{max-width:960px}}.code-badge{margin:0.4em 0em}</style>
<title>Ansible Tasks for Installing Single-Binary Software from GitHub Releases</title>
<link rel=alternate type=application/rss+xml title=RSS href=https://corymollet.com/atom.xml>
<link rel=icon type=image/png sizes=32x32 href=data:image/png;base64,R0lGODlhEAAQAPAAAAAAAAAAACH5BAkKAAEAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAEAAQAAAC50wSEREREUIIIYAQAgghhBAEQRAEAAAAQBAEQRAEQBAEQAAEQBAEQRAIAAKBAAAAAAACgUAgEAgAAoFAAAAABAKBQCAQCAACgUAgAAAEAoFAIBAIAAKBQAAAAAQAAAAgEBAAEBAQEAAAAAAAAAAAABAQABAQEBAAAAAAAAAAAAAAEAAQEBAQAAAAAAAAAAAAAAAAEBAQEAAAAAAAAAAAAAAAABAQEBAQAAAAAAAAAAAAABAQEBAQEAAQEBAQEAAAABAQEBAQEAAAEBAQAAAAABAQEBAQEBAQEBAQEBAQEBAQIECAAAEKAAAh+QQJCgABACwAAAAAEAAQAAAC50wSEREREUIIIYAQAgghhBAEQRAEAAAAQBAEQRAEARAEQAAEQBAEQRAIAAKBAAAAAAACgUAgEAgAAoFAAAAABAKBQCAQCAACgUAgAAAEAoFAIBAIAAKBQAAAAAQAAAAgEBAAEBAQEAAAAAAAAAAAABAQABAQEBAAAAAAAAAAAAAAEAAQEBAQAAAAAAAAAAAAAAAAEBAQEAAAAAAAAAAAAAAAABAQEBAQAAAAAAAAAAAAABAQEBAQEAAQEBAQEAAAABAQEBAQEAAAEBAQAAAAABAQEBAQEBAQEBAQEBAQEBAQIECAAAEKAAAh+QQJCgABACwAAAAAEAAQAAAC50wSEREREUIIIYAQAgghhBAEQRAEAAAAQBAEQRAEQQAEQAAEQBAEQRAIBACBAAAAAAACgUAgEAgAAoFAAAAABAKBQCAQCAACgUAgAAAEAoFAIBAIAAKBQAAAAAQAAAAgEBAAEBAQEAAAAAAAAAAAABAQABAQEBAAAAAAAAAAAAAAEAAQEBAQAAAAAAAAAAAAAAAAEBAQEAAAAAAAAAAAAAAAABAQEBAQAAAAAAAAAAAAABAQEBAQEAAQEBAQEAAAABAQEBAQEAAAEBAQAAAAABAQEBAQEBAQEBAQEBAQEBAQIECAAAEKAAAh+QQJCgABACwAAAAAEAAQAAAC50wSEREREUIIIYAQAgghhBAEQRAEAAAAQBAEQRAEQQAEQAAEQBAEQRAIBAKAAAAAAAACgUAgEAgEAIFAAAAABAKBQCAQCAQAgUAgAAAEAoFAIBAIAAKBQAAAAAQAAAAgEBAAEBAQEAAAAAAAAAAAABAQABAQEBAAAAAAAAAAAAAAEAAQEBAQAAAAAAAAAAAAAAAAEBAQEAAAAAAAAAAAAAAAABAQEBAQAAAAAAAAAAAAABAQEBAQEAAQEBAQEAAAABAQEBAQEAAAEBAQAAAAABAQEBAQEBAQEBAQEBAQEBAQIECAAAEKAAAh+QQJCgABACwAAAAAEAAQAAAC50wSEREREUIIIYAQAgghhBAEQRAEAAAAQBAEQRAEQQAEQAAEQBAEQRAIBAKAAAAAAAACgUAgEAgEAoBAAAAABAKBQCAQCAQAgUAgAAAEAoFAIBAIBACBQAAAAAQAAAAgEBAAEBAQEAAAAAAAAAAAABAQABAQEBAAAAAAAAAAAAAAEAAQEBAQAAAAAAAAAAAAAAAAEBAQEAAAAAAAAAAAAAAAABAQEBAQAAAAAAAAAAAAABAQEBAQEAAQEBAQEAAAABAQEBAQEAAAEBAQAAAAABAQEBAQEBAQEBAQEBAQEBAQIECAAAEKAAAh+QQJCgABACwAAAAAEAAQAAAC50wSEREREUIIIYAQAgghhBAEQRAEAAAAQBAEQRAEQQAEQAAEQBAEQRAIBAKAAAAAAAACgUAgEAgEAIFAAAAABAKBQCAQCAQAgUAgAAAEAoFAIBAIAAKBQAAAAAQAAAAgEBAAEBAQEAAAAAAAAAAAABAQABAQEBAAAAAAAAAAAAAAEAAQEBAQAAAAAAAAAAAAAAAAEBAQEAAAAAAAAAAAAAAAABAQEBAQAAAAAAAAAAAAABAQEBAQEAAQEBAQEAAAABAQEBAQEAAAEBAQAAAAABAQEBAQEBAQEBAQEBAQEBAQIECAAAEKAAAh+QQJCgABACwAAAAAEAAQAAAC50wSEREREUIIIYAQAgghhBAEQRAEAAAAQBAEQRAEQQAEQAAEQBAEQRAIBACBAAAAAAACgUAgEAgAAoFAAAAABAKBQCAQCAACgUAgAAAEAoFAIBAIAAKBQAAAAAQAAAAgEBAAEBAQEAAAAAAAAAAAABAQABAQEBAAAAAAAAAAAAAAEAAQEBAQAAAAAAAAAAAAAAAAEBAQEAAAAAAAAAAAAAAAABAQEBAQAAAAAAAAAAAAABAQEBAQEAAQEBAQEAAAABAQEBAQEAAAEBAQAAAAABAQEBAQEBAQEBAQEBAQEBAQIECAAAEKAAAh+QQJCgABACwAAAAAEAAQAAAC50wSEREREUIIIYAQAgghhBAEQRAEAAAAQBAEQRAEQBAEQAAEQBAEQRAIAAKBAAAAAAACgUAgEAgAAoFAAAAABAKBQCAQCAACgUAgAAAEAoFAIBAIAAKBQAAAAAQAAAAgEBAAEBAQEAAAAAAAAAAAABAQABAQEBAAAAAAAAAAAAAAEAAQEBAQAAAAAAAAAAAAAAAAEBAQEAAAAAAAAAAAAAAAABAQEBAQAAAAAAAAAAAAABAQEBAQEAAQEBAQEAAAABAQEBAQEAAAEBAQAAAAABAQEBAQEBAQEBAQEBAQEBAQIECAAAEKAAAh+QQJCgABACwAAAAAEAAQAAAC50wSEREREUIIIYAQAgghhBAEQRAEAAAAQBAEQRAAQRAEQAAEQBAEQRAABAKBAAAAAAACgUAgEAgAAoFAAAAABAKBQCAQCAACgUAgAAAEAoFAIBAIAAKBQAAAAAQAAAAgEBAAEBAQEAAAAAAAAAAAABAQABAQEBAAAAAAAAAAAAAAEAAQEBAQAAAAAAAAAAAAAAAAEBAQEAAAAAAAAAAAAAAAABAQEBAQAAAAAAAAAAAAABAQEBAQEAAQEBAQEAAAABAQEBAQEAAAEBAQAAAAABAQEBAQEBAQEBAQEBAQEBAQIECAAAEKAAAh+QQJCgABACwAAAAAEAAQAAAC50wSEREREUIIIYAQAgghhBAEQRAEAAAAQBAEQQAEQRAEQAAEQBAEQQAIBAKBAAAAAAACgUAgEAAEAoFAAAAABAKBQCAQAAQCgUAgAAAEAoFAIBAIAAKBQAAAAAQAAAAgEBAAEBAQEAAAAAAAAAAAABAQABAQEBAAAAAAAAAAAAAAEAAQEBAQAAAAAAAAAAAAAAAAEBAQEAAAAAAAAAAAAAAAABAQEBAQAAAAAAAAAAAAABAQEBAQEAAQEBAQEAAAABAQEBAQEAAAEBAQAAAAABAQEBAQEBAQEBAQEBAQEBAQIECAAAEKAAAh+QQJCgABACwAAAAAEAAQAAAC50wSEREREUIIIYAQAgghhBAEQRAEAAAAQBAEARAEQRAEQAAEQBAEARAIBAKBAAAAAAACgUAgAAgEAoFAAAAABAKBQCAACAQCgUAgAAAEAoFAIBAABAKBQAAAAAQAAAAgEAAQEBAQEAAAAAAAAAAAABAQABAQEBAAAAAAAAAAAAAAEAAQEBAQAAAAAAAAAAAAAAAAEBAQEAAAAAAAAAAAAAAAABAQEBAQAAAAAAAAAAAAABAQEBAQEAAQEBAQEAAAABAQEBAQEAAAEBAQAAAAABAQEBAQEBAQEBAQEBAQEBAQIECAAAEKAAAh+QQJCgABACwAAAAAEAAQAAAC50wSEREREUIIIYAQAgghhBAEQRAEAAAAQBAEQBAEQRAEQAAEQBAEQBAIBAKBAAAAAAACgUAAEAgEAoFAAAAABAKBQAAQCAQCgUAgAAAEAoFAIAAIBAKBQAAAAAQAAAAgEAAQEBAQEAAAAAAAAAAAABAQABAQEBAAAAAAAAAAAAAAEAAQEBAQAAAAAAAAAAAAAAAAEBAQEAAAAAAAAAAAAAAAABAQEBAQAAAAAAAAAAAAABAQEBAQEAAQEBAQEAAAABAQEBAQEAAAEBAQAAAAABAQEBAQEBAQEBAQEBAQEBAQIECAAAEKAAAh+QQJCgABACwAAAAAEAAQAAAC50wSEREREUIIIYAQAgghhBAEQRAEAAAAQBAEQBAEQRAEQAAEQBAAQRAIBAKBAAAAAAACgQAgEAgEAoFAAAAABAKBQAAQCAQCgUAgAAAEAoFAIAAIBAKBQAAAAAQAAAAgEAAQEBAQEAAAAAAAAAAAABAQABAQEBAAAAAAAAAAAAAAEAAQEBAQAAAAAAAAAAAAAAAAEBAQEAAAAAAAAAAAAAAAABAQEBAQAAAAAAAAAAAAABAQEBAQEAAQEBAQEAAAABAQEBAQEAAAEBAQAAAAABAQEBAQEBAQEBAQEBAQEBAQIECAAAEKAAAh+QQJCgABACwAAAAAEAAQAAAC50wSEREREUIIIYAQAgghhBAEQRAEAAAAQBAEAQAEQRAEQAAEQBAEQBAIBAKBAAAAAAACgQAgEAgEAoFAAAAABAKBQAAQCAQCgUAgAAAEAoFAIAAIBAKBQAAAAAQAAAAgEAAQEBAQEAAAAAAAAAAAABAQABAQEBAAAAAAAAAAAAAAEAAQEBAQAAAAAAAAAAAAAAAAEBAQEAAAAAAAAAAAAAAAABAQEBAQAAAAAAAAAAAAABAQEBAQEAAQEBAQEAAAABAQEBAQEAAAEBAQAAAAABAQEBAQEBAQEBAQEBAQEBAQIECAAAEKAAAh+QQJCgABACwAAAAAEAAQAAAC50wSEREREUIIIYAQAgghhBAEQRAEAAAAQBAEQQAAQRAEQAAEQBAEARAIBAKBAAAAAAACgUAAEAgEAoFAAAAABAKBQAAQCAQCgUAgAAAEAoFAIAAIBAKBQAAAAAQAAAAgEAAQEBAQEAAAAAAAAAAAABAQABAQEBAAAAAAAAAAAAAAEAAQEBAQAAAAAAAAAAAAAAAAEBAQEAAAAAAAAAAAAAAAABAQEBAQAAAAAAAAAAAAABAQEBAQEAAQEBAQEAAAABAQEBAQEAAAEBAQAAAAABAQEBAQEBAQEBAQEBAQEBAQIECAAAEKAAAh+QQJCgABACwAAAAAEAAQAAAC50wSEREREUIIIYAQAgghhBAEQRAEAAAAQBAEQRAAQBAEQAAEQBAEQQAIBAKBAAAAAAACgUAgAAgEAoFAAAAABAKBQCAACAQCgUAgAAAEAoFAIAAIBAKBQAAAAAQAAAAgEAAQEBAQEAAAAAAAAAAAABAQABAQEBAAAAAAAAAAAAAAEAAQEBAQAAAAAAAAAAAAAAAAEBAQEAAAAAAAAAAAAAAAABAQEBAQAAAAAAAAAAAAABAQEBAQEAAQEBAQEAAAABAQEBAQEAAAEBAQAAAAABAQEBAQEBAQEBAQEBAQEBAQIECAAAEKAAAh+QQJCgABACwAAAAAEAAQAAAC50wSEREREUIIIYAQAgghhBAEQRAEAAAAQBAEQRAAQBAEQAAEQBAEQQAIBAKBAAAAAAACgUAgAAgEAoFAAAAABAKBQCAQAAQCgUAgAAAEAoFAIBAIAAKBQAAAAAQAAAAgEBAAEBAQEAAAAAAAAAAAABAQABAQEBAAAAAAAAAAAAAAEAAQEBAQAAAAAAAAAAAAAAAAEBAQEAAAAAAAAAAAAAAAABAQEBAQAAAAAAAAAAAAABAQEBAQEAAQEBAQEAAAABAQEBAQEAAAEBAQAAAAABAQEBAQEBAQEBAQEBAQEBAQIECAAAEKAAAh+QQJCgABACwAAAAAEAAQAAAC50wSEREREUIIIYAQAgghhBAEQRAEAAAAQBAEQRAEQBAEQAAEQBAEQRAABAKBAAAAAAACgUAgEAAEAoFAAAAABAKBQCAQAAQCgUAgAAAEAoFAIBAIAAKBQAAAAAQAAAAgEBAAEBAQEAAAAAAAAAAAABAQABAQEBAAAAAAAAAAAAAAEAAQEBAQAAAAAAAAAAAAAAAAEBAQEAAAAAAAAAAAAAAAABAQEBAQAAAAAAAAAAAAABAQEBAQEAAQEBAQEAAAABAQEBAQEAAAEBAQAAAAABAQEBAQEBAQEBAQEBAQEBAQIECAAAEKAAA7><style>.sf-hidden{display:none!important}</style><link rel=canonical href=https://corymollet.com/posts/github-release-ansible-task/><meta http-equiv=content-security-policy content="default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:; object-src 'self' data:; frame-src 'self' data:;"><style>img[src="data:,"],source[src="data:,"]{display:none!important}</style><body id=page>
 
<header id=site-header class="animated faster slideInUp" style=display:none!important>
 <div class="hdr-wrapper section-inner" style=display:none!important>
 
 <div class="hdr-right hdr-icons" style=display:none!important>
 <span class="hdr-social hide-in-mobile" style=display:none!important>
 
<a href=https://github.com/cmollet target=_blank rel="noopener me" title=github style=display:none!important>
 
 <svg xmlns=http://www.w3.org/2000/svg class=feather width=24 height=24 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>
 
</a>
<a href=https://gitlab.com/corymollet target=_blank rel="noopener me" title=gitlab style=display:none!important>
 
 <svg xmlns=http://www.w3.org/2000/svg class=feather width=24 height=24 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M22.65 14.39L12 22.13 1.35 14.39a.84.84 0 0 1-.3-.94l1.22-3.78 2.44-7.51A.42.42 0 0 1 4.82 2a.43.43 0 0 1 .58 0 .42.42 0 0 1 .11.18l2.44 7.49h8.1l2.44-7.51A.42.42 0 0 1 18.6 2a.43.43 0 0 1 .58 0 .42.42 0 0 1 .11.18l2.44 7.51L23 13.45a.84.84 0 0 1-.35.94z"></path></svg>
 
</a>
<a href=https://linkedin.com/in/corymollet target=_blank rel="noopener me" title=linkedin style=display:none!important>
 
 <svg xmlns=http://www.w3.org/2000/svg class=feather width=24 height=24 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x=2 y=9 width=4 height=12></rect><circle cx=4 cy=4 r=2></circle></svg>
 
</a>
<a href=mailto:contact@corymollet.com target=_blank rel="noopener me" title=email style=display:none!important>
 
 <svg xmlns=http://www.w3.org/2000/svg class=feather width=24 height=24 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
 
</a>
 </span>
 <button id=menu-btn class=hdr-btn title=Menu style=display:none!important>
 <svg xmlns=http://www.w3.org/2000/svg width=24 height=24 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round class="feather feather-menu">
 <line x1=3 y1=12 x2=21 y2=12></line>
 <line x1=3 y1=6 x2=21 y2=6></line>
 <line x1=3 y1=18 x2=21 y2=18></line>
 </svg>
 </button>
 </div>
 </div>
</header>
<div id=mobile-menu class="animated fast" style=display:none!important>
 
</div>
 
 
 
<main class="site-main section-inner animated fadeIn faster">
 <article class=thin>
 <header class=post-header>
 <div class=post-meta>
 
 <span>Nov 02, 2021</span>
 <small> - 
<span class=reading-time title="Estimated read time">
 
 8 min read
 
</span>
</small>
 
 
 </div>
 <h1>Ansible Tasks for Installing Single-Binary Software from GitHub Releases</h1>
 </header>
 <div class=content>
 
 <p>For lots of useful command-line utilities written in languages like Go and Rust that compile down to single binaries, often the easiest way to get the most recent version for your operating system is to simply grab the binary from the project's GitHub Releases page and drop it somewhere in your <code>$PATH</code>. If you are managing a heterogeneous environment, such as different servers running different Linux distributions and developers running MacOS, relying on the native package managers to keep everything in sync and on the same version, installation, and configuration can range from mildly annoying to wildly impractical. This is even more acute if you need to pin to a specific version of a tool. <a href=https://nixos.org/>NixOS</a> is a holistic approach to this issue, but if you can't or don't want to go all-in on NixOS, using GitHub releases is one alternative for smaller-scoped use cases.</p>
<p>Here is an example <a href=https://www.ansible.com/>Ansible</a> playbook that can install multiple versions of single-binary software from GitHub releases, using two of my favorite tools, <a href=https://github.com/knqyf263/pet>pet</a> and <a href=https://github.com/x-motemen/ghq>ghq</a>, as examples.</p>
<h2 id=overview>Overview</h2>
<pre style=background-color:#2b303b;color:#c0c5ce class=code-badge-pre><div class=code-badge>
        <div class=code-badge-language>css</div>
        <div title="Copy to clipboard">
            <i class="gg-clipboard code-badge-copy-icon"></i>
        </div>
     </div><code class="hljs css"><span>├── <span class=hljs-selector-tag>playbook</span><span class=hljs-selector-class>.yml</span>
</span><span>├── <span class=hljs-selector-tag>tasks</span>
</span><span>│&nbsp;&nbsp; ├── <span class=hljs-selector-tag>ghq</span><span class=hljs-selector-class>.yml</span>
</span><span>│&nbsp;&nbsp; ├── <span class=hljs-selector-tag>github_release</span><span class=hljs-selector-class>.yml</span>
</span><span>│&nbsp;&nbsp; └── <span class=hljs-selector-tag>pet</span><span class=hljs-selector-class>.yml</span>
</span><span>├── <span class=hljs-selector-tag>templates</span>
</span><span>│&nbsp;&nbsp; └── <span class=hljs-selector-tag>pet-config</span><span class=hljs-selector-class>.toml</span><span class=hljs-selector-class>.j2</span>
</span><span>└── <span class=hljs-selector-tag>vars</span>
</span><span>    ├── <span class=hljs-selector-tag>ghq</span><span class=hljs-selector-class>.yml</span>
</span><span>    └── <span class=hljs-selector-tag>pet</span><span class=hljs-selector-class>.yml</span>
</span></code></pre>
<h2 id=playbook-yml>playbook.yml</h2>
<pre data-lang=yml style=background-color:#2b303b;color:#c0c5ce class="language-yml code-badge-pre"><div class=code-badge>
        <div class=code-badge-language>yml</div>
        <div title="Copy to clipboard">
            <i class="gg-clipboard code-badge-copy-icon"></i>
        </div>
     </div><code class="language-yml hljs yaml" data-lang=yml><span><span class=hljs-meta>---</span>
</span><span>
</span><span><span class=hljs-attr>- </span></span><span style=color:#bf616a><span class=hljs-attr>hosts</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>default</span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>remote_user</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>my_user</span>
</span><span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>vars</span></span><span><span class=hljs-attr>:</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>binary_path_dir</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ ansible_env.HOME }}</span>/.local/bin</span></span><span><span class=hljs-string>"</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>github_release_work_dir</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>/opt/github</span>
</span><span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>vars_files</span></span><span><span class=hljs-attr>:</span>
</span><span><span class=hljs-bullet>    -</span> </span><span style=color:#a3be8c><span class=hljs-string>vars/pet.yml</span>
</span><span><span class=hljs-bullet>    -</span> </span><span style=color:#a3be8c><span class=hljs-string>vars/ghq.yml</span>
</span><span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>tasks</span></span><span><span class=hljs-attr>:</span>
</span><span>
</span><span><span class=hljs-attr>    - </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Ensure</span> <span class=hljs-string>necessary</span> <span class=hljs-string>directories</span> <span class=hljs-string>exist</span>
</span><span>      </span><span style=color:#bf616a><span class=hljs-string>ansible.builtin.file</span></span><span><span class=hljs-string>:</span>
</span><span><span class=hljs-attr>        </span></span><span style=color:#bf616a><span class=hljs-attr>path</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ item }}</span></span></span><span><span class=hljs-string>"</span>
</span><span><span class=hljs-attr>        </span></span><span style=color:#bf616a><span class=hljs-attr>state</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>directory</span>
</span><span><span class=hljs-attr>        </span></span><span style=color:#bf616a><span class=hljs-attr>owner</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>my_user</span>
</span><span><span class=hljs-attr>        </span></span><span style=color:#bf616a><span class=hljs-attr>group</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>my_user</span>
</span><span><span class=hljs-attr>      </span></span><span style=color:#bf616a><span class=hljs-attr>become</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#d08770><span class=hljs-literal>yes</span>
</span><span><span class=hljs-attr>      </span></span><span style=color:#bf616a><span class=hljs-attr>become_method</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>sudo</span>  </span><span style=color:#65737e><span class=hljs-comment># Presumes my_user has sudo privileges on target machine</span>
</span><span><span class=hljs-attr>      </span></span><span style=color:#bf616a><span class=hljs-attr>loop</span></span><span><span class=hljs-attr>:</span>
</span><span><span class=hljs-bullet>        -</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ binary_path_dir }}</span></span></span><span><span class=hljs-string>"</span>
</span><span><span class=hljs-bullet>        -</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ github_release_work_dir }}</span></span></span><span><span class=hljs-string>"</span>
</span><span>    
</span><span><span class=hljs-attr>    - </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Install</span> <span class=hljs-string>pet</span>
</span><span><span class=hljs-attr>      </span></span><span style=color:#bf616a><span class=hljs-attr>include_tasks</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>tasks/pet.yml</span>
</span><span>
</span><span><span class=hljs-attr>    - </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Install</span> <span class=hljs-string>ghq</span>
</span><span><span class=hljs-attr>      </span></span><span style=color:#bf616a><span class=hljs-attr>include_tasks</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>tasks/ghq.yml</span>
</span></code></pre>
<p>This is the main playbook file that would be invoked with <code>ansible-playbook</code>. This will set up a workspace in <code>/opt</code> and includes the other task files for setting up <code>pet</code> and <code>ghq</code>.</p>
<h2 id=vars>vars/</h2>
<p>Set variables for configuring the tools here. <a href=https://github.com/knqyf263/pet#configuration>pet is configured</a> with a <a href=https://github.com/toml-lang/toml>TOML</a> file in <code>~/.config/pet</code> while <a href=https://github.com/x-motemen/ghq#configuration>ghq can be configured</a> with environment variables.</p>
<h3 id=pet-yml>pet.yml</h3>
<pre data-lang=yml style=background-color:#2b303b;color:#c0c5ce class="language-yml code-badge-pre"><div class=code-badge>
        <div class=code-badge-language>yml</div>
        <div title="Copy to clipboard">
            <i class="gg-clipboard code-badge-copy-icon"></i>
        </div>
     </div><code class="language-yml hljs yaml" data-lang=yml><span>
</span><span><span class=hljs-meta>---</span>
</span><span style=color:#bf616a><span class=hljs-attr>pet</span></span><span><span class=hljs-attr>:</span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>general</span></span><span><span class=hljs-attr>:</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>column</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#d08770><span class=hljs-number>40</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>selectcmd</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>fzf</span> <span class=hljs-bullet>--ansi</span>  </span><span style=color:#65737e><span class=hljs-comment># Presumes fzf is already installed</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>backend</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>gitlab</span>
</span><span>
</span><span>    </span><span style=color:#65737e><span class=hljs-comment># specify how snippets get sorted (recency (default),</span>
</span><span>    </span><span style=color:#65737e><span class=hljs-comment># -recency, description, -description, command, -command, output, -output)</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>sortby</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>recency</span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>gitlab</span></span><span><span class=hljs-attr>:</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>file_name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>pet-snippet.toml</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>access_token</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>""</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>url</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>""</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>id</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>""</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>visibility</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>private</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>auto_sync</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string>false</span></span><span><span class=hljs-string>"</span>
</span><span>
</span></code></pre>
<h3 id=ghq-yml>ghq.yml</h3>
<pre data-lang=yml style=background-color:#2b303b;color:#c0c5ce class="language-yml code-badge-pre"><div class=code-badge>
        <div class=code-badge-language>yml</div>
        <div title="Copy to clipboard">
            <i class="gg-clipboard code-badge-copy-icon"></i>
        </div>
     </div><code class="language-yml hljs yaml" data-lang=yml><span><span class=hljs-meta>---</span>
</span><span>
</span><span style=color:#bf616a><span class=hljs-attr>ghq</span></span><span><span class=hljs-attr>:</span>
</span><span><span class=hljs-attr>   </span></span><span style=color:#bf616a><span class=hljs-attr>root</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string>$HOME/projects</span></span><span><span class=hljs-string>"</span>
</span><span>
</span></code></pre>
<h2 id=templates-pet-config-toml-j2>templates/pet-config.toml.j2</h2>
<p>And here is the template to generate the TOML file for <code>pet</code>, using the variables in <code>vars/pet.yml</code>.</p>
<pre data-lang=j2 style=background-color:#2b303b;color:#c0c5ce class=language-j2><code class=language-j2 data-lang=j2><span>[General]
</span><span>    snippetfile = "{{ </span><span style=color:#bf616a>ansible_env</span><span>.</span><span style=color:#bf616a>HOME </span><span>}}/.config/pet/snippet.toml"
</span><span>    editor = "{{ </span><span style=color:#bf616a>ansible_env</span><span>.</span><span style=color:#bf616a>EDITOR </span><span>}}"
</span><span>    column = {{ </span><span style=color:#bf616a>pet</span><span>.</span><span style=color:#bf616a>general</span><span>.</span><span style=color:#bf616a>column </span><span>}}
</span><span>    selectcmd = "{{ </span><span style=color:#bf616a>pet</span><span>.</span><span style=color:#bf616a>general</span><span>.</span><span style=color:#bf616a>selectcmd </span><span>}}"
</span><span>    backend = "{{ </span><span style=color:#bf616a>pet</span><span>.</span><span style=color:#bf616a>general</span><span>.</span><span style=color:#bf616a>backend </span><span>}}"
</span><span>    sortby = "{{ </span><span style=color:#bf616a>pet</span><span>.</span><span style=color:#bf616a>general</span><span>.</span><span style=color:#bf616a>sortby </span><span>}}"
</span><span>
</span><span>{% </span><span style=color:#b48ead>if </span><span style=color:#bf616a>pet</span><span>.</span><span style=color:#bf616a>github </span><span style=color:#b48ead>is </span><span style=color:#bf616a>defined </span><span>%}
</span><span>[GitHub]
</span><span>    file_name = "{{ </span><span style=color:#bf616a>pet</span><span>.</span><span style=color:#bf616a>github</span><span>.</span><span style=color:#bf616a>file_name </span><span>}}"
</span><span>    access_token = "{{ </span><span style=color:#bf616a>pet</span><span>.</span><span style=color:#bf616a>github</span><span>.</span><span style=color:#bf616a>access_token </span><span>}}"
</span><span>    gist_id = "{{ </span><span style=color:#bf616a>pet</span><span>.</span><span style=color:#bf616a>github</span><span>.</span><span style=color:#bf616a>gist_id </span><span>}}"
</span><span>    public = "{{ </span><span style=color:#bf616a>pet</span><span>.</span><span style=color:#bf616a>github</span><span>.</span><span style=color:#bf616a>public </span><span>}}"
</span><span>    auto_sync = {{ </span><span style=color:#bf616a>pet</span><span>.</span><span style=color:#bf616a>github</span><span>.</span><span style=color:#bf616a>auto_sync </span><span>}}
</span><span>{% </span><span style=color:#b48ead>endif </span><span>%}
</span><span>
</span><span>{% </span><span style=color:#b48ead>if </span><span style=color:#bf616a>pet</span><span>.</span><span style=color:#bf616a>gitlab </span><span style=color:#b48ead>is </span><span style=color:#bf616a>defined </span><span>%}
</span><span>[GitLab]
</span><span>    file_name = "{{ </span><span style=color:#bf616a>pet</span><span>.</span><span style=color:#bf616a>gitlab</span><span>.</span><span style=color:#bf616a>file_name </span><span>}}"
</span><span>    access_token = "{{ </span><span style=color:#bf616a>pet</span><span>.</span><span style=color:#bf616a>gitlab</span><span>.</span><span style=color:#bf616a>access_token </span><span>}}"
</span><span>    url = "{{ </span><span style=color:#bf616a>pet</span><span>.</span><span style=color:#bf616a>gitlab</span><span>.</span><span style=color:#bf616a>url </span><span>}}"
</span><span>    id = "{{ </span><span style=color:#bf616a>pet</span><span>.</span><span style=color:#bf616a>gitlab</span><span>.</span><span style=color:#bf616a>id </span><span>}}"
</span><span>    visibility = "{{ </span><span style=color:#bf616a>pet</span><span>.</span><span style=color:#bf616a>gitlab</span><span>.</span><span style=color:#bf616a>visibility </span><span>}}"
</span><span>    auto_sync = {{ </span><span style=color:#bf616a>pet</span><span>.</span><span style=color:#bf616a>gitlab</span><span>.</span><span style=color:#bf616a>auto_sync </span><span>}}
</span><span>{% </span><span style=color:#b48ead>endif </span><span>%}
</span></code></pre>
<p><code>pet</code> can sync your snippets to your GitHub or GitLab accounts, so there is conditional logic to see which one(s) are configured. Note that in <code>vars/pet.yml</code>, <code>auto_sync</code> is set to a string <code>"false"</code> while the template is unquoted. That value must be a boolean, and Ansible/Jinja would interpret a YAML false-y value as a Python boolean <code>False</code> and write it as such (with a capital F) in the template, which would be a syntax error in Go.</p>
<h2 id=tasks-github-release-yml>tasks/github_release.yml</h2>
<pre data-lang=yml style=background-color:#2b303b;color:#c0c5ce class="language-yml code-badge-pre"><div class=code-badge>
        <div class=code-badge-language>yml</div>
        <div title="Copy to clipboard">
            <i class="gg-clipboard code-badge-copy-icon"></i>
        </div>
     </div><code class="language-yml hljs yaml" data-lang=yml><span><span class=hljs-meta>---</span>
</span><span>
</span><span><span class=hljs-attr>- </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Set</span> <span class=hljs-string>version</span> <span class=hljs-string>dir</span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>set_fact</span></span><span><span class=hljs-attr>:</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>version_dir</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ github_release_work_dir }}</span>/<span class=hljs-template-variable>{{ org }}</span>/<span class=hljs-template-variable>{{ repo }}</span>/<span class=hljs-template-variable>{{ version | default('latest') }}</span></span></span><span><span class=hljs-string>"</span>
</span><span>
</span><span><span class=hljs-attr>- </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Set</span> <span class=hljs-string>version</span> <span class=hljs-string>data</span> <span class=hljs-string>json</span> <span class=hljs-string>file</span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>set_fact</span></span><span><span class=hljs-attr>:</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>version_data_json_file</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ github_release_work_dir }}</span>/<span class=hljs-template-variable>{{ org }}</span>/<span class=hljs-template-variable>{{ repo }}</span>/version_data.json</span></span><span><span class=hljs-string>"</span>
</span><span>
</span><span><span class=hljs-attr>- </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Initialize</span> <span class=hljs-string>should_update</span> <span class=hljs-string>flag</span> <span class=hljs-string>to</span> <span class=hljs-literal>true</span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>set_fact</span></span><span><span class=hljs-attr>:</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>should_update</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#d08770><span class=hljs-literal>true</span>
</span><span>
</span><span><span class=hljs-attr>- </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string>Check latest version of <span class=hljs-template-variable>{{ org }}</span>/<span class=hljs-template-variable>{{ repo }}</span></span></span><span><span class=hljs-string>"</span>
</span><span>  </span><span style=color:#bf616a><span class=hljs-string>ansible.builtin.uri</span></span><span><span class=hljs-string>:</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>url</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string>https://api.github.com/repos/<span class=hljs-template-variable>{{ org }}</span>/<span class=hljs-template-variable>{{ repo }}</span>/releases/<span class=hljs-template-variable>{{ version | default('latest') }}</span></span></span><span><span class=hljs-string>"</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>return_content</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#d08770><span class=hljs-literal>yes</span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>register</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>version_data</span>
</span><span>
</span><span><span class=hljs-attr>- </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Check</span> <span class=hljs-string>if</span> <span class=hljs-string>version</span> <span class=hljs-string>has</span> <span class=hljs-string>been</span> <span class=hljs-string>previously</span> <span class=hljs-string>downloaded</span>
</span><span>  </span><span style=color:#bf616a><span class=hljs-string>ansible.builtin.stat</span></span><span><span class=hljs-string>:</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>path</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ version_data_json_file }}</span></span></span><span><span class=hljs-string>"</span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>register</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>previous_download</span>
</span><span>
</span><span><span class=hljs-attr>- </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Check</span> <span class=hljs-string>if</span> <span class=hljs-string>newer</span> <span class=hljs-string>version</span> <span class=hljs-string>exists,</span> <span class=hljs-string>if</span> <span class=hljs-string>latest</span> <span class=hljs-string>version</span> <span class=hljs-string>requested</span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>block</span></span><span><span class=hljs-attr>:</span>
</span><span><span class=hljs-attr>    - </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Read</span> <span class=hljs-string>version_data.json</span>
</span><span>      </span><span style=color:#bf616a><span class=hljs-string>ansible.builtin.shell</span></span><span><span class=hljs-string>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string>cat <span class=hljs-template-variable>{{ version_data_json_file }}</span></span></span><span><span class=hljs-string>"</span>
</span><span><span class=hljs-attr>      </span></span><span style=color:#bf616a><span class=hljs-attr>register</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>result</span>
</span><span><span class=hljs-attr>      </span></span><span style=color:#bf616a><span class=hljs-attr>ignore_errors</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#d08770><span class=hljs-literal>yes</span>
</span><span>
</span><span><span class=hljs-attr>    - </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Set</span> <span class=hljs-string>currently</span> <span class=hljs-string>installed</span> <span class=hljs-string>version</span> <span class=hljs-string>JSON</span> <span class=hljs-string>data</span>
</span><span><span class=hljs-attr>      </span></span><span style=color:#bf616a><span class=hljs-attr>set_fact</span></span><span><span class=hljs-attr>:</span>
</span><span><span class=hljs-attr>        </span></span><span style=color:#bf616a><span class=hljs-attr>currently_installed_version_json_data</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ result.stdout | from_json }}</span></span></span><span><span class=hljs-string>"</span>
</span><span>
</span><span><span class=hljs-attr>    - </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Set</span> <span class=hljs-string>github</span> <span class=hljs-string>version</span> <span class=hljs-string>published_at</span>
</span><span><span class=hljs-attr>      </span></span><span style=color:#bf616a><span class=hljs-attr>set_fact</span></span><span><span class=hljs-attr>:</span>
</span><span><span class=hljs-attr>        </span></span><span style=color:#bf616a><span class=hljs-attr>github_version_published_at</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ version_data.json.published_at | to_datetime('%Y-%m-%dT%H:%M:%SZ') }}</span></span></span><span><span class=hljs-string>"</span>
</span><span>
</span><span><span class=hljs-attr>    - </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Set</span> <span class=hljs-string>installed</span> <span class=hljs-string>version</span> <span class=hljs-string>published_at</span>
</span><span><span class=hljs-attr>      </span></span><span style=color:#bf616a><span class=hljs-attr>set_fact</span></span><span><span class=hljs-attr>:</span>
</span><span><span class=hljs-attr>        </span></span><span style=color:#bf616a><span class=hljs-attr>installed_version_published_at</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ currently_installed_version_json_data.json.published_at | to_datetime('%Y-%m-%dT%H:%M:%SZ') }}</span></span></span><span><span class=hljs-string>"</span>
</span><span>
</span><span><span class=hljs-attr>    - </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Update</span> <span class=hljs-string>should_update</span> <span class=hljs-string>flag</span>
</span><span><span class=hljs-attr>      </span></span><span style=color:#bf616a><span class=hljs-attr>set_fact</span></span><span><span class=hljs-attr>:</span>
</span><span><span class=hljs-attr>        </span></span><span style=color:#bf616a><span class=hljs-attr>should_update</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#d08770><span class=hljs-literal>false</span>
</span><span><span class=hljs-attr>      </span></span><span style=color:#bf616a><span class=hljs-attr>when</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>installed_version_published_at</span> <span class=hljs-string>&gt;=</span> <span class=hljs-string>github_version_published_at</span>
</span><span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>when</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>previous_download.stat.exists</span> <span class=hljs-string>and</span> <span class=hljs-string>(version</span> <span class=hljs-string>is</span> <span class=hljs-string>not</span> <span class=hljs-string>defined</span> <span class=hljs-string>or</span> <span class=hljs-string>version</span> <span class=hljs-string>==</span> <span class=hljs-string>"latest"</span><span class=hljs-string>)</span>
</span><span>
</span><span><span class=hljs-attr>- </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Set</span> <span class=hljs-string>installed</span> <span class=hljs-string>version</span> <span class=hljs-string>tag</span> <span class=hljs-string>name</span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>set_fact</span></span><span><span class=hljs-attr>:</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>installed_version_tag_name</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ version_data.json.tag_name }}</span></span></span><span><span class=hljs-string>"</span>
</span><span>
</span><span>
</span><span><span class=hljs-attr>- </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string>Download <span class=hljs-template-variable>{{ repo }}</span> and link to <span class=hljs-template-variable>{{ version | default('latest') }}</span> version</span></span><span><span class=hljs-string>"</span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>block</span></span><span><span class=hljs-attr>:</span>
</span><span>
</span><span><span class=hljs-attr>    - </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Ensure</span> <span class=hljs-string>repo</span> <span class=hljs-string>download</span> <span class=hljs-string>directory</span> <span class=hljs-string>exists</span>
</span><span>      </span><span style=color:#bf616a><span class=hljs-string>ansible.builtin.file</span></span><span><span class=hljs-string>:</span>
</span><span><span class=hljs-attr>        </span></span><span style=color:#bf616a><span class=hljs-attr>path</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ version_dir }}</span>/extract</span></span><span><span class=hljs-string>"</span>
</span><span><span class=hljs-attr>        </span></span><span style=color:#bf616a><span class=hljs-attr>state</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>directory</span>
</span><span>
</span><span><span class=hljs-attr>    - </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string>Install <span class=hljs-template-variable>{{ repo }}</span> <span class=hljs-template-variable>{{ installed_version_tag_name }}</span></span></span><span><span class=hljs-string>"</span>
</span><span>      </span><span style=color:#bf616a><span class=hljs-string>ansible.builtin.unarchive</span></span><span><span class=hljs-string>:</span>
</span><span><span class=hljs-attr>        </span></span><span style=color:#bf616a><span class=hljs-attr>remote_src</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#d08770><span class=hljs-literal>yes</span>
</span><span><span class=hljs-attr>        </span></span><span style=color:#bf616a><span class=hljs-attr>src</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ asset.browser_download_url }}</span></span></span><span><span class=hljs-string>"</span>
</span><span><span class=hljs-attr>        </span></span><span style=color:#bf616a><span class=hljs-attr>dest</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ version_dir }}</span>/extract</span></span><span><span class=hljs-string>"</span>
</span><span><span class=hljs-attr>      </span></span><span style=color:#bf616a><span class=hljs-attr>loop</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ version_data.json.assets }}</span></span></span><span><span class=hljs-string>"</span>
</span><span><span class=hljs-attr>      </span></span><span style=color:#bf616a><span class=hljs-attr>loop_control</span></span><span><span class=hljs-attr>:</span>
</span><span><span class=hljs-attr>        </span></span><span style=color:#bf616a><span class=hljs-attr>loop_var</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>asset</span>
</span><span><span class=hljs-attr>      </span></span><span style=color:#bf616a><span class=hljs-attr>when</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string>filename_substring|string in asset.name</span></span><span><span class=hljs-string>"</span>
</span><span>
</span><span><span class=hljs-attr>    - </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Write</span> <span class=hljs-string>version_data</span> <span class=hljs-string>to</span> <span class=hljs-string>file</span>
</span><span>      </span><span style=color:#bf616a><span class=hljs-string>ansible.builtin.copy</span></span><span><span class=hljs-string>:</span>
</span><span><span class=hljs-attr>        </span></span><span style=color:#bf616a><span class=hljs-attr>dest</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ version_data_json_file }}</span></span></span><span><span class=hljs-string>"</span>
</span><span><span class=hljs-attr>        </span></span><span style=color:#bf616a><span class=hljs-attr>content</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ version_data }}</span></span></span><span><span class=hljs-string>"</span>
</span><span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>when</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>should_update</span> <span class=hljs-string>| bool
</span></span><span><span class=hljs-string>
</span></span></code></pre>
<p>This is the core task module that handles fetching specific versions from GitHub and contains logic to determine whether there is a new version that should be updated on the target machine. Let's step through it:</p>
<pre data-lang=yml style=background-color:#2b303b;color:#c0c5ce class="language-yml code-badge-pre"><div class=code-badge>
        <div class=code-badge-language>yml</div>
        <div title="Copy to clipboard">
            <i class="gg-clipboard code-badge-copy-icon"></i>
        </div>
     </div><code class="language-yml hljs yaml" data-lang=yml><span>
</span><span><span class=hljs-attr>- </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Set</span> <span class=hljs-string>version</span> <span class=hljs-string>dir</span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>set_fact</span></span><span><span class=hljs-attr>:</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>version_dir</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ github_release_work_dir }}</span>/<span class=hljs-template-variable>{{ org }}</span>/<span class=hljs-template-variable>{{ repo }}</span>/<span class=hljs-template-variable>{{ version | default('latest') }}</span></span></span><span><span class=hljs-string>"</span>
</span><span>
</span><span><span class=hljs-attr>- </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Set</span> <span class=hljs-string>version</span> <span class=hljs-string>data</span> <span class=hljs-string>json</span> <span class=hljs-string>file</span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>set_fact</span></span><span><span class=hljs-attr>:</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>version_data_json_file</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ github_release_work_dir }}</span>/<span class=hljs-template-variable>{{ org }}</span>/<span class=hljs-template-variable>{{ repo }}</span>/version_data.json</span></span><span><span class=hljs-string>"</span>
</span><span>
</span><span><span class=hljs-attr>- </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Initialize</span> <span class=hljs-string>should_update</span> <span class=hljs-string>flag</span> <span class=hljs-string>to</span> <span class=hljs-literal>true</span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>set_fact</span></span><span><span class=hljs-attr>:</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>should_update</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#d08770><span class=hljs-literal>true</span>
</span><span>
</span></code></pre>
<p>This sets "facts", essentially <a href=https://docs.ansible.com/ansible/latest/collections/ansible/builtin/set_fact_module.html>Ansible-speak</a> for setting a variable that can be referenced later. The first task sets the workspace path using variables that are meant to be passed in by the task or playbook calling this task file. The second task sets the path of the JSON data returned by the GitHub API to be stored as a file on disk for comparing installed versions against newly published versions. The third task is pretty self-explanatory, we are assuming an update (or installing for the first time if the software has never been installed before) unless the existing version is older than the latest GitHub version.</p>
<hr>
<pre data-lang=yml style=background-color:#2b303b;color:#c0c5ce class="language-yml code-badge-pre"><div class=code-badge>
        <div class=code-badge-language>yml</div>
        <div title="Copy to clipboard">
            <i class="gg-clipboard code-badge-copy-icon"></i>
        </div>
     </div><code class="language-yml hljs yaml" data-lang=yml><span><span class=hljs-attr>- </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string>Check latest version of <span class=hljs-template-variable>{{ org }}</span>/<span class=hljs-template-variable>{{ repo }}</span></span></span><span><span class=hljs-string>"</span>
</span><span>  </span><span style=color:#bf616a><span class=hljs-string>ansible.builtin.uri</span></span><span><span class=hljs-string>:</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>url</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string>https://api.github.com/repos/<span class=hljs-template-variable>{{ org }}</span>/<span class=hljs-template-variable>{{ repo }}</span>/releases/<span class=hljs-template-variable>{{ version | default('latest') }}</span></span></span><span><span class=hljs-string>"</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>return_content</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#d08770><span class=hljs-literal>yes</span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>register</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>version_data</span>
</span></code></pre>
<p><a href=https://docs.github.com/en/rest/reference/repos#releases>Releases are included in the GitHub API</a>, so this task uses the API to fetch structured information about the release and stores it in a variable called <code>version_data</code>.</p>
<hr>
<pre data-lang=yml style=background-color:#2b303b;color:#c0c5ce class="language-yml code-badge-pre"><div class=code-badge>
        <div class=code-badge-language>yml</div>
        <div title="Copy to clipboard">
            <i class="gg-clipboard code-badge-copy-icon"></i>
        </div>
     </div><code class="language-yml hljs yaml" data-lang=yml><span><span class=hljs-attr>- </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Check</span> <span class=hljs-string>if</span> <span class=hljs-string>version</span> <span class=hljs-string>has</span> <span class=hljs-string>been</span> <span class=hljs-string>previously</span> <span class=hljs-string>downloaded</span>
</span><span>  </span><span style=color:#bf616a><span class=hljs-string>ansible.builtin.stat</span></span><span><span class=hljs-string>:</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>path</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ version_data_json_file }}</span></span></span><span><span class=hljs-string>"</span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>register</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>previous_download</span>
</span><span>
</span><span><span class=hljs-attr>- </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Check</span> <span class=hljs-string>if</span> <span class=hljs-string>newer</span> <span class=hljs-string>version</span> <span class=hljs-string>exists,</span> <span class=hljs-string>if</span> <span class=hljs-string>latest</span> <span class=hljs-string>version</span> <span class=hljs-string>requested</span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>block</span></span><span><span class=hljs-attr>:</span>
</span><span><span class=hljs-attr>    - </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Read</span> <span class=hljs-string>version_data.json</span>
</span><span>      </span><span style=color:#bf616a><span class=hljs-string>ansible.builtin.shell</span></span><span><span class=hljs-string>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string>cat <span class=hljs-template-variable>{{ version_data_json_file }}</span></span></span><span><span class=hljs-string>"</span>
</span><span><span class=hljs-attr>      </span></span><span style=color:#bf616a><span class=hljs-attr>register</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>result</span>
</span><span><span class=hljs-attr>      </span></span><span style=color:#bf616a><span class=hljs-attr>ignore_errors</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#d08770><span class=hljs-literal>yes</span>
</span><span>
</span><span><span class=hljs-attr>    - </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Set</span> <span class=hljs-string>currently</span> <span class=hljs-string>installed</span> <span class=hljs-string>version</span> <span class=hljs-string>JSON</span> <span class=hljs-string>data</span>
</span><span><span class=hljs-attr>      </span></span><span style=color:#bf616a><span class=hljs-attr>set_fact</span></span><span><span class=hljs-attr>:</span>
</span><span><span class=hljs-attr>        </span></span><span style=color:#bf616a><span class=hljs-attr>currently_installed_version_json_data</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ result.stdout | from_json }}</span></span></span><span><span class=hljs-string>"</span>
</span><span>
</span><span><span class=hljs-attr>    - </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Set</span> <span class=hljs-string>github</span> <span class=hljs-string>version</span> <span class=hljs-string>published_at</span>
</span><span><span class=hljs-attr>      </span></span><span style=color:#bf616a><span class=hljs-attr>set_fact</span></span><span><span class=hljs-attr>:</span>
</span><span><span class=hljs-attr>        </span></span><span style=color:#bf616a><span class=hljs-attr>github_version_published_at</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ version_data.json.published_at | to_datetime('%Y-%m-%dT%H:%M:%SZ') }}</span></span></span><span><span class=hljs-string>"</span>
</span><span>
</span><span><span class=hljs-attr>    - </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Set</span> <span class=hljs-string>installed</span> <span class=hljs-string>version</span> <span class=hljs-string>published_at</span>
</span><span><span class=hljs-attr>      </span></span><span style=color:#bf616a><span class=hljs-attr>set_fact</span></span><span><span class=hljs-attr>:</span>
</span><span><span class=hljs-attr>        </span></span><span style=color:#bf616a><span class=hljs-attr>installed_version_published_at</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ currently_installed_version_json_data.json.published_at | to_datetime('%Y-%m-%dT%H:%M:%SZ') }}</span></span></span><span><span class=hljs-string>"</span>
</span><span>
</span><span><span class=hljs-attr>    - </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Update</span> <span class=hljs-string>should_update</span> <span class=hljs-string>flag</span>
</span><span><span class=hljs-attr>      </span></span><span style=color:#bf616a><span class=hljs-attr>set_fact</span></span><span><span class=hljs-attr>:</span>
</span><span><span class=hljs-attr>        </span></span><span style=color:#bf616a><span class=hljs-attr>should_update</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#d08770><span class=hljs-literal>false</span>
</span><span><span class=hljs-attr>      </span></span><span style=color:#bf616a><span class=hljs-attr>when</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>installed_version_published_at</span> <span class=hljs-string>&gt;=</span> <span class=hljs-string>github_version_published_at</span>
</span><span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>when</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>previous_download.stat.exists</span> <span class=hljs-string>and</span> <span class=hljs-string>(version</span> <span class=hljs-string>is</span> <span class=hljs-string>not</span> <span class=hljs-string>defined</span> <span class=hljs-string>or</span> <span class=hljs-string>version</span> <span class=hljs-string>==</span> <span class=hljs-string>"latest"</span><span class=hljs-string>)</span>
</span></code></pre>
<p>If the calling playbook task requests the latest version (the default if omitted), this block of tasks reads in the <code>installed_version.json</code> file to compare the <code>published_at</code> times from the currently installed version. This makes use of several <a href=https://docs.ansible.com/ansible/latest/user_guide/playbooks_filters.html>Ansible/Jinja2 filters</a>, such as parsing JSON using <code>from_json</code> and datetimes using <code>to_datetime</code>. For some reason, the default <code>to_datetime</code> format is not <a href=https://en.wikipedia.org/wiki/ISO_8601>ISO8601</a>, so I had to pass in the <a href=https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior>Python format codes</a>.</p>
<p>If the user requests the latest version, and there is no newer version published on GitHub, the <code>should_update</code> flag gets set to <code>false</code> and the remaining tasks will not be run.</p>
<hr>
<pre data-lang=yml style=background-color:#2b303b;color:#c0c5ce class="language-yml code-badge-pre"><div class=code-badge>
        <div class=code-badge-language>yml</div>
        <div title="Copy to clipboard">
            <i class="gg-clipboard code-badge-copy-icon"></i>
        </div>
     </div><code class="language-yml hljs yaml" data-lang=yml><span><span class=hljs-attr>- </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Set</span> <span class=hljs-string>installed</span> <span class=hljs-string>version</span> <span class=hljs-string>tag</span> <span class=hljs-string>name</span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>set_fact</span></span><span><span class=hljs-attr>:</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>installed_version_tag_name</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ version_data.json.tag_name }}</span></span></span><span><span class=hljs-string>"</span>
</span></code></pre>
<p>This sets a fact to the latest version's tag name, which may or may not come in handy later. There is no standard format or structure to GitHub releases, and some will have the tag name in the folder or files that are unpacked. You might need to refer to the path containing that tag name when symlinking the binary.</p>
<hr>
<pre data-lang=yml style=background-color:#2b303b;color:#c0c5ce class="language-yml code-badge-pre"><div class=code-badge>
        <div class=code-badge-language>yml</div>
        <div title="Copy to clipboard">
            <i class="gg-clipboard code-badge-copy-icon"></i>
        </div>
     </div><code class="language-yml hljs yaml" data-lang=yml><span><span class=hljs-attr>- </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string>Download <span class=hljs-template-variable>{{ repo }}</span> and link to <span class=hljs-template-variable>{{ version | default('latest') }}</span> version</span></span><span><span class=hljs-string>"</span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>block</span></span><span><span class=hljs-attr>:</span>
</span><span>
</span><span><span class=hljs-attr>    - </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Ensure</span> <span class=hljs-string>repo</span> <span class=hljs-string>download</span> <span class=hljs-string>directory</span> <span class=hljs-string>exists</span>
</span><span>      </span><span style=color:#bf616a><span class=hljs-string>ansible.builtin.file</span></span><span><span class=hljs-string>:</span>
</span><span><span class=hljs-attr>        </span></span><span style=color:#bf616a><span class=hljs-attr>path</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ version_dir }}</span>/extract</span></span><span><span class=hljs-string>"</span>
</span><span><span class=hljs-attr>        </span></span><span style=color:#bf616a><span class=hljs-attr>state</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>directory</span>
</span><span>
</span><span><span class=hljs-attr>    - </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string>Install <span class=hljs-template-variable>{{ repo }}</span> <span class=hljs-template-variable>{{ installed_version_tag_name }}</span></span></span><span><span class=hljs-string>"</span>
</span><span>      </span><span style=color:#bf616a><span class=hljs-string>ansible.builtin.unarchive</span></span><span><span class=hljs-string>:</span>
</span><span><span class=hljs-attr>        </span></span><span style=color:#bf616a><span class=hljs-attr>remote_src</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#d08770><span class=hljs-literal>yes</span>
</span><span><span class=hljs-attr>        </span></span><span style=color:#bf616a><span class=hljs-attr>src</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ asset.browser_download_url }}</span></span></span><span><span class=hljs-string>"</span>
</span><span><span class=hljs-attr>        </span></span><span style=color:#bf616a><span class=hljs-attr>dest</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ version_dir }}</span>/extract</span></span><span><span class=hljs-string>"</span>
</span><span><span class=hljs-attr>      </span></span><span style=color:#bf616a><span class=hljs-attr>loop</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ version_data.json.assets }}</span></span></span><span><span class=hljs-string>"</span>
</span><span><span class=hljs-attr>      </span></span><span style=color:#bf616a><span class=hljs-attr>loop_control</span></span><span><span class=hljs-attr>:</span>
</span><span><span class=hljs-attr>        </span></span><span style=color:#bf616a><span class=hljs-attr>loop_var</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>asset</span>
</span><span><span class=hljs-attr>      </span></span><span style=color:#bf616a><span class=hljs-attr>when</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string>filename_substring|string in asset.name</span></span><span><span class=hljs-string>"</span>
</span><span>
</span><span><span class=hljs-attr>    - </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Write</span> <span class=hljs-string>version_data</span> <span class=hljs-string>to</span> <span class=hljs-string>file</span>
</span><span>      </span><span style=color:#bf616a><span class=hljs-string>ansible.builtin.copy</span></span><span><span class=hljs-string>:</span>
</span><span><span class=hljs-attr>        </span></span><span style=color:#bf616a><span class=hljs-attr>dest</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ version_data_json_file }}</span></span></span><span><span class=hljs-string>"</span>
</span><span><span class=hljs-attr>        </span></span><span style=color:#bf616a><span class=hljs-attr>content</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ version_data }}</span></span></span><span><span class=hljs-string>"</span>
</span></code></pre>
<p>Here we actually download the release from GitHub, unpack it into our workspace, and update the <code>installed_version.json</code> metadata file. I created a separate containing "extract" directory because if the extracted binary is the same name as the repo it would sometimes cause weird issues, like Ansible seemingly silently not extracting or discarding the binary if the <code>dest</code> directory had the same <code>basename</code>.</p>
<p>Ansible's <a href=https://docs.ansible.com/ansible/latest/collections/ansible/builtin/unarchive_module.html>unarchive</a> module nicely abstracts away the nitty-gritty and <a href=https://xkcd.com/1168/>labrynthine flags and options for unpacking various archive formats</a>. If you pass <code>remote_src: yes</code> and <code>src</code> contains <code>://</code> it will also assume it's a remote link and will download and unpack it, all in one step!</p>
<p>We also make use of <a href=https://docs.ansible.com/ansible/latest/user_guide/playbooks_loops.html>loops in Ansible</a> to loop over the array of assets from the GitHub API response to find the one that matches the <code>filename_substring</code> variable passed in by the calling playbook or task. A project could have many downloadable assets for the same release version, even for the same operating system and architecture. You should be as explicit as possible for the substring to look for, because it will obviously stop on the first one that matches. The <code>loop_var</code> is set to <code>asset</code> instead of the default <code>item</code>, just to be on the safe side for a scenario such as this task being run in an outer loop.</p>
<p>Next are the task files for <code>pet</code> and <code>ghq</code> that utilize this <code>github_release</code> task.</p>
<h2 id=tasks-pet-yml>tasks/pet.yml</h2>
<pre data-lang=yml style=background-color:#2b303b;color:#c0c5ce class="language-yml code-badge-pre"><div class=code-badge>
        <div class=code-badge-language>yml</div>
        <div title="Copy to clipboard">
            <i class="gg-clipboard code-badge-copy-icon"></i>
        </div>
     </div><code class="language-yml hljs yaml" data-lang=yml><span><span class=hljs-meta>---</span>
</span><span>
</span><span><span class=hljs-attr>- </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Fetch</span> <span class=hljs-string>pet</span> <span class=hljs-string>from</span> <span class=hljs-string>GitHub</span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>include_tasks</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>github_release.yml</span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>vars</span></span><span><span class=hljs-attr>:</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>org</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>knqyf263</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>repo</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>pet</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>filename_substring</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>linux_amd64.tar.gz</span>
</span><span>
</span><span><span class=hljs-attr>- </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string>Symlink binary to <span class=hljs-template-variable>{{ binary_path_dir }}</span></span></span><span><span class=hljs-string>"</span>
</span><span>  </span><span style=color:#bf616a><span class=hljs-string>ansible.builtin.file</span></span><span><span class=hljs-string>:</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>src</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ version_dir }}</span>/extract/pet</span></span><span><span class=hljs-string>"</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>dest</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ binary_path_dir }}</span>/pet</span></span><span><span class=hljs-string>"</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>state</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>link</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>force</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#d08770><span class=hljs-literal>yes</span>
</span><span>
</span><span><span class=hljs-attr>- </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Symlink</span> <span class=hljs-string>completions</span> <span class=hljs-string>file</span> <span class=hljs-string>to</span> <span class=hljs-string>/usr/share/zsh/site-functions</span>
</span><span>  </span><span style=color:#bf616a><span class=hljs-string>ansible.builtin.file</span></span><span><span class=hljs-string>:</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>src</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ version_dir }}</span>/extract/misc/completions/zsh/_pet</span></span><span><span class=hljs-string>"</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>dest</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>/usr/share/zsh/site-functions/_pet</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>state</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>link</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>force</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#d08770><span class=hljs-literal>yes</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>owner</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>root</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>group</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>root</span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>become</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#d08770><span class=hljs-literal>yes</span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>become_method</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>sudo</span>
</span><span>
</span><span><span class=hljs-attr>- </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Ensure</span> <span class=hljs-string>config</span> <span class=hljs-string>directory</span> <span class=hljs-string>exists</span>
</span><span>  </span><span style=color:#bf616a><span class=hljs-string>ansible.builtin.file</span></span><span><span class=hljs-string>:</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>path</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ ansible_env.HOME }}</span>/.config/pet</span></span><span><span class=hljs-string>"</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>state</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>directory</span>
</span><span>
</span><span><span class=hljs-attr>- </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Generate</span> <span class=hljs-string>pet</span> <span class=hljs-string>config</span> <span class=hljs-string>from</span> <span class=hljs-string>template</span>
</span><span>  </span><span style=color:#bf616a><span class=hljs-string>ansible.builtin.template</span></span><span><span class=hljs-string>:</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>src</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>pet-config.toml.j2</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>dest</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ ansible_env.HOME }}</span>/.config/pet/config.toml</span></span><span><span class=hljs-string>"</span>
</span></code></pre>
<p>The first task invokes the <code>github_release</code> task and passes in the required variables. You can determine what <code>filename_substring</code> to use from looking at <a href=https://github.com/knqyf263/pet/releases>the releases page</a>. If you're on MacOS, for example, you would set <code>filename_substring</code> to <code>darwin_amd64</code>.</p>
<p>After the <code>github_release</code> task completes successfully we should have the extracted binary in our git workspace. <code>set_fact</code> makes the fact available to subsequent playbooks/tasks, so we refer to the <code>version_dir</code> to find the binary and symlink it to our <code>binary_path_dir</code>. </p>
<p>The <code>pet</code> release also includes shell completions for both <code>bash</code> and <code>zsh</code>. Since I'm a <code>zsh</code> user, I symlink the appropriate completion file from the unpacked workspace to the standard <code>zsh</code> completions directory of <code>/usr/share/zsh/site-functions</code>. Since that is system-wide, be aware that <code>my_user</code> must have passwordless-sudo privileges on the target machine.</p>
<p>Finally, we ensure the configuration directory exists and then generate the TOML file for it from our template.</p>
<h2 id=tasks-ghq-yml>tasks/ghq.yml</h2>
<pre data-lang=yml style=background-color:#2b303b;color:#c0c5ce class="language-yml code-badge-pre"><div class=code-badge>
        <div class=code-badge-language>yml</div>
        <div title="Copy to clipboard">
            <i class="gg-clipboard code-badge-copy-icon"></i>
        </div>
     </div><code class="language-yml hljs yaml" data-lang=yml><span><span class=hljs-meta>---</span>
</span><span>
</span><span><span class=hljs-attr>- </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Fetch</span> <span class=hljs-string>ghq</span> <span class=hljs-string>from</span> <span class=hljs-string>GitHub</span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>include_tasks</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>github_release.yml</span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>vars</span></span><span><span class=hljs-attr>:</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>org</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>x-motemen</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>repo</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>ghq</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>filename_substring</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>linux_amd64</span>
</span><span>
</span><span><span class=hljs-attr>- </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string>Symlink binary to <span class=hljs-template-variable>{{ binary_path_dir }}</span></span></span><span><span class=hljs-string>"</span>
</span><span>  </span><span style=color:#bf616a><span class=hljs-string>ansible.builtin.file</span></span><span><span class=hljs-string>:</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>src</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ version_dir }}</span>/extract/ghq_linux_amd64/ghq</span></span><span><span class=hljs-string>"</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>dest</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ binary_path_dir }}</span>/ghq</span></span><span><span class=hljs-string>"</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>state</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>link</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>force</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#d08770><span class=hljs-literal>yes</span>
</span><span>
</span><span><span class=hljs-attr>- </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Symlink</span> <span class=hljs-string>completions</span> <span class=hljs-string>file</span> <span class=hljs-string>to</span> <span class=hljs-string>/usr/share/zsh/site-functions</span>
</span><span>  </span><span style=color:#bf616a><span class=hljs-string>ansible.builtin.file</span></span><span><span class=hljs-string>:</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>src</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ version_dir }}</span>/extract/ghq_linux_amd64/misc/zsh/_ghq</span></span><span><span class=hljs-string>"</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>dest</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>/usr/share/zsh/site-functions/_ghq</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>state</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>link</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>force</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#d08770><span class=hljs-literal>yes</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>owner</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>root</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>group</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>root</span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>become</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#d08770><span class=hljs-literal>yes</span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>become_method</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>sudo</span>
</span><span>
</span><span><span class=hljs-attr>- </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>set</span> <span class=hljs-string>GHQ_ROOT</span> <span class=hljs-string>in</span> <span class=hljs-string>zshenv</span>
</span><span>  </span><span style=color:#bf616a><span class=hljs-string>ansible.builtin.lineinfile</span></span><span><span class=hljs-string>:</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>path</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string><span class=hljs-template-variable>{{ ansible_env.HOME }}</span>/.zshenv</span></span><span><span class=hljs-string>"</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>search_string</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>GHQ_ROOT</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>line</span></span><span><span class=hljs-attr>:</span> <span class=hljs-string>"</span></span><span style=color:#a3be8c><span class=hljs-string>export GHQ_ROOT=<span class=hljs-template-variable>{{ ghq.root }}</span></span></span><span><span class=hljs-string>"</span>
</span></code></pre>
<p>As you can see, it's mostly identical to the <code>pet</code> playbook — invoking <code>github_release</code> and symlinking the binary and completions files. Instead of a config file, we set the environment variable in <code>~/.zshenv</code> (<code>bash</code> users would set the <code>lineinfile</code> path to <code>~/.bash_profile</code>).</p>
<p>If you want a specific version of <code>ghq</code>, instead of "latest", you could specify the <code>version</code> as a <code>var</code> in the task, for example:</p>
<pre data-lang=yml style=background-color:#2b303b;color:#c0c5ce class="language-yml code-badge-pre"><div class=code-badge>
        <div class=code-badge-language>yml</div>
        <div title="Copy to clipboard">
            <i class="gg-clipboard code-badge-copy-icon"></i>
        </div>
     </div><code class="language-yml hljs yaml" data-lang=yml><span><span class=hljs-attr>- </span></span><span style=color:#bf616a><span class=hljs-attr>name</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>Fetch</span> <span class=hljs-string>ghq</span> <span class=hljs-string>from</span> <span class=hljs-string>GitHub</span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>include_tasks</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>github_release.yml</span>
</span><span><span class=hljs-attr>  </span></span><span style=color:#bf616a><span class=hljs-attr>vars</span></span><span><span class=hljs-attr>:</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>org</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>x-motemen</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>repo</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>ghq</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>filename_substring</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>linux_amd64</span>
</span><span><span class=hljs-attr>    </span></span><span style=color:#bf616a><span class=hljs-attr>version</span></span><span><span class=hljs-attr>:</span> </span><span style=color:#a3be8c><span class=hljs-string>v1.1.5</span>
</span></code></pre>
<h2 id=conclusion>Conclusion</h2>
<p>And there you have it — an Ansible-based GitHub release package manager 😜. Obviously this is not going to replace <code>pacman</code> or <code>homebrew</code> anytime soon, but for simple CLI applications in heterogeneous environments I've found this to be a good-enough quick-and-dirty solution. </p>
 </div>
 
 <footer class=post-info style=display:none!important>
 
 <p style=display:none!important><svg xmlns=http://www.w3.org/2000/svg width=24 height=24 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1=16 y1=13 x2=8 y2=13></line><line x1=16 y1=17 x2=8 y2=17></line><polyline points="10 9 9 9 8 9"></polyline></svg>2072 Words</p>
 
 <p style=display:none!important><svg xmlns=http://www.w3.org/2000/svg width=24 height=24 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round class="feather feather-calendar"><rect x=3 y=4 width=18 height=18 rx=2 ry=2></rect><line x1=16 y1=2 x2=16 y2=6></line><line x1=8 y1=2 x2=8 y2=6></line><line x1=3 y1=10 x2=21 y2=10></line></svg>2021-11-02</p>
 
 </footer>
 </article>
 
 
 <div class="post-nav thin" style=display:none!important>
 
 <a class=next-post href=https://corymollet.com/posts/nb-notes-that-dont-suck/ style=display:none!important>
 <span class=post-nav-label style=display:none!important>
 <svg xmlns=http://www.w3.org/2000/svg width=24 height=24 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round class="feather feather-arrow-left">
 <line x1=19 y1=12 x2=5 y2=12></line>
 <polyline points="12 19 5 12 12 5"></polyline>
 </svg>&nbsp;Newer</span>
 
 </a>
 
 
 <a class=prev-post href=https://corymollet.com/posts/packer-virtualbox-iso-builder/ style=display:none!important>
 <span class=post-nav-label style=display:none!important>Older&nbsp;<svg xmlns=http://www.w3.org/2000/svg width=24 height=24 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round class="feather feather-arrow-right"><line x1=5 y1=12 x2=19 y2=12></line><polyline points="12 5 19 12 12 19"></polyline></svg></span>
 
 </a>
 
 </div>
 
</main>
 
 
 
<footer id=site-footer class="section-inner thin animated fadeIn faster" style=display:none!important>
 
 <p style=display:none!important>Made with · Theme 
 
 · <a href=https://corymollet.com/atom.xml target=_blank title=rss style=display:none!important><svg xmlns=http://www.w3.org/2000/svg width=24 height=24 viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx=5 cy=19 r=1></circle></svg></a>
 
 </p>
</footer>
 
 
 
 
 
 
 
 
 <style>.hljs{display:block;overflow-x:auto;padding:0.5em;background:#1E1E1E;color:#DCDCDC;font-weight:normal;font-size:1.15em!important}.hljs-literal{color:#569CD6}.hljs-number{color:#B8D7A3}.hljs-string{color:#D69D85}.hljs-comment{color:#57A64A;font-style:italic}.hljs-meta{color:#9B9B9B}.hljs-template-variable{color:#BD63C5}.hljs-attr{color:#9CDCFE}.hljs-bullet,.hljs-selector-tag,.hljs-selector-class{color:#D7BA7D}</style>
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
<style class=sf-hidden>.code-badge-pre{position:relative}.code-badge{display:flex;flex-direction:row;white-space:normal;background:#333;color:white;font-size:0.875em;opacity:0.5;transition:opacity linear 0.5s;border-radius:0 0 0 7px;padding:5px 8px 5px 8px;position:absolute;right:0;top:0}.code-badge:hover{opacity:.95}.code-badge-language{margin-right:10px;font-weight:600;color:goldenrod}.code-badge-copy-icon{font-size:1.2em;cursor:pointer;padding:0 7px}</style>