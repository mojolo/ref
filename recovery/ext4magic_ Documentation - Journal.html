<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"> <html><!--
 Page saved with SingleFile 
 url: http://ext4magic.sourceforge.net/journal_en.html 
 saved date: Thu Jan 23 2020 01:12:30 GMT+0000 (Coordinated Universal Time)
--><meta charset=utf-8><style class="darkreader darkreader--user-agent" media=screen>[data-darkreader-inline-bgcolor]{background-color:var(--darkreader-inline-bgcolor)!important}[data-darkreader-inline-border-bottom]{border-bottom-color:var(--darkreader-inline-border-bottom)!important}[data-darkreader-inline-border-left]{border-left-color:var(--darkreader-inline-border-left)!important}[data-darkreader-inline-border-right]{border-right-color:var(--darkreader-inline-border-right)!important}[data-darkreader-inline-border-top]{border-top-color:var(--darkreader-inline-border-top)!important}html{background-color:#2f2f2e!important}html,body{background-color:#2f2f2e}html,body{border-color:#837f79;color:#ffffff}a{color:#6ec8ff}table{border-color:#74716b}::placeholder{color:#fffbe4}::selection{background-color:#2983ed;color:#ffffff}::-moz-selection{background-color:#2983ed;color:#ffffff}::-webkit-scrollbar{background-color:#343433;color:#fffff5}::-webkit-scrollbar-thumb{background-color:#474745}::-webkit-scrollbar-corner{background-color:#2f2f2e}*{scrollbar-color:#474745 #343433}</style>
<title></title>
<meta name=GENERATOR content="LibreOffice 3.5  (Linux)">
<meta name=CREATED content=20140327;22421200>
<meta name=CHANGED content=20140415;3363600>
<style><!--@page{margin:2cm}TD P{margin-bottom:0cm}H1{margin-bottom:0.21cm}H1.western{font-family:"Liberation Serif",serif}P{margin-bottom:0.21cm}H2{margin-bottom:0.21cm}H3{margin-bottom:0.21cm}H4{margin-bottom:0.21cm}A:link{so-language:zxx}--></style>
<style class="darkreader darkreader--override" media=screen>::placeholder{opacity:0.5!important}</style><link type=image/x-icon rel="shortcut icon" href="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></head>
<body dir=LTR lang=de-DE>
<h1 class=western><a name=firstHeading style=display:none!important></a>Ext4magic-Journal</h1>
<div id=bodyContent dir=LTR>
 <p><br><br>
 </p>
 <div id=mw-content-text dir=LTR>
 <center>
 <table style=--darkreader-inline-bgcolor:#2f2f2e data-darkreader-inline-bgcolor width=100% cellspacing=0 cellpadding=5 bgcolor=#ffffff>
 <tbody><tr>
 <td style="border:medium none;padding:0cm;--darkreader-inline-border-top:currentcolor;--darkreader-inline-border-right:currentcolor;--darkreader-inline-border-bottom:currentcolor;--darkreader-inline-border-left:currentcolor" data-darkreader-inline-border-top data-darkreader-inline-border-right data-darkreader-inline-border-bottom data-darkreader-inline-border-left>
 <p><b><a href=http://ext4magic.sourceforge.net/ext4magic_en.html>Ext4magic</a>:</b> <a href=http://ext4magic.sourceforge.net/inode_en.html>Inode</a>
 - <a href=http://ext4magic.sourceforge.net/directory_en.html>Directory</a> - <strong>Journal</strong>
 - <a href=http://ext4magic.sourceforge.net/install_en.html>Install</a> - <a href=http://ext4magic.sourceforge.net/time-options_en.html>Time_Options</a>
 - <a href=http://ext4magic.sourceforge.net/histogram_en.html>Histogram</a> - <a href=http://ext4magic.sourceforge.net/howto_en.html>Scenarios</a>
 - <a href=http://ext4magic.sourceforge.net/tips_en.html>Tips&amp;Tricks</a> - <a href=http://ext4magic.sourceforge.net/manpage_en.html>Manpage</a>
 - <a href=http://ext4magic.sourceforge.net/expert-mode_en.html>Expert-Mode</a> 
 </p>
 </td>
 </tr>
 </table>
 </center>
 <p><br><br>
 </p>
 <p><br><br>
 </p><a name=toc></a>
 <table width=663 cellspacing=0 cellpadding=0>
 <colgroup><col width=663>
 <tbody><tr>
 <td style="border:medium none;padding:0cm;--darkreader-inline-border-top:currentcolor;--darkreader-inline-border-right:currentcolor;--darkreader-inline-border-bottom:currentcolor;--darkreader-inline-border-left:currentcolor" data-darkreader-inline-border-top data-darkreader-inline-border-right data-darkreader-inline-border-bottom data-darkreader-inline-border-left width=663>
 <div id=toctitle dir=LTR>
 <h2 class=western>Contents</h2>
 </div>
 <ul>
 <li><p style=margin-bottom:.5cm><a href=#The_journal_of_ext3_ext4_file_system>1
 The journal of ext3 ext4 file system</a> 
 </p>
 <ul>
 <li><p style=margin-bottom:.5cm><a href=#The_purpose_and_function_role_of_the_journal>1.1
 The purpose and function role of the journal</a> 
 </p>
 <ul>
 <li><p style=margin-bottom:.5cm><a href=#Declaration_of_transaction>1.1.1
 Declaration of transaction</a> 
 </p>
 </ul>
 <li><p style=margin-bottom:.5cm><a href=#How_many_data_are_in_such_a_journal>1.2
 How many data are in such a journal</a> 
 </p>
 <ul>
 <li><p style=margin-bottom:.5cm><a href=#What_does_trigger_the_generation_of_inode_copies>1.2.1
 What does trigger the generation of inode copies</a> 
 </p>
 <li><p style=margin-bottom:.5cm><a href=#Small_example>1.2.2
 Small example</a> 
 </p>
 <li><p style=margin-bottom:.5cm><a href=#Holes_in_the_journal>1.2.3
 Holes in the journal</a> 
 </p>
 </ul>
 <li><p style=margin-bottom:.5cm><a href=#Nice_to_know_about_the_journal>1.3
 Nice to know about the journal</a> 
 </p>
 <ul>
 <li><p><a href=#What_kind_of_journal_data_can_be_processed_by_ext4magic>1.3.1
 What kind of journal data can be processed by ext4magic</a> 
 </p>
 </ul>
 </ul>
 </ul>
 </td>
 </tr>
 </table>
 <h2 class=western lang=en><a name=The_journal_of_ext3_ext4_file_system></a>
 The journal of ext3 ext4 file system</h2>
 <p lang=en>Simplified you could imagine the file system journal a
 task book of the file system. There is written what needs to be
 changed on the file system. Immediately before the change is made
 to the file system itself, the change is here written directly to
 disk. If the change in the file system then takes itself, then in
 the task book this action is marked as completed. 
 </p>
 <p><br><br>
 </p>
 <h3 class=western lang=en><a name=The_purpose_and_function_role_of_the_journal></a>
 The purpose and function role of the journal</h3>
 <p lang=en>Crash the machine during a write operation, or is
 preventing a other problems which the operating system, then can
 not complete a write request to really to drive. So it's possibly
 the file system data unfinished written and the file data blocks do
 not match with the meta data. The result: The file system is
 damaged and need repair. For ext2, which still has no journal, take
 this file system check is a long time, greater the file system is,
 the repair takes longer. After a crash, have now several large file
 systems are checked before they can be mounted and used. The boot
 process will slow down to minutes, hours .... 
 </p>
 <p lang=en>In a journal file system the repair function see now
 unexecuted orders in the journal. These orders are now easily
 processed, in which the journal data stored in the journal blocks
 are copied to the correct location in the file system. So the file
 system is restored to the consistent state. The file system meta
 data are consistent and compatible. The file system can be mounted
 and resumed. The single check and repair of the file system takes
 so only seconds, the computer is quickly ready for operation after
 a crash. 
 </p>
 <p lang=en><br>The data which included in the journal, are copies
 of the file system meta data, such as inode blocks, tables of used
 inode an blocks, and also directory data blocks and some more. A
 journal can be external to a different block device, for example:
 on a different disk. <i>(This is supported by ext4magic But it's
 still untested)</i>. But mostly, the journal is used as a invisible
 file at inode number 8 and has a fixed file size. A typical and
 quite frequently encountered size is 128MByte for a journal of a
 medium or large file system with a block size of 4096 Bytes. 
 </p>
 <p lang=en>This journal has a small administrative head (1 or 2
 blocks) and the remaining blocks will be used as a ring buffer for
 the journal data. On a journal of 128MByte size and a block size of
 4KByte are available 32767 blocks for the journal data. 
 </p>
 <p><br><br>
 </p>
 <h4 class=western lang=en><a name=Declaration_of_transaction></a>
 Declaration of transaction</h4>
 <p lang=en>Depending on the amount of a certain number of changes
 to be written, the file system blocks packed together into a kind
 of virtual packet and sequentially written to the journal. Such a
 package is called <b>transaction</b> and has a serial number in the
 journal. The first block of a transaction is a table "in this
 transaction which journal block is a copy of which file system
 block". A transaction can be only one block copy, but can also
 include many block copies, depending on how much things have just
 changed the file system. 
 </p>
 <p lang=en>ext4magic has a function to display the contents of
 the journals and the transaction numbers. 
 </p>
 <pre class=western> <span lang=en>ROBI@LINUX:~ # ext4magic /dev/sda3 -T -x  | head -15</span>
<span lang=en>Filesystem in use: /dev/sda3</span>

<span lang=en>Using internal Journal at Inode 8</span>

<span lang=en>Found 24318 copy of Filesystemblock in Journal</span>
<span lang=en>FS-Block         Journal        Transact        Time in sec     Time of Transaction</span>
      <span lang=en>528253           2          160836        1274608139      Sun May 23 11:48:59 2010</span>
      <span lang=en>526364           3          160836        1274608142      Sun May 23 11:49:02 2010</span>
      <span lang=en>528252           4          160836        1274608144      Sun May 23 11:49:04 2010</span>
      <span lang=en>530214           5          160836        1274608139      Sun May 23 11:48:59 2010</span>
      <span lang=en>528644           6          160836        1274608143      Sun May 23 11:49:03 2010</span>
      <span lang=en>529252           7          160836        1274608139      Sun May 23 11:48:59 2010</span>
      <span lang=en>528109           8          160836        1274608139      Sun May 23 11:48:59 2010</span>
      <span lang=en>527224           9          160836        1274608139      Sun May 23 11:48:59 2010</span>
      <span lang=en>531243          10          160836        1274608139      Sun May 23 11:48:59 2010</span></pre><p lang=en>
 This was cut off here in the output, there are over 32000 blocks in
 the journal, this is a long list. 
 </p>
 <dl>
 <dt style=margin-bottom:.5cm lang=en>The meaning of the
 columns 
 </dl>
 <ol>
 <li><p style=margin-bottom:0cm lang=en>
 Column: the file system block number from which the copy is 
 </p>
 <li><p style=margin-bottom:0cm lang=en>Column: the journal
 block number of this block copy 
 </p>
 <li><p style=margin-bottom:0cm lang=en>Column: the
 transaction number for this copy 
 </p>
 <li><p style=margin-bottom:0cm lang=en>Column: (only for
 inode blocks), the largest timestamp of any inode in this block 
 </p>
 <li><p lang=en>Column: the time from the previous column in a
 different format 
 </p>
 </ol>
 <p lang=en>The times only available for optional use of the <b>"-x"</b>
 option. 
 </p>
 <p><br><br>
 </p>
 <p lang=en>ext4magic can also search selectiv for specific block
 copies. <br><b>example:</b> all copies of a specific inode or a all
 inode of a specific file 
 </p>
 <pre class=western lang=en>ROBI@LINUX:~ # ext4magic /dev/sda3 -T -x  -f etc/passwd
<span lang=en>Filesystem in use: /dev/sda3</span>

<span lang=en>Using internal Journal at Inode 8</span>
<span lang=en>Inode found "etc/passwd"   565</span>
<span lang=en>Inode 565 is at group 0, block 1092, offset 1024</span>

<span lang=en>Transactions of Filesystemblock 1092 in Journal</span>
<span lang=en>FS-Block         Journal        Transact        Time in sec     Time of Transaction</span>
        <span lang=en>1092         534          160841        1274608166      Sun May 23 11:49:26 2010</span>
        <span lang=en>1092         611          160842        1274608168      Sun May 23 11:49:28 2010</span>
        <span lang=en>1092        9282          160664        1274559675      Sat May 22 22:21:15 2010</span>
        <span lang=en>1092        9468          160673        1274559723      Sat May 22 22:22:03 2010</span>
        <span lang=en>1092        9922          160716        1274560203      Sat May 22 22:30:03 2010</span>
        <span lang=en>1092       21004          140650        1272749403      Sat May  1 23:30:03 2010</span>
        <span lang=en>1092       21621          140659        1272749466      Sat May  1 23:31:06 2010</span>
        <span lang=en>1092       21697          140663        1272749467      Sat May  1 23:31:07 2010</span></pre><p>
 <br><br>
 </p>
 <p><br><br>
 </p>
 <h3 class=western lang=en><a name=How_many_data_are_in_such_a_journal></a>
 How many data are in such a journal</h3>
 <p lang=en>In theory, assuming 4 KByte block size, journal size
 128 MByte and an inode size of 265 Bytes: there would be
 theoretically up to 500000 inode copies. A 24 GByte ext3/4 file
 system created with the default values has already three times of
 this amount of inodes. However, have inode in a ext3/4 file system
 and used inodes are two things. The number of used files determines
 how many inode be really used. But is not only stored inode blocks
 in the Journal. Also other administrative blocks of the file system
 have copies there. Often are of particular files many inode copies
 exist, for example: if the file has changed many times. 
 </p>
 <p lang=en>The journal is used as a ring buffer, this means, is
 no more space available on the journal, the oldest data are
 overwritten, and so on. 
 </p>
 <p><br><br>
 </p>
 <h4 class=western lang=en><a name=What_does_trigger_the_generation_of_inode_copies></a>
 What does trigger the generation of inode copies</h4>
 <p lang=en>Any change of a file cause a copy of the inode block
 which contains the inode of these file. Changes are for example:
 creation or deletion of files, modify and edding content, rename or
 move, modify the owner or permissions. But that's not all.<br>If
 the file system used with the default options, then any reading of
 a file change the atime timestamp of this file. And this change the
 inode data, and even then a copy of the inode block writen to
 journal. And that's a lot, each file and each directory that will
 be used must be read. Much program use a lot of configuration files
 or need and use a variety of other programs and files. Each of the
 touched files then changes the atime. Thus, many inode block copies
 written to the journal, without that the user intentionally caused
 this. For example, the command "<b>find</b>" reads
 recursiv all directory inode, or a backup read all files of the
 file system and thus produces a current copy of everey used inode
 in the journal or a "grep" read all files in the
 directory, or a background process automatically indexes all the
 multimedia files of a user home, etc. When a inode change, is
 always written the entire inode block. (a block has typically 16
 inode) Thus, the journal always contain many inode copies of
 visited areas of the file system. 
 </p>
 <p><br><br>
 </p>
 <h4 class=western lang=en><a name=Small_example></a>Small
 example</h4>
 <p lang=en>Tested with the data of a backup from a newly
 installed openSUSE (over 100000 files on 6000 directories,
 installation size 3.5 GByte) tested on a new 130 GByte file system,
 ext4, 4 KByte block size and 128 MByte journal size. 
 </p>
 <ul>
 <li><dd lang=en>Recover the complete backup to the newly created
 file system has occupied 98% of the journal, so all inode blocks
 and all directory blocks and all the other metadata of the file
 system where fitted perfectly into the journal. 
 <li><dd lang=en>
 A subsequent recursive "find" through the entire file
 system, has required 10% of the capacity of the journal, (written
 here all inode blocks contain the inode directory). 
 <li><dd lang=en>
 A full backup of this file system to "/dev/null" has
 required 30% of the journal, (these were all used inode blocks). 
 <li><dd style=margin-bottom:.5cm lang=en>
 A recursive delete of the whole file system has required also
 around 30% of the journal. (written here also all inode blocks and
 some bitmap blocks. This inode blocks contain mostly deleted inode
 and this can not be used for recover of files. For ext4magic there
 usable only the block bitmap copies in the file carving function
 of the Magic-Function) 
 </ul>
 <p><br><br>
 </p>
 <h4 class=western lang=en><a name=Holes_in_the_journal></a>Holes
 in the journal</h4>
 <p lang=en>To her we are always assume the journal operates as a
 ring buffer and overwrites only the oldest data. That's true but
 only partly. This is only true so long as the file system is
 mounted. <br>By a new mount the journal is not written further at
 the last position. Then always the journal is written at the
 beginning. This will overwrite journal data although even older
 data in the middle or at the end of the journal are available. When
 a system will mount or reboot at short intervals, and during the
 mount only a few data are written to the journal, then always only
 the blocks at the beginning of the journal are used. This will
 always overwrite the data from the last mount. At the end of the
 journal are very old journal data and from a larger range of time
 no journal data are available. This creates holes in time and
 fragments the usable journal data. The capacity for useful related
 information of the journal is then low. Then ext4magic can not find
 all files and directories of the last days, but can recover very
 very old inode copies. (but often with a wrong file content)<br>This
 is intensified by the fact, if the first block of an old
 transaction is overwritten, all blocks of this old transaction are
 invalid. It is impossible to determine from which block this is are
 copies. For large overwritten transactions many old journals blocks
 are useless. 
 </p>
 <p><br><br>
 </p>
 <p><br><br>
 </p>
 <h3 class=western lang=en><a name=Nice_to_know_about_the_journal></a>
 Nice to know about the journal</h3>
 <ul>
 <li><dd lang=en>There are many inode copies of visited areas of
 the file system 
 <li><dd lang=en>
 Not for all files are always copies available 
 <li><dd lang=en>
 Some files have multiple or even very many inode copies in the
 journal 
 <li><dd lang=en>
 File system areas were not used for a long time, possible for that
 not exist inode copies in the journal 
 <li><dd lang=en>
 Not only writing also reading of files write inode copies to the
 journal 
 <li><dd lang=en>
 New journal data overwrites the oldest journal data, but not
 always the oldest after a new mount 
 <li><dd lang=en>
 Short and often mount intervals generate not optimal journal data
 for a recover 
 <li><dd lang=en>
 Large deletions write big ranges to the journal with not usable
 inode copies for recover of files 
 <li><dd lang=en>
 Do not mount the file system before you recover. You can destroy a
 transaction head of a big transaction 
 <li><dd style=margin-bottom:.5cm lang=en>
 After you have lost files, do not use many read commands that
 touch lots of files, this can overwrite inode copies what you want
 to recover 
 </ul>
 <p><br><br>
 </p>
 <h4 class=western lang=en><a name=What_kind_of_journal_data_can_be_processed_by_ext4magic></a>
 What kind of journal data can be processed by ext4magic</h4>
 <ul>
 <li><dd lang=en>all copies of undeleted inode can use for
 recovery directly (be written when creating, change or reading
 files) 
 <li><dd lang=en>
 copies of directory blocks can help to find delete or moved
 direcory trees (be only written when creating, change ore delete
 files) 
 <li><dd lang=en>
 copies of block bitmap of the last delete process be used in the
 file carving function of the Magic-Function (written by the last
 delete process, no creating should be done later) 
 <li><dd style=margin-bottom:.5cm lang=en>
 some undeleted inode copies can use for a recover although the
 journal block is from an old partial overwritten transaction. The
 file is deleted but it's impossible to determine the inode number,
 the file name and delete time of this file. (The output of the
 recover function has the headline "lost in journal" and
 the recovered files can find at "MAGIC-2/" ) 
 </ul>
 <p><br><br>
 </p>
 <p><br><br>
 </p>
 <center>
 <table style=--darkreader-inline-bgcolor:#2f2f2e data-darkreader-inline-bgcolor width=100% cellspacing=0 cellpadding=5 bgcolor=#ffffff>
 <tbody><tr>
 <td style="border:medium none;padding:0cm;--darkreader-inline-border-top:currentcolor;--darkreader-inline-border-right:currentcolor;--darkreader-inline-border-bottom:currentcolor;--darkreader-inline-border-left:currentcolor" data-darkreader-inline-border-top data-darkreader-inline-border-right data-darkreader-inline-border-bottom data-darkreader-inline-border-left>
 <p><b><a href=http://ext4magic.sourceforge.net/ext4magic_en.html>Ext4magic</a>:</b> <a href=http://ext4magic.sourceforge.net/inode_en.html>Inode</a>
 - <a href=http://ext4magic.sourceforge.net/directory_en.html>Directory</a> - <strong>Journal</strong>
 - <a href=http://ext4magic.sourceforge.net/install_en.html>Install</a> - <a href=http://ext4magic.sourceforge.net/time-options_en.html>Time_Options</a>
 - <a href=http://ext4magic.sourceforge.net/histogram_en.html>Histogram</a> - <a href=http://ext4magic.sourceforge.net/howto_en.html>Scenarios</a>
 - <a href=http://ext4magic.sourceforge.net/tips_en.html>Tips&amp;Tricks</a> - <a href=http://ext4magic.sourceforge.net/manpage_en.html>Manpage</a>
 - <a href=http://ext4magic.sourceforge.net/expert-mode_en.html>Expert-Mode</a> 
 </p>
 </td>
 </tr>
 </table>
 </center>
 <p><br><br>
 </p>
 </div>
</div>
