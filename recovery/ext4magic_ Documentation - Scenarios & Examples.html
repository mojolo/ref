<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"> <html><!--
 Page saved with SingleFile 
 url: http://ext4magic.sourceforge.net/howto_en.html 
 saved date: Thu Jan 23 2020 01:14:45 GMT+0000 (Coordinated Universal Time)
--><meta charset=utf-8><style class="darkreader darkreader--user-agent" media=screen>[data-darkreader-inline-bgcolor]{background-color:var(--darkreader-inline-bgcolor)!important}[data-darkreader-inline-border-bottom]{border-bottom-color:var(--darkreader-inline-border-bottom)!important}[data-darkreader-inline-border-left]{border-left-color:var(--darkreader-inline-border-left)!important}[data-darkreader-inline-border-right]{border-right-color:var(--darkreader-inline-border-right)!important}[data-darkreader-inline-border-top]{border-top-color:var(--darkreader-inline-border-top)!important}html{background-color:#2f2f2e!important}html,body{background-color:#2f2f2e}html,body{border-color:#837f79;color:#ffffff}a{color:#6ec8ff}table{border-color:#74716b}::placeholder{color:#fffbe4}::selection{background-color:#2983ed;color:#ffffff}::-moz-selection{background-color:#2983ed;color:#ffffff}::-webkit-scrollbar{background-color:#343433;color:#fffff5}::-webkit-scrollbar-thumb{background-color:#474745}::-webkit-scrollbar-corner{background-color:#2f2f2e}*{scrollbar-color:#474745 #343433}</style>
<title></title>
<meta name=GENERATOR content="LibreOffice 3.5  (Linux)">
<meta name=CREATED content=20140327;22512400>
<meta name=CHANGED content=20140415;3343000>
<style><!--@page{margin:2cm}TD P{margin-bottom:0cm}H1{margin-bottom:0.21cm}H1.western{font-family:"Liberation Serif",serif}P{margin-bottom:0.21cm}H2{margin-bottom:0.21cm}H3{margin-bottom:0.21cm}H4{margin-bottom:0.21cm}A:link{so-language:zxx}--></style>
<style class="darkreader darkreader--override" media=screen>::placeholder{opacity:0.5!important}</style><link type=image/x-icon rel="shortcut icon" href="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></head>
<body dir=LTR lang=de-DE>
<h1 class=western><a name=firstHeading style=display:none!important></a>Ext4magic-Howto</h1>
<div id=bodyContent dir=LTR>
 <p><br><br>
 </p>
 <div id=contentSub dir=LTR>
 <p><br><br>
 </p>
 </div>
 <div id=mw-content-text dir=LTR>
 <center>
 <table style=--darkreader-inline-bgcolor:#2f2f2e data-darkreader-inline-bgcolor width=100% cellspacing=0 cellpadding=5 bgcolor=#ffffff>
 <tbody><tr>
 <td style="border:medium none;padding:0cm;--darkreader-inline-border-top:currentcolor;--darkreader-inline-border-right:currentcolor;--darkreader-inline-border-bottom:currentcolor;--darkreader-inline-border-left:currentcolor" data-darkreader-inline-border-top data-darkreader-inline-border-right data-darkreader-inline-border-bottom data-darkreader-inline-border-left>
 <p><b><a href=http://ext4magic.sourceforge.net/ext4magic_en.html>Ext4magic</a>:</b> <a href=http://ext4magic.sourceforge.net/inode_en.html>Inode</a>
 - <a href=http://ext4magic.sourceforge.net/directory_en.html>Directory</a> - <a href=http://ext4magic.sourceforge.net/journal_en.html>Journal</a>
 - <a href=http://ext4magic.sourceforge.net/install_en.html>Install</a> - <a href=http://ext4magic.sourceforge.net/time-options_en.html>Time_Options</a>
 - <a href=http://ext4magic.sourceforge.net/histogram_en.html>Histogram</a> - <strong>Scenarios</strong>
 - <a href=http://ext4magic.sourceforge.net/tips_en.html>Tips&amp;Tricks</a> - <a href=http://ext4magic.sourceforge.net/manpage_en.html>Manpage</a>
 - <a href=http://ext4magic.sourceforge.net/expert-mode_en.html>Expert-Mode</a> 
 </p>
 </td>
 </tr>
 </table>
 </center>
 <p><br><br>
 </p><a name=toc></a>
 <table width=831 cellspacing=0 cellpadding=2>
 <colgroup><col width=827>
 <tbody><tr>
 <td style="border:medium none;padding:0cm;--darkreader-inline-border-top:currentcolor;--darkreader-inline-border-right:currentcolor;--darkreader-inline-border-bottom:currentcolor;--darkreader-inline-border-left:currentcolor" data-darkreader-inline-border-top data-darkreader-inline-border-right data-darkreader-inline-border-bottom data-darkreader-inline-border-left width=827>
 <div id=toctitle dir=LTR>
 <h2 class=western>Contents</h2>
 </div>
 <ul>
 <li><p style=margin-bottom:.5cm><a href=#Typical_usage_scenarios_of_ext4magic>1
 Typical usage scenarios of ext4magic</a> 
 </p>
 <ul>
 <li><p style=margin-bottom:.5cm><a href=#Whole_filesystem_was_deleted_recursively_with_.22rm.22>1.1
 Whole filesystem was deleted recursively with "rm"</a>
 </p>
 <ul>
 <li><p style=margin-bottom:.5cm><a href=#What_happened>1.1.1
 What happened</a> 
 </p>
 <li><p style=margin-bottom:.5cm><a href=#Recommended_immediate_actions>1.1.2
 Recommended immediate actions</a> 
 </p>
 <li><p style=margin-bottom:.5cm><a href=#Recovery_setup>1.1.3
 Recovery setup</a> 
 </p>
 <li><p style=margin-bottom:.5cm><a href=#Recovery_process>1.1.4
 Recovery process</a> 
 </p>
 </ul>
 <li><p style=margin-bottom:.5cm><a href=#Whole_file_system_was_deleted_recursively_with_a_long_sequence_of_single_deletions>1.2
 Whole file system was deleted recursively with a long sequence
 of single deletions</a> 
 </p>
 <ul>
 <li><p style=margin-bottom:.5cm><a href=#What_happened_2>1.2.1
 What happened</a> 
 </p>
 <li><p style=margin-bottom:.5cm><a href=#Recovery_process_2>1.2.2
 Recovery process</a> 
 </p>
 </ul>
 <li><p style=margin-bottom:.5cm><a href=#A_directory_with_a_huge_amount_of_files_is_recursive_deleted>1.3
 A directory with a huge amount of files is recursive deleted</a>
 </p>
 <ul>
 <li><p style=margin-bottom:.5cm><a href=#What_happened_3>1.3.1
 What happened</a> 
 </p>
 <li><p style=margin-bottom:.5cm><a href=#Recommended_immediate_actions_2>1.3.2
 Recommended immediate actions</a> 
 </p>
 <li><p style=margin-bottom:.5cm><a href=#Recovery_process_3>1.3.3
 Recovery process</a> 
 </p>
 </ul>
 <li><p style=margin-bottom:.5cm><a href=#Files_were_deleted_in_a_directory_but_unfortunately_some_of_them_should_have_been_kept>1.4
 Files were deleted in a directory but unfortunately some of
 them should have been kept</a> 
 </p>
 <ul>
 <li><p style=margin-bottom:.5cm><a href=#What_happened_4>1.4.1
 What happened</a> 
 </p>
 <li><p style=margin-bottom:.5cm><a href=#Recommended_immediate_actions_3>1.4.2
 Recommended immediate actions</a> 
 </p>
 <li><p style=margin-bottom:.5cm><a href=#Recovery_setup_and_determination_of_the_required_time_options>1.4.3
 Recovery setup and determination of the required time options</a>
 </p>
 <li><p style=margin-bottom:.5cm><a href=#Recovery_process_4>1.4.4
 Recovery process</a> 
 </p>
 </ul>
 <li><p style=margin-bottom:.5cm><a href=#Single_file_was_overridden_by_redirection_of_the_standard_output>1.5
 Single file was overridden by redirection of the standard
 output</a> 
 </p>
 <ul>
 <li><p style=margin-bottom:.5cm><a href=#What_happened_5>1.5.1
 What happened</a> 
 </p>
 <li><p style=margin-bottom:.5cm><a href=#Recommended_immediate_actions_4>1.5.2
 Recommended immediate actions</a> 
 </p>
 <li><p style=margin-bottom:.5cm><a href=#Recovery_process_5>1.5.3
 Recovery process</a> 
 </p>
 </ul>
 <li><p style=margin-bottom:.5cm><a href=#First_sectors_of_a_hard_drive_were_overwritten_by_accident>1.6
 First sectors of a hard drive were overwritten by accident</a>
 </p>
 <ul>
 <li><p style=margin-bottom:.5cm><a href=#What_happened_6>1.6.1
 What happened</a> 
 </p>
 <li><p style=margin-bottom:.5cm><a href=#Recommended_immediate_actions_5>1.6.2
 Recommended immediate actions</a> 
 </p>
 <li><p style=margin-bottom:.5cm><a href=#Recovery_process_6>1.6.3
 Recovery process</a> 
 </p>
 <ul>
 <li><p style=margin-bottom:.5cm><a href=#Recovery_setup_2>1.6.3.1
 Recovery setup</a> 
 </p>
 <li><p style=margin-bottom:.5cm><a href=#Restore_of_the_partition_table>1.6.3.2
 Restore of the partition table</a> 
 </p>
 </ul>
 <li><p><a href=#Recover_the_partial_overwritten_first_partition>1.6.4
 Recover the partial overwritten first partition</a> 
 </p>
 </ul>
 </ul>
 </ul>
 </td>
 </tr>
 </table>
 <h1 class=western lang=en><a name=Typical_usage_scenarios_of_ext4magic></a>
 Typical usage scenarios of ext4magic</h1>
 <p><br><br>
 </p>
 <h2 class=western lang=en><a name=Whole_filesystem_was_deleted_recursively_with_.22rm.22></a>
 Whole filesystem was deleted recursively with "rm" 
 </h2>
 <h3 class=western lang=en><a name=What_happened></a>What
 happened</h3>
 <dl>
 <dd lang=en><i><b>/dev/sdb1</b></i>&nbsp;; file system ext3 or
 ext4, with default options created and used with default options. 
 <dd lang=en>
 A user home directory with many pictures, documents and multimedia
 files was deleted by error with "rm-rf *" 
 <dd style=margin-bottom:.5cm lang=en>
 The deletion process was quick and took only a few seconds or
 minutes. The file system is now empty. 
 </dl>
 <p>
 <br><br>
 </p>
 <h3 class=western lang=en><a name=Recommended_immediate_actions></a>
 Recommended immediate actions</h3>
 <ul>
 <li><p lang=en>Create a copy of the journal to a different file
 system before you umount the deleted and now empty file system. 
 </p>
 </ul>
 <pre class=western lang=en>sync
<span lang=en>debugfs -R "dump &lt;8&gt; /tmp/JOURNAL.copy" /dev/sdb1</span></pre>
 <ul>
 <li><p style=margin-bottom:0cm><span lang=en>Now do not write
 to that file system on </span><span lang=en><b>/dev/sdb1</b></span>
 <span lang=en>any more and execute no </span><a href=http://linux.die.net/man/8/fsck><span lang=en><b>fsck</b></span></a>
 <span lang=en>on /dev/sdb1 </span>
 </p>
 <li><p style=margin-bottom:0cm lang=en>Prevent a automatic
 mount on next reboot, and do not mount it self again 
 </p>
 <li><p lang=en>For safety if enough free disk space available,
 create a copy of <b>/dev/sdb1</b> as a image 
 </p>
 </ul>
 <pre class=western style=margin-bottom:.5cm lang=en>dd if=/dev/sdb1 of=/tmp/PartitionCOPY_sdb1.image</pre><p>
 <br><br>
 </p>
 <h3 class=western lang=en><a name=Recovery_setup></a>Recovery
 setup</h3>
 <dl>
 <dd lang=en>Enough free disk space in another ext3/4 file system
 ins needed (example: <b>/mnt/FREE_SPACE</b>) to write the
 recovered files (recommended are 150% of the amount that has been
 deleted) 
 <dd style=margin-bottom:.5cm lang=en>
 For a deleted ext3 file system use ext4magic-0.2.4. For a deleted
 ext4 filesystem use ext4magic-0.3.0 
 </dl>
 <p>
 <br><br>
 </p>
 <h3 class=western lang=en><a name=Recovery_process></a>Recovery
 process</h3>
 <p lang=en>Recover process depends on the number and size of
 deleted files and may take a long time. 
 </p>
 <dl>
 <dd style=margin-bottom:.5cm lang=en>Restore files with
 orinal file system 
 </dl>
 <pre class=western style=margin-bottom:.5cm lang=en>ext4magic /dev/sdb1 -M -d /mnt/FREE_SPACE</pre>
 <dl>
 <dd style=margin-bottom:.5cm lang=en>
 If you want to use the journal copy instead of the journal of the
 file system 
 </dl>
 <pre class=western style=margin-bottom:.5cm lang=en>ext4magic /dev/sdb1 -j /tmp/JOURNAL.copy -M -d /mnt/FREE_SPACE</pre>
 <dl>
 <dd style=margin-bottom:.5cm lang=en>
 If you want to use the image of the file system 
 </dl>
 <pre class=western style=margin-bottom:.5cm lang=en>ext4magic /tmp/PartitionCOPY_sdb1.image -M -d /mnt/FREE_SPACE</pre><p>
 <br><br>
 </p>
 <dl>
 <dt lang=en>Comments on the recovered files 
 <dd style=margin-bottom:.5cm lang=en>
 Different recovery procedures will be applied sequentially. Most
 of the files are stored with their original names in the correct
 directory. Other files are recovered in subdirectories
 <i><b>MAGIC-1/2/3</b></i>. The latter files in the subdirectories
 may be still incomplete and have to be inspected manually for
 completeness. 
 </dl>
 <p>
 <br><br>
 </p>
 <p><br><br>
 </p>
 <h2 class=western lang=en><a name=Whole_file_system_was_deleted_recursively_with_a_long_sequence_of_single_deletions></a>
 Whole file system was deleted recursively with a long sequence of
 single deletions</h2>
 <h3 class=western lang=en><a name=What_happened_2></a>What
 happened</h3>
 <p lang=en>The whole file system is deleted. The deletion process
 took longer than 5 minutes.<br>The reason why this has required a
 long time, could be: 
 </p>
 <ul>
 <li><p style=margin-bottom:0cm lang=en>Slow hard drive and a
 lot of files 
 </p>
 <li><p style=margin-bottom:0cm><span lang=en>Deletion is
 usually been kicked off by commands like </span><a href=http://linux.die.net/man/1/mv><span lang=en><i><b>mv</b></i></span></a>
 <span lang=en>or </span><a href=http://linux.die.net/man/1/rsync><span lang=en><i><b>rsync</b></i></span></a>
 <span lang=en>or by scripts that delete step by step </span>
 </p>
 <li><p style=margin-bottom:0cm lang=en>Several log running
 processes which delete files or directories are executed in
 sequence 
 </p>
 <li><p style=margin-bottom:0cm lang=en>Some deleted files
 were still open by processes (These files are deleted later when
 this process is terminated) 
 </p>
 <li><p lang=en>The operating system or other programs have
 changed or deleted some files in this filesystem after deletion
 even before the umount. 
 </p>
 </ul>
 <p><br><br>
 </p>
 <h3 class=western lang=en><a name=Recovery_process_2></a>Recovery
 process</h3>
 <p><span lang=en>The recovery process is identical as in <a href=#Whole_filesystem_was_deleted_recursively_with_.22rm.22>scenario
 1</a>. In addition the time parameter has to be used. </span><span lang=en><b>AFTER
 time</b></span> <span lang=en>parameter has to be a few seconds
 before the first file was deleted. If the </span><span lang=en><b>AFTER
 time</b></span> <span lang=en>parameter is not used ext4magic
 will recover only files which were deleted the last 5 minutes of
 the whole deletion process. </span>
 </p>
 <pre class=western style=margin-bottom:.5cm lang=en>ext4magic /dev/sdb1 -M -d /mnt/FREE_SPACE -a 1330465566</pre><p>
 <span lang=en>Use <a href=http://ext4magic.sourceforge.net/histogram_en.html>histogram function</a>
 to find the exact time to use for </span><span lang=en><b>AFTER
 time</b></span><span lang=en>. </span>
 </p>
 <p><br><br>
 </p>
 <h2 class=western lang=en><a name=A_directory_with_a_huge_amount_of_files_is_recursive_deleted></a>
 A directory with a huge amount of files is recursive deleted 
 </h2>
 <dl>
 <dd style=margin-bottom:.5cm lang=en>but other directories
 with many other files are not deleted and are still available 
 </dl>
 <p>
 <br><br>
 </p>
 <h3 class=western lang=en><a name=What_happened_3></a>What
 happened</h3>
 <dl>
 <dd style=margin-bottom:.5cm lang=en>A directory tree was
 deleted only. There are still also many undeleted files in the
 file system. The deletion has been noted, and then no longer
 written into the file system. 
 </dl>
 <p>
 <br><br>
 </p>
 <h3 class=western lang=en><a name=Recommended_immediate_actions_2></a>
 Recommended immediate actions</h3>
 <dl>
 <dd style=margin-bottom:.5cm><span lang=en>See also <a href=#Whole_filesystem_was_deleted_recursively_with_.22rm.22>scenario
 1</a>. The best way is to create a journal copy immediately if
 possible. Now not only writes and mounts destroy the journal data,
 also normal read or find processes and also in the background
 running processes on open files can destroy journal data. </span>
 </dl>
 <p>
 <br><br>
 </p>
 <h3 class=western lang=en><a name=Recovery_process_3></a>Recovery
 process</h3>
 <p><span lang=en>Method and all as in <a href=#Whole_filesystem_was_deleted_recursively_with_.22rm.22>scenario
 1</a>, but now use not </span><span lang=en><b>-M </b></span><span lang=en>,
 this would recover all undeleted files also. Here you should use
 the </span><span lang=en><b>-m</b></span> <span lang=en>option
 instead. This will only search for deleted files and deleted data
 areas. If it was a longer deletion process or you don't know for
 sure whether some additional data was written after the deletion
 process, use the AFTER option and use the time just before the
 deletion has started. </span>
 </p>
 <p><br><br>
 </p>
 <h2 class=western lang=en><a name=Files_were_deleted_in_a_directory_but_unfortunately_some_of_them_should_have_been_kept></a>
 Files were deleted in a directory but unfortunately some of them
 should have been kept</h2>
 <h3 class=western lang=en><a name=What_happened_4></a>What
 happened</h3>
 <ul>
 <li><p style=margin-bottom:0cm lang=en>ext3 home filesystem
 <b>/dev/sda6</b> in the directory "/home/rob/Bilder/"
 images were deleted. 
 </p>
 <li><p style=margin-bottom:0cm lang=en>It should only be
 deleted pictures with the extension <b>"*. jpg_"</b> 
 </p>
 <li><p style=margin-bottom:0cm lang=en>But all the pictures
 <b>"*.jpg"</b> now deleted 
 </p>
 <li><p style=margin-bottom:0cm lang=en>A lot of other images
 and directories are still there, these are okay 
 </p>
 <li><p lang=en>The error was noticed quickly 
 </p>
 </ul>
 <p><br><br>
 </p>
 <h3 class=western lang=en><a name=Recommended_immediate_actions_3></a>
 Recommended immediate actions</h3>
 <ul>
 <li><p style=margin-bottom:0cm lang=en>For precaution, create
 a copy of the journal 
 </p>
 <li><p style=margin-bottom:0cm lang=en>All users must logoff 
 </p>
 <li><p style=margin-bottom:0cm lang=en>Switch to runlevel 3 
 </p>
 <li><p lang=en>umount the /home file system 
 </p>
 </ul>
 <pre class=western lang=en># su -
<span lang=en># debugfs -R "dump &lt;8&gt; /tmp/sda6.journal" /dev/sda6</span>
<span lang=en># init 3</span></pre><p lang=en>
 Switch now to a console and log in as root 
 </p>
 <pre class=western style=margin-bottom:.5cm lang=en># umount /home</pre><p>
 <br><br>
 </p>
 <h3 class=western lang=en><a name=Recovery_setup_and_determination_of_the_required_time_options></a>
 Recovery setup and determination of the required time options</h3>
 <ul>
 <li><p style=margin-bottom:0cm lang=en>There is enough space
 in the <b>/tmp</b> directory, we use <b>/tmp/RECOVER</b> to write
 the files.</p>
 <li><p lang=en>Deleting happened a few minutes ago and thus the
 last 20 minutes should be listed with the histogram 
 </p>
 </ul>
 <pre class=western lang=en># ext4magic /dev/sda6 -H -a (date -d "-20minutes" +%s)
<span lang=en>Filesystem in use: /dev/sda6</span>

<span lang=en>|-----------c_time  Histogram-----------------  after  --------------------  Sat Mar 24 17:23:56 2012</span>
<span lang=en>1332606356:        1 |*****                                             |   Sat Mar 24 17:25:56 2012</span>
<span lang=en>1332606476:        2 |**********                                        |   Sat Mar 24 17:27:56 2012</span>
<span lang=en>1332606596:        0 |                                                  |   Sat Mar 24 17:29:56 2012</span>
<span lang=en>1332606716:        2 |**********                                        |   Sat Mar 24 17:31:56 2012</span>
<span lang=en>1332606836:        4 |********************                              |   Sat Mar 24 17:33:56 2012</span>
<span lang=en>1332606956:        2 |**********                                        |   Sat Mar 24 17:35:56 2012</span>
<span lang=en>1332607076:        0 |                                                  |   Sat Mar 24 17:37:56 2012</span>
<span lang=en>1332607196:       10 |**************************************************|   Sat Mar 24 17:39:56 2012</span>
<span lang=en>1332607316:        0 |                                                  |   Sat Mar 24 17:41:56 2012</span>
<span lang=en>1332607436:        0 |                                                  |   Sat Mar 24 17:43:56 2012</span>


<span lang=en>|-----------d_time  Histogram-----------------  after  --------------------  Sat Mar 24 17:23:56 2012</span>
<span lang=en>1332606356:        0 |                                                  |   Sat Mar 24 17:25:56 2012</span>
<span lang=en>1332606476:        0 |                                                  |   Sat Mar 24 17:27:56 2012</span>
<span lang=en>1332606596:        0 |                                                  |   Sat Mar 24 17:29:56 2012</span>
<span lang=en>1332606716:        2 |****                                              |   Sat Mar 24 17:31:56 2012</span>
<span lang=en>1332606836:       27 |**************************************************|   Sat Mar 24 17:33:56 2012</span>
<span lang=en>1332606956:        0 |                                                  |   Sat Mar 24 17:35:56 2012</span>
<span lang=en>1332607076:        0 |                                                  |   Sat Mar 24 17:37:56 2012</span>
<span lang=en>1332607196:        9 |*****************                                 |   Sat Mar 24 17:39:56 2012</span>
<span lang=en>1332607316:        0 |                                                  |   Sat Mar 24 17:41:56 2012</span>
<span lang=en>1332607436:        0 |                                                  |   Sat Mar 24 17:43:56 2012</span>
<span lang=en>ext4magic: EXIT_SUCCESS</span></pre><p lang=en>
 27 files were deleted at <b>17:33:56</b><br>Some time later other
 files were modified or deleted. (Probably is's mostly KDE/GNOME
 files or other configuration files written during the user logout.)
 </p>
 <p lang=en>A good time window in this case is <b>AFTER</b> time
 <b>1332606716</b> (from histogram) and the default <b>BEFORE</b>
 time (now).<br>A list of all the deleted and ready to recover files
 in directory <b>rob/Bilder</b> can be created with 
 </p>
 <pre class=western lang=en># ext4magic /dev/sda6 -a 1332606716 -f rob/Bilder -l
<span lang=en>Filesystem in use: /dev/sda6</span>

<span lang=en>Using external Journal at File /tmp/sda6.journal</span>
<span lang=en>Activ Time after : Sat Mar 24 17:31:56 2012</span>
<span lang=en>Activ Time before: Sat Mar 24 17:50:20 2012</span>
<span lang=en>Inode found "rob/Bilder"   1143236</span>
<span lang=en>Inode 1143236 is allocated</span>
   <span lang=en>98%   rob/Bilder/cimg1435.jpg</span>
  <span lang=en>100%   rob/Bilder/cimg1436.jpg</span>
  <span lang=en>100%   rob/Bilder/cimg1439.jpg</span>
  <span lang=en>100%   rob/Bilder/cimg1442.jpg</span>
  <span lang=en>100%   rob/Bilder/cimg1443.jpg</span>
  <span lang=en>100%   rob/Bilder/cimg1444.jpg</span>
  <span lang=en>100%   rob/Bilder/cimg1445.jpg</span>
  <span lang=en>100%   rob/Bilder/cimg1446.jpg</span>
  <span lang=en>100%   rob/Bilder/cimg1456.jpg</span>
  <span lang=en>100%   rob/Bilder/cimg1457.jpg</span>
  <span lang=en>100%   rob/Bilder/cimg1458.jpg</span>
  <span lang=en>100%   rob/Bilder/cimg1541.jpg</span>
   <span lang=en>99%   rob/Bilder/cimg1442.jpg_</span>
  <span lang=en>100%   rob/Bilder/cimg1443.jpg_</span>
  <span lang=en>100%   rob/Bilder/cimg1444.jpg_</span>
  <span lang=en>100%   rob/Bilder/cimg1445.jpg_</span>
  <span lang=en>100%   rob/Bilder/cimg1446.jpg_</span>
<span lang=en>ext4magic: EXIT_SUCCESS</span></pre><p lang=en>
 Two files <b>cimg1435.jpg cimg1442.jpg_</b> are already corrupted
 (percentage &lt; 100%) and have overwritten/reused data blocks and
 therefore cannot be recovered with their original content. 
 </p>
 <p lang=en>To find out which files are missing in the above list,
 list the directory content. These missing files are mark as deleted
 (<i><b>&lt;</b></i><i>inodenr</i><i><b>&gt;</b></i>) and have no
 file size in the following output. There is no undeleted copy of
 the inode for these files any more in the journal so there is no
 recovery possible for these files. 
 </p>
 <pre class=western lang=en># ext4magic /dev/sda6 -a 1332606716 -f rob/Bilder
<span lang=en>....</span>
<span lang=en>&lt; 1142574&gt; _  755 (1)   1000    100              0 24-Mar-2012 17:33 cimg1433.jpg</span>
<span lang=en>&lt; 1143164&gt; _  755 (1)   1000    100              0 24-Mar-2012 17:33 cimg1434.jpg</span>
<span lang=en>&lt; 1143169&gt; _  755 (1)   1000    100        2022342 21-Feb-2010 21:27 cimg1435.jpg</span>
<span lang=en>&lt; 1143180&gt; _  755 (1)   1000    100        1871073 21-Feb-2010 21:27 cimg1436.jpg</span>
<span lang=en>&lt; 1143187&gt; _  755 (1)   1000    100              0 24-Mar-2012 17:33 cimg1437.jpg</span>
<span lang=en>&lt; 1143197&gt; _  755 (1)   1000    100              0 24-Mar-2012 17:33 cimg1438.jpg</span>
<span lang=en>&lt; 1143218&gt; _  755 (1)   1000    100        1844663 21-Feb-2010 21:27 cimg1439.jpg</span>
<span lang=en>....</span>
<span lang=en>&lt; 1143291&gt; _  755 (1)   1000    100        2066004 21-Feb-2010 21:28 cimg1458.jpg</span>
<span lang=en>&lt; 1143314&gt; _  755 (1)   1000    100              0 24-Mar-2012 17:33 cimg1459.jpg</span>
<span lang=en>&lt; 1143316&gt; _  755 (1)   1000    100              0 24-Mar-2012 17:33 cimg1460.jpg</span>
<span lang=en>&lt; 1143317&gt; _  755 (1)   1000    100              0 24-Mar-2012 17:33 cimg1461.jpg</span>
<span lang=en>&lt; 1143155&gt; _  755 (1)   1000    100              0 24-Mar-2012 17:33 cimg1537.jpg</span>
<span lang=en>&lt; 1143320&gt; _  755 (1)   1000    100              0 24-Mar-2012 17:33 cimg1538.jpg</span>
<span lang=en>&lt; 1143330&gt; _  755 (1)   1000    100              0 24-Mar-2012 17:33 cimg1539.jpg</span>
<span lang=en>&lt; 1143340&gt; _  755 (1)   1000    100              0 24-Mar-2012 17:33 cimg1540.jpg</span>
<span lang=en>....</span></pre><p>
 <br><br>
 </p>
 <h3 class=western lang=en><a name=Recovery_process_4></a>Recovery
 process</h3>
 <p lang=en>First recover all undamaged files from which a inode
 copy is available, You can use the journal copy <i>/tmp/sda6.journal</i>
 (but in this case it's not necessary) 
 </p>
 <pre class=western lang=en># ext4magic /dev/sda6 -a 1332606716 -f rob/Bilder -j /tmp/sda6.journal -r -d /tmp/RECOVER
<span lang=en>"/tmp/RECOVER"  accept for recoverdir</span>
<span lang=en>Filesystem in use: /dev/sda6</span>

<span lang=en>Using external Journal at File /tmp/sda6.journal</span>
<span lang=en>Activ Time after : Sat Mar 24 17:31:56 2012</span>
<span lang=en>Activ Time before: Sat Mar 24 17:58:05 2012</span>
<span lang=en>Inode found "rob/Bilder"   1143236</span>
<span lang=en>Inode 1143236 is allocated</span>
<span lang=en>--------        /tmp/RECOVER/rob/Bilder/cimg1436.jpg</span>
<span lang=en>--------        /tmp/RECOVER/rob/Bilder/cimg1439.jpg</span>
<span lang=en>--------        /tmp/RECOVER/rob/Bilder/cimg1442.jpg</span>
<span lang=en>--------        /tmp/RECOVER/rob/Bilder/cimg1443.jpg</span>
<span lang=en>--------        /tmp/RECOVER/rob/Bilder/cimg1444.jpg</span>
<span lang=en>--------        /tmp/RECOVER/rob/Bilder/cimg1445.jpg</span>
<span lang=en>--------        /tmp/RECOVER/rob/Bilder/cimg1446.jpg</span>
<span lang=en>--------        /tmp/RECOVER/rob/Bilder/cimg1456.jpg</span>
<span lang=en>--------        /tmp/RECOVER/rob/Bilder/cimg1457.jpg</span>
<span lang=en>--------        /tmp/RECOVER/rob/Bilder/cimg1458.jpg</span>
<span lang=en>--------        /tmp/RECOVER/rob/Bilder/cimg1541.jpg</span>
<span lang=en>--------        /tmp/RECOVER/rob/Bilder/cimg1443.jpg_</span>
<span lang=en>--------        /tmp/RECOVER/rob/Bilder/cimg1444.jpg_</span>
<span lang=en>--------        /tmp/RECOVER/rob/Bilder/cimg1445.jpg_</span>
<span lang=en>--------        /tmp/RECOVER/rob/Bilder/cimg1446.jpg_</span>
<span lang=en>ext4magic: EXIT_SUCCESS</span></pre><p lang=en>
 15 lost JPEG files were recovered successfully. Actually only 11
 files should have been recovered because the files with a trailing
 _ were deleted by intention. They have to be deleted manually form
 /tmp/RECOVER/rob/Bilder. 
 </p>
 <p lang=en>In this case, not all the lost files were restored.
 You can try to restore some more files with the magic-function of
 ext3magic. In this case the file system is ext3 and ext4magic-0.2.4
 is required. (For an ext4 filesystem ext4magic-0.3.0 is
 required)<br>Check the ext4magic version with with 
 </p>
 <pre class=western lang=en># ext4magic -V -x
<span lang=en>ext4magic  version: 0.2.4</span>
<span lang=en>libext2fs version: 1.41.9</span>
<span lang=en>CPU is little endian.</span></pre>
 <dl>
 <dt style=margin-bottom:.5cm lang=en>
 The following command line starts the ext4magic multi stage
 recover process 
 </dl>
 <pre class=western style=margin-bottom:.5cm lang=en>ext4magic /dev/sda6 -a 1332606716 -j /tmp/sda6.journal -m -d /tmp/RECOVER</pre><p lang=en>
 Maybe this recovers now many files, mainly symlinks and empty
 files. These files are not important, later on you can delete all
 these files. This command also will recover the files from the
 previous recovery a second time. The interesting part comes at the
 end of the process. Additional recovered files are detected by the
 file carving function: 
 </p>
 <pre class=western lang=en>.....
<span lang=en>MAGIC-3: start ext3-magic-scan search. Please wait, this may take a long time</span>
<span lang=en>--------        /tmp/RECOVER/MAGIC-3/image/jpeg/0004741651.jpg</span>
<span lang=en>--------        /tmp/RECOVER/MAGIC-3/image/jpeg/0004742628.jpg</span>
<span lang=en>--------        /tmp/RECOVER/MAGIC-3/image/jpeg/0004747759.jpg</span>
<span lang=en>--------        /tmp/RECOVER/MAGIC-3/image/jpeg/0004748648.jpg</span>
<span lang=en>--------        /tmp/RECOVER/MAGIC-3/image/jpeg/0004749081.jpg</span>
<span lang=en>--------        /tmp/RECOVER/MAGIC-3/image/jpeg/0004749585.jpg</span>
<span lang=en>--------        /tmp/RECOVER/MAGIC-3/image/jpeg/0004595413.jpg</span>
<span lang=en>--------        /tmp/RECOVER/MAGIC-3/image/jpeg/0004597802.jpg</span>
<span lang=en>--------        /tmp/RECOVER/MAGIC-3/image/jpeg/0004603959.jpg</span>
<span lang=en>ext4magic: EXIT_SUCCESS</span></pre><p lang=en>
 The magic-function has found another 9 JPEG files. 
 </p>
 <p lang=en>Now mount <i>/home</i> again, start the runlevel 5 and
 login as user.<br>As root, copy back the recovered files to
 <b>/home/rob/Bilder/</b> 
 </p>
 <pre class=western style=margin-bottom:.5cm lang=en>cp /tmp/RECOVER/rob/Bilder/*.jpg /tmp/RECOVER/MAGIC-3/image/jpeg/*.jpg /home/rob/Bilder/</pre><p>
 <span lang=en>Check the JPEG files with <a href=http://linux.die.net/man/1/display>display</a>
 , <a href=http://www.trilon.com/xv/downloads.html#manual>xv</a>
 or <a href=http://linux.die.net/man/1/gimp>gimp</a> or a other
 tool. Some files got different names during the file carving
 function and must be renamed to get their original filename. </span>
 </p>
 <p lang=en>In this example 20 of 21 accidentally deleted JPEG
 files could be recovered. One file was lost during overwritten data
 blocks.</p>
 <p><br><br>
 </p>
 <h2 class=western lang=en><a name=Single_file_was_overridden_by_redirection_of_the_standard_output></a>
 Single file was overridden by redirection of the standard output</h2>
 <h3 class=western lang=en><a name=What_happened_5></a>What
 happened</h3>
 <p><span lang=en>An important file </span><span lang=en><i><b>"/home/rob/DB/HWSD.mdb"</b></i></span>
 <span lang=en>was overridden in a directory on </span><span lang=en><i><b>/dev/sda6</b></i></span>
 <span lang=en>by a incorrect <a href=http://linux.die.net/man/1/zip>zip</a>
 command&nbsp;: </span>
 </p>
 <pre class=western style=margin-bottom:.5cm lang=en>zip -r - base/ &gt; "HWSD.mdb"</pre><p lang=en>
 The <i><b>/tmp</b></i> directory is <i><b>/dev/sda3</b></i> and
 still has plenty of space for temporary files. <i><b>/dev/sda6</b></i>
 can not be unmounted immediately.. 
 </p>
 <p><br><br>
 </p>
 <h3 class=western lang=en><a name=Recommended_immediate_actions_4></a>
 Recommended immediate actions</h3>
 <p lang=en>If the filesystem can not either be mounted read-only
 or umounted avoid all unnecessary writes to the filesystem. Create
 a copy of the file system journal on a different file system
 <i><b>/tmp/journal.copy</b></i> 
 </p>
 <pre class=western style=margin-bottom:.5cm lang=en>debugfs -R "dump &lt;8&gt; /tmp/journal.copy" /dev/sda6</pre><p>
 <br><br>
 </p>
 <h3 class=western lang=en><a name=Recovery_process_5></a>Recovery
 process</h3>
 <p lang=en>This process may unfortunately fail if there doesn't
 exist an old inode copy any more. 
 </p>
 <p lang=en>Find out what inode number of the file
 <i><b>"/home/rob/DB/HWSD.mdb"</b></i> 
 </p>
 <pre class=western lang=en># ls -il HWSD.mdb
<span lang=en>742663 -rw-r--r-- 1 rob users 20704805 Mar  1 23:46 HWSD.mdb</span></pre><p lang=en>
 Determine which inode copies of these inode are in the journal. Do
 not use the journal of the file system, use the copy
 <i><b>/tmp/journal.copy</b></i> 
 </p>
 <pre class=western lang=en># ext4magic /dev/sda6 -j /tmp/journal.copy -I 742663 -T
<span lang=en>Filesystem in use: /dev/sda6</span>

<span lang=en>Using external Journal at File /tmp/journal.copy</span>
<span lang=en>Inode 742663 is at group 91, block 2981896, offset 1536</span>

<span lang=en>Transactions of Filesystemblock 2981896 in Journal</span>
<span lang=en>FS-Block         Journal        Transact</span>
     <span lang=en>2981896       13542          711337</span>
     <span lang=en>2981896       13547          711338</span>
     <span lang=en>2981896       13560          711339</span>

<span lang=en>Dump Inode 742663 from journal transaction 711337</span>
<span lang=en>Inode: 742663   Type: regular    Mode:  0644   Flags: 0x0</span>
<span lang=en>Generation: 3901765187    Version: 0x00000000</span>
<span lang=en>User:  1000   Group:   100   Size: 32739328</span>
<span lang=en>File ACL: 0    Directory ACL: 0</span>
<span lang=en>Links: 1   Blockcount: 64016</span>
<span lang=en>Fragment:  Address: 0    Number: 0    Size: 0</span>
<span lang=en>ctime: 1320716830 -- Tue Nov  8 02:47:10 2011</span>
<span lang=en>atime: 1330641812 -- Thu Mar  1 23:43:32 2012</span>
<span lang=en>mtime: 1320716830 -- Tue Nov  8 02:47:10 2011</span>
<span lang=en>Size of extra inode fields: 4</span>

<span lang=en>Dump Inode 742663 from journal transaction 711338</span>
<span lang=en>Inode: 742663   Type: regular    Mode:  0644   Flags: 0x0</span>
<span lang=en>Generation: 3901765187    Version: 0x00000000</span>
<span lang=en>User:  1000   Group:   100   Size: 20704805</span>
<span lang=en>File ACL: 0    Directory ACL: 0</span>
<span lang=en>Links: 1   Blockcount: 40488</span>
<span lang=en>Fragment:  Address: 0    Number: 0    Size: 0</span>
<span lang=en>ctime: 1330641988 -- Thu Mar  1 23:46:28 2012</span>
<span lang=en>atime: 1330641812 -- Thu Mar  1 23:43:32 2012</span>
<span lang=en>mtime: 1330641988 -- Thu Mar  1 23:46:28 2012</span>
<span lang=en>Size of extra inode fields: 4</span>

<span lang=en>Dump Inode 742663 from journal transaction 0</span>
<span lang=en>Inode: 742663   Type: regular    Mode:  0644   Flags: 0x0</span>
<span lang=en>Generation: 3901765187    Version: 0x00000000</span>
<span lang=en>User:  1000   Group:   100   Size: 20704805</span>
<span lang=en>File ACL: 0    Directory ACL: 0</span>
<span lang=en>Links: 1   Blockcount: 40488</span>
<span lang=en>Fragment:  Address: 0    Number: 0    Size: 0</span>
<span lang=en>ctime: 1330641988 -- Thu Mar  1 23:46:28 2012</span>
<span lang=en>atime: 1330642018 -- Thu Mar  1 23:46:58 2012</span>
<span lang=en>mtime: 1330641988 -- Thu Mar  1 23:46:28 2012</span>
<span lang=en>Size of extra inode fields: 4</span>
<span lang=en>ext4magic: EXIT_SUCCESS</span></pre><p lang=en>
 You can identify the inode copies by the file <b>size</b>, and the
 <b>ctime</b>. In this case, 3 copies are present. The first one is
 a copy from the original file. Use the <b>transaction</b> number
 from this copy to restore the file. (transaction = 0, the last ,
 this is the real inode of the filesystem, not a journal copy) Write
 the recovered file to another file system. <i><b>/tmp</b></i> and
 use option <i><b>"-r"</b></i>. If there are any blocks of
 this file already reused the file will not be recovered. 
 </p>
 <pre class=western lang=en># ext4magic /dev/sda6 -j /tmp/journal.copy -I 742663 -t 711337 -r -d /tmp
<span lang=en>"/tmp"  accept for recoverdir</span>
<span lang=en>Filesystem in use: /dev/sda6</span>

<span lang=en>Using external Journal at File /tmp/journal.copy</span>

<span lang=en>Dump Inode 742663 from journal transaction 711337</span>
<span lang=en>Inode: 742663   Type: regular    Mode:  0644   Flags: 0x0</span>
<span lang=en>Generation: 3901765187    Version: 0x00000000</span>
<span lang=en>User:  1000   Group:   100   Size: 32739328</span>
<span lang=en>File ACL: 0    Directory ACL: 0</span>
<span lang=en>Links: 1   Blockcount: 64016</span>
<span lang=en>Fragment:  Address: 0    Number: 0    Size: 0</span>
<span lang=en>ctime: 1320716830 -- Tue Nov  8 02:47:10 2011</span>
<span lang=en>atime: 1330641812 -- Thu Mar  1 23:43:32 2012</span>
<span lang=en>mtime: 1320716830 -- Tue Nov  8 02:47:10 2011</span>
<span lang=en>Size of extra inode fields: 4</span>
<span lang=en>--------        /tmp/&lt;742663&gt;</span>
<span lang=en>ext4magic: EXIT_SUCCESS</span></pre><p lang=en>
 If the recovery was successfully check the file and copy it back to
 it's original location. 
 </p>
 <pre class=western lang=en># ls -l "/tmp/&lt;742663&gt;"
<span lang=en>-rw-r--r-- 1 rob users 32739328 Nov  8 02:47 /tmp/&lt;742663&gt;</span>
<span lang=en># file "/tmp/&lt;742663&gt;"</span>
<span lang=en>/tmp/&lt;742663&gt;: Microsoft Access Database</span>
<span lang=en># cp  "/tmp/&lt;742663&gt;" /home/rob/DB/HWSD.mdb</span></pre>
 <dl>
 <dt style=margin-bottom:.5cm lang=en>
 Warning</dl>
 <p>
 <span lang=en>Don't use the journal later on if the filesystem
 was modified in the meantime. In addition don't use </span><a href=http://linux.die.net/man/8/debugfs><span lang=en><b>debugfs</b></span></a>
 <span lang=en>to create a new copy or use ext4magic to read the
 journal on the file system until the file system was unmounted and
 mounted again. Otherwise ext4magic recovery may create incorrect
 results because some parts of the file system journal will be
 cached when it's read with </span><span lang=en><b>debugfs</b></span>
 <span lang=en>and will be out of sync with the actual contents on
 the filesystem on the disk. </span>
 </p>
 <p><br><br>
 </p>
 <h2 class=western lang=en><a name=First_sectors_of_a_hard_drive_were_overwritten_by_accident></a>
 First sectors of a hard drive were overwritten by accident</h2>
 <h3 class=western lang=en><a name=What_happened_6></a>What
 happened</h3>
 <ul>
 <li><p style=margin-bottom:0cm lang=en>Hard disk <b>sdb</b>
 should be deleted by using <b>"dd"</b>. However,
 accidentally an incorrect target <b>sdd</b> was entered for the
 <b>"dd"</b> command. The error detected immediately and
 the command canceled. There were only about 100 MByte written to
 disk <b>sdd</b>. 
 </p>
 <li><p style=margin-bottom:0cm lang=en>sdd1 (at the front of
 the disk) is a ext3 or ext4 file system and contains important
 files. 
 </p>
 <li><p lang=en>sdd has a conventional IBM PC partitioning scheme
 </p>
 </ul>
 <p><br><br>
 </p>
 <h3 class=western lang=en><a name=Recommended_immediate_actions_5></a>
 Recommended immediate actions</h3>
 <p><span lang=en>Important to remember now, the <a href=http://en.wikipedia.org/wiki/Master_boot_record>MBR</a>
 and the included partition table has also been destroyed as well.
 But at the moment the current running kernel knows the old
 partition. This should be used if you have no backup of the
 partition table. After a reboot the kernel can not find a valid
 partition table and thus no file system on this disk any more. You
 can find these informations at the </span><span lang=en><b>/sys/block</b></span>
 <span lang=en>directory. The partition starts on the disk (a 512
 Byte blocks) can find at </span><span lang=en><i><b>/sys/block/sdd/sdd*/start</b></i></span>
 <span lang=en>and the partition size at </span><span lang=en><i><b>/sys/block/sdd/sdd*/size</b></i></span><span lang=en>.
 Locate these files </span><span lang=en><b>start</b></span> <span lang=en>and
 </span><span lang=en><b>size</b></span> <span lang=en>for all
 partitions of the overwritten disk and save them. You can use this
 later to restore the partition table. The following script will do
 this for all block devices. You can run this as non-root user </span>
 </p>
 <pre class=western lang=en>#!/bin/bash
<span lang=en>printf "%s\t%10s\t%10s\n" Part  Start  Size</span>
<span lang=en>for SYS in /sys/block/*</span>
<span lang=en>do</span>
        <span lang=en>DEVICE=$(echo -n ${SYS}/; echo ${SYS##*/})</span>
        <span lang=en>for PART in ${DEVICE}*</span>
        <span lang=en>do</span>
                <span lang=en>if [ -f $PART/start ]</span>
                        <span lang=en>then</span>
                        <span lang=en>START=$(cat $PART/start)</span>
                        <span lang=en>SIZE=$(cat $PART/size)</span>
                        <span lang=en>printf "%s\t%10lu\t%10lu\n" ${PART##*/}  $START  $SIZE</span>
                <span lang=en>fi</span>
        <span lang=en>done</span>
<span lang=en>done</span></pre><p lang=en>
 <br>If the filesystem sdd1 is still mounted, umount it now. This
 will still write some filesystem meta information, which could be
 valuable later on. If you have enough free disk space on another
 disk, then back up now the <b>sdd1</b> partition as an image. 
 </p>
 <pre class=western style=margin-bottom:.5cm lang=en>dd if=/dev/sdd1 of=/mnt/FREE_SPACE/sdd1_copy.image</pre><p lang=en>
 If the system runs normal in this state, do not switch off or
 reboot the computer now if you need one of the partitions of sdd.
 Without recreating the partition table, you have no access to the
 data any more. It's time to make a backup of this data. 
 </p>
 <p><br><br>
 </p>
 <h3 class=western lang=en><a name=Recovery_process_6></a>Recovery
 process</h3>
 <h4 class=western lang=en><a name=Recovery_setup_2></a>Recovery
 setup</h4>
 <ul>
 <li><p style=margin-bottom:0cm lang=en>Do not continue until
 you have not even created a copy of the whole disk. 
 </p>
 <li><p style=margin-bottom:0cm lang=en>Enough free disk space
 is required to write the recovered files from <b>sdd1</b>. 
 </p>
 <li><p><span lang=en>You need a ext4magic with <a href=http://ext4magic.sourceforge.net/expert-mode_en.html>Expert-Mode</a>
 enabled. (for example: <a href=http://download.opensuse.org/repositories/home:/robi-1/>one
 of these</a>). You can check with the following command: </span>
 </p>
 </ul>
 <pre class=western style=margin-bottom:.5cm lang=en>ext4magic -V -x</pre>
 <dl>
 <dd style=margin-bottom:.5cm lang=en>
 Should print in the last row: <b>"Expert Mode is activ"</b>
 </dl>
 <ul>
 <li><p>
 <span lang=en>needed is also a <a href=http://ext4magic.sourceforge.net/expert-mode_en.html#Help_script>small
 script</a> from the (<a href=http://ext4magic.sourceforge.net/expert-mode_en.html>Expert-Mode
 site</a>). </span>
 </p>
 </ul>
 <table style=--darkreader-inline-bgcolor:#5a1311 data-darkreader-inline-bgcolor width=100% cellspacing=2 cellpadding=2 bgcolor=#ffe1e1>
 <tbody><tr>
 <td style="border:medium none;padding:0cm;--darkreader-inline-bgcolor:#ef1f1b;--darkreader-inline-border-top:currentcolor;--darkreader-inline-border-right:currentcolor;--darkreader-inline-border-bottom:currentcolor;--darkreader-inline-border-left:currentcolor" data-darkreader-inline-bgcolor data-darkreader-inline-border-top data-darkreader-inline-border-right data-darkreader-inline-border-bottom data-darkreader-inline-border-left bgcolor=#ff0000>
 <p><font size=2><b>Attention:</b> </font>
 </p>
 </td>
 </tr>
 <tr>
 <td style="border:medium none;padding:0cm;--darkreader-inline-border-top:currentcolor;--darkreader-inline-border-right:currentcolor;--darkreader-inline-border-bottom:currentcolor;--darkreader-inline-border-left:currentcolor" data-darkreader-inline-border-top data-darkreader-inline-border-right data-darkreader-inline-border-bottom data-darkreader-inline-border-left>
 <p>Never use both the original disk and the copy of the disk
 together for recovery activities. The last one will be used only
 for the generation of new copies, if it's necessary. 
 </p>
 </td>
 </tr>
 </table>
 <p><br><br>
 </p>
 <p lang=en>If you could create a copy of the sdd1 partition
 before the computer is shut down, they can be used directly with
 ext4magic. Otherwise, the partition table must first be restored or
 must created such an image of the defect partition (this Howto use
 the copy of the overwritten disk, sde). 
 </p>
 <p><br><br>
 </p>
 <h4 class=western lang=en><a name=Restore_of_the_partition_table></a>
 Restore of the partition table</h4>
 <p><span lang=en>If you have saved the output of
 </span><span lang=en><i><b>/sys/block/sdd/sdd*/start</b></i></span>
 <span lang=en>and </span><span lang=en><i><b>/sys/block/sdd/sdd*/size</b></i></span>
 <span lang=en>before a reboot, you can use <a href=http://linux.die.net/man/8/sfdisk>sfdisk</a>
 to create a new partition table with the correct data.</span></p>
 <p lang=en>Example: the saved data from the /sys/block/ files: 
 </p>
 <pre class=western lang=en>/sys/block/sdd/sdd1/start       63
<span lang=en>/sys/block/sdd/sdd2/start       392112</span>
<span lang=en>/sys/block/sdd/sdd3/start       8205120</span>

<span lang=en>/sys/block/sdd/sdd1/size        3392049</span>
<span lang=en>/sys/block/sdd/sdd2/size        7813008</span>
<span lang=en>/sys/block/sdd/sdd3/size        8293824</span></pre><p>
 <span lang=en>Use this data for create a new partition table on
 the disk copy </span><span lang=en><b>/dev/sde</b></span><span lang=en>.<br></span><a href=http://linux.die.net/man/8/sfdisk><span lang=en><b>sfdisk</b></span></a>
 <span lang=en>accepted these values as </span><span lang=en><b>"SECTORS"</b></span>
 <span lang=en>You can do this interactiv, or with a <a href=http://tldp.org/LDP/abs/html/here-docs.html>Here
 Document</a> </span>
 </p>
 <pre class=western lang=en># sfdisk -uS /dev/sde &lt;&lt;EOF
<span lang=en>63,3392049</span>
<span lang=en>392112,7813008</span>
<span lang=en>8205120,8293824</span>
<span lang=en>0,0</span>
<span lang=en>EOF</span></pre><p lang=en>
 or create a simple text file with following content 
 </p>
 <pre class=western lang=en># partition table for sde (a copy of destroyed sdd)
<span lang=en>unit: sectors</span>

<span lang=en>/dev/sde1: start=       63, size=   392049, Id=83</span>
<span lang=en>/dev/sde2: start=   392112, size=  7813008, Id=83</span>
<span lang=en>/dev/sde3: start=  8205120, size=  8293824, Id=83</span>
<span lang=en>/dev/sde4: start=        0, size=        0, Id= 0</span></pre><p lang=en>
 and use this as following 
 </p>
 <pre class=western style=margin-bottom:.5cm lang=en>sfdisk /dev/sde &lt; TEXTFILE</pre><p lang=en>
 check the output of command to whether the partition table was
 written correctly. 
 </p>
 <p><br><br>
 </p>
 <dl>
 <dt style=margin-bottom:.5cm lang=en>Note 
 </dl>
 <p>
 <span lang=en>If there exists an extended partition it's size
 value is not correctly. It must be calculated by you. But, don't do
 this now. For now set only the first (the damage) partition and the
 other three set to empty partitions. <br>If the first partition was
 logical partition 5 (</span><span lang=en><b>/dev/sde5</b></span><span lang=en>)
 then the partition now will become partition 1 (</span><span lang=en><b>/dev/sde1</b></span><span lang=en>).
 The other partitions </span><span lang=en><b>/dev/sde2</b></span>
 <span lang=en>to </span><span lang=en><b>/dev/sde4</b></span>
 <span lang=en>will be empty partitions. When the files of the
 first partition have been recovered with ext4magic, clean the
 partition table and use </span><a href=http://linux.die.net/man/8/fdisk><span lang=en><b>fdisk</b></span></a>
 <span lang=en>and delete the partition now (</span><span lang=en><b>/dev/sde1</b></span><span lang=en>)
 and use </span><a href=http://www.brzitwa.de/mb/gpart/><span lang=en><b>gpart</b></span></a>
 <span lang=en>or </span><a href=http://linux.die.net/man/8/testdisk><span lang=en><b>testdisk</b></span></a>
 <span lang=en>to find the correct logical partitions. </span>
 </p>
 <p><span lang=en>Instead to restore the partition table you can
 create a partition image. Use the information of </span><span lang=en><b>start</b></span>
 <span lang=en>and </span><span lang=en><b>size</b></span> <span lang=en>to
 create an image of the first partition with </span><a href=http://linux.die.net/man/1/dd><span lang=en><b>dd</b></span></a>
 </p>
 <pre class=western style=margin-bottom:.5cm lang=en>dd if=/dev/sde of=/tmp/image_of_sde1 bs=512 skip=63 count=392049</pre><p>
 <br><br>
 </p>
 <h3 class=western lang=en><a name=Recover_the_partial_overwritten_first_partition></a>
 Recover the partial overwritten first partition</h3>
 <p><span lang=en>You need here the <a href=http://ext4magic.sourceforge.net/expert-mode_en.html#Help_script>script</a>
 from the <a href=http://ext4magic.sourceforge.net/expert-mode_en.html>Expert-Mode site</a> This
 can find out the copies of the superblock. Use this script if you
 have set the partition table: </span>
 </p>
 <pre class=western style=margin-bottom:.5cm lang=en>SCRIPT /dev/sde1</pre><p lang=en>
 or if the copy of this partition is a image: 
 </p>
 <pre class=western style=margin-bottom:.5cm lang=en>SCRIPT IMAGE_NAME</pre><p lang=en>
 This will work on a disk only if the partition start in the
 partitions table is set correct. The script will output some
 command lines which you can use with ext4magic to recover the
 filesystem. Select one of these command lines and add to it <b>"-d
 FREE_SPACE" </b>(FREE_SPACE is the place for the recovered
 files on a ext3/4 filesystem) 
 </p>
 <pre class=western style=margin-bottom:.5cm lang=en>ext4magic "/dev/sde1" -s 4096 -n 4096000 -c -D -d /mnt/recover</pre><p lang=en>
 This will try to recover all files with existing metadata and also
 all files for which the metadata was destroyed but copies of the
 metadata is still in the journal. Depending on the level of
 destruction and the contents of the journal more or less large
 fragments of the directory structure and individual files may be
 found. 
 </p>
 <p><br><br>
 </p>
 <p><br><br>
 </p>
 <center>
 <table style=--darkreader-inline-bgcolor:#2f2f2e data-darkreader-inline-bgcolor width=100% cellspacing=0 cellpadding=5 bgcolor=#ffffff>
 <tbody><tr>
 <td style="border:medium none;padding:0cm;--darkreader-inline-border-top:currentcolor;--darkreader-inline-border-right:currentcolor;--darkreader-inline-border-bottom:currentcolor;--darkreader-inline-border-left:currentcolor" data-darkreader-inline-border-top data-darkreader-inline-border-right data-darkreader-inline-border-bottom data-darkreader-inline-border-left>
 <p><b><a href=http://ext4magic.sourceforge.net/ext4magic_en.html>Ext4magic</a>:</b> <a href=http://ext4magic.sourceforge.net/inode_en.html>Inode</a>
 - <a href=http://ext4magic.sourceforge.net/directory_en.html>Directory</a> - <a href=http://ext4magic.sourceforge.net/journal_en.html>Journal</a>
 - <a href=http://ext4magic.sourceforge.net/install_en.html>Install</a> - <a href=http://ext4magic.sourceforge.net/time-options_en.html>Time_Options</a>
 - <a href=http://ext4magic.sourceforge.net/histogram_en.html>Histogram</a> - <strong>Scenarios</strong>
 - <a href=http://ext4magic.sourceforge.net/tips_en.html>Tips&amp;Tricks</a> - <a href=http://ext4magic.sourceforge.net/manpage_en.html>Manpage</a>
 - <a href=http://ext4magic.sourceforge.net/expert-mode_en.html>Expert-Mode</a> 
 </p>
 </td>
 </tr>
 </table>
 </center>
 <p><br><br>
 </p>
 </div>
</div>
