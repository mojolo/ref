<html><head><title>Building and Installing the Kernel (Mac OS X for Unix Geeks)</title><link rel="stylesheet" type="text/css" href="../style/style1.css" />

<meta name="DC.Creator" content="Brian Jepson and Ernest E. Rothman" /><meta name="DC.Format" content="text/xml" scheme="MIME" /><meta name="DC.Language" content="en-US" /><meta name="DC.Publisher" content="O'Reilly &amp; Associates, Inc." /><meta name="DC.Source" scheme="ISBN" content="0-596-00356-0" /><meta name="DC.Subject.Keyword" content="stuff" /><meta name="DC.Title" content="Mac OS X for Unix Geeks" /><meta name="DC.Type" content="Text.Monograph" />

</head><body bgcolor="#ffffff">

<img src="gifs/smbanner.gif" usemap="#banner-map" border="0" alt="Book Home" /><map name="banner-map"><area shape="rect" coords="1,-2,616,66" href="index.htm" alt="Mac OS X for Unix Geeks" /><area shape="rect" coords="629,-11,726,25" href="jobjects/fsearch.htm" alt="Search this book" /></map>

<div class="navbar"><table width="684" border="0"><tr><td align="left" valign="top" width="228"><a href="ch07_02.htm"><img src="../gifs/txtpreva.gif" alt="Previous" border="0" /></a></td><td align="center" valign="top" width="228" /><td align="right" valign="top" width="228"><a href="ch07_04.htm"><img src="../gifs/txtnexta.gif" alt="Next" border="0" /></a></td></tr></table></div>



<h2 class="sect1">7.3. Building and Installing the Kernel</h2>

<p>Now that you have downloaded the source from CVS, you can change to
the <em class="filename">xnu</em> directory and load some environment
variables. If you're using
<em class="filename">tcsh</em>, you can use the following commands:
</p>

<blockquote><pre class="code">% <b class="emphasis-bold">cd xnu</b>
% <b class="emphasis-bold">source SETUP/setup.csh</b></pre></blockquote>

<p>If you're using <em class="filename">bash </em>or
<em class="filename">zsh</em>, you can use these commands:
</p>

<blockquote><pre class="code">$ <b class="emphasis-bold">cd xnu</b>
$ <b class="emphasis-bold">. SETUP/setup.sh</b> </pre></blockquote>

<p>To build the kernel, use this command (the output is not shown):</p>

<blockquote><pre class="code">% <b class="emphasis-bold">make</b></pre></blockquote>

<p>When <em class="filename">make</em> is finished, you should see
<em class="filename">mach_kernel</em> in the
<em class="filename">xnu/BUILD/obj/RELEASE_PPC</em> directory. Before you
install the new kernel, back up your old kernel as follows:
</p>

<blockquote><pre class="code">% <b class="emphasis-bold">sudo cp /mach_kernel /mach_kernel.backup</b></pre></blockquote>

<p>Next, copy the new kernel over the older version:</p>

<blockquote><pre class="code">% <b class="emphasis-bold">sudo cp BUILD/obj/RELEASE_PPC/mach_kernel /</b></pre></blockquote>

<p>Cross your fingers, knock on wood, and reboot. If all goes well, you
should see the build time, hostname, and your username (since
you're the person who compiled the kernel) when you
run <em class="filename">uname -v</em>:
</p>

<blockquote><pre class="code">Darwin Kernel Version 6.0: Thu Aug 22 15:52:19 EDT 2002;
bjepson:BUILD/obj/RELEASE_PPC</pre></blockquote>

<p>Once you've made it that far, you can start
modifying the code or experimenting with unofficial patches!
</p>



<hr width="684" align="left" />
<div class="navbar"><table width="684" border="0"><tr><td align="left" valign="top" width="228"><a href="ch07_02.htm"><img src="../gifs/txtpreva.gif" alt="Previous" border="0" /></a></td><td align="center" valign="top" width="228"><a href="index.htm"><img src="../gifs/txthome.gif" alt="Home" border="0" /></a></td><td align="right" valign="top" width="228"><a href="ch07_04.htm"><img src="../gifs/txtnexta.gif" alt="Next" border="0" /></a></td></tr><tr><td align="left" valign="top" width="228">7.2. Getting the Source Code</td><td align="center" valign="top" width="228"><a href="index/index.htm"><img src="../gifs/index.gif" alt="Book Index" border="0" /></a></td><td align="right" valign="top" width="228">7.4. Kernel Configuration</td></tr></table></div>
<hr width="684" align="left" />

<img src="../gifs/navbar.gif" usemap="#library-map" border="0" alt="Library Navigation Links" />
<p><p><font size="-1"><a href="copyrght.htm">Copyright &copy; 2003</a> O'Reilly &amp; Associates. All rights reserved.</font></p>

<map name="library-map">
<area shape="rect" coords="1,0,88,96" href="../index.htm"><area shape="rect" coords="90,0,165,96" href="../upt/index.htm"><area shape="rect" coords="168,1,253,107" href="../mac/index.htm"><area shape="rect" coords="255,0,335,97" href="../korn/index.htm"><area shape="rect" coords="337,0,415,109" href="../unixnut/index.htm"><area shape="rect" coords="417,0,512,122" href="../sedawk/index.htm"><area shape="rect" coords="514,0,605,105" href="../lunix/index.htm"><area shape="rect" coords="611,2,694,121" href="../vi/index.htm">
</map>

</body></html>