<html><head><title>System Management Tools (Mac OS X for Unix Geeks)</title><link rel="stylesheet" type="text/css" href="../style/style1.css" />

<meta name="DC.Creator" content="Brian Jepson and Ernest E. Rothman" /><meta name="DC.Format" content="text/xml" scheme="MIME" /><meta name="DC.Language" content="en-US" /><meta name="DC.Publisher" content="O'Reilly &amp; Associates, Inc." /><meta name="DC.Source" scheme="ISBN" content="0-596-00356-0" /><meta name="DC.Subject.Keyword" content="stuff" /><meta name="DC.Title" content="Mac OS X for Unix Geeks" /><meta name="DC.Type" content="Text.Monograph" />

</head><body bgcolor="#ffffff">

<img src="gifs/smbanner.gif" usemap="#banner-map" border="0" alt="Book Home" /><map name="banner-map"><area shape="rect" coords="1,-2,616,66" href="index.htm" alt="Mac OS X for Unix Geeks" /><area shape="rect" coords="629,-11,726,25" href="jobjects/fsearch.htm" alt="Search this book" /></map>

<div class="navbar"><table width="684" border="0"><tr><td align="left" valign="top" width="228"><a href="ch07_04.htm"><img src="../gifs/txtpreva.gif" alt="Previous" border="0" /></a></td><td align="center" valign="top" width="228" /><td align="right" valign="top" width="228"><a href="ch08_02.htm"><img src="../gifs/txtnexta.gif" alt="Next" border="0" /></a></td></tr></table></div>


<h1 class="chapter">Chapter 8. System Management Tools</h1>
<div class="htmltoc"><h4 class="tochead">Contents:</h4><p>
<a href="ch08_01.htm#sect1">Diagnostic Utilities</a><br />
<a href="ch08_02.htm">Kernel Utilities</a><br />
<a href="ch08_03.htm">System Configuration</a><br /></p></div><p><a name="mosxgeeks-IDXTERM-496" /> <a name="mosxgeeks-IDXTERM-497" /> <a name="mosxgeeks-IDXTERM-498" />Mac OS X comes with many
tools for tweaking and spying on various aspects of your system,
including memory, kernel modules, and kernel state variables. Some of
these tools come directly from BSD, while others are unique to Mac OS
X. Most of the BSD-derived utilities have been filtered through Mach
and NeXTSTEP on their way to Mac OS X.
</p><p>For more details on any of these utilities, see their respective
manpages.
</p><div class="sect1"><a name="mosxgeeks-CHP-8-SECT-1" />
<h2 class="sect1"><a name="sect1" />8.1. Diagnostic Utilities</h2>

<p><a name="mosxgeeks-IDXTERM-499" />Mac OS X includes many diagnostic
utilities that you can use to monitor your system and investigate
problems.
</p>

<a name="mosxgeeks-CHP-8-SECT-1.1" /><div class="sect2">
<h3 class="sect2">8.1.1. top</h3>

<p><a name="mosxgeeks-IDXTERM-500" />
<a name="mosxgeeks-IDXTERM-501" /> <a name="mosxgeeks-IDXTERM-502" />The <em class="filename">top</em>
utility displays memory statistics and a list of running processes.
It is divided into two regions: the top region contains memory
statistics and the bottom region contains details on each process.
</p>



<a name="ch08-5-fm2xml" /><blockquote><b>TIP:</b> 
The Mac OS X version of <em class="filename">top</em> is based on the one
used in early versions of BSD. It was ported to Mach in 1988, to
NeXTSTEP in 1990, and to Mac OS X in 1999.
</p>
</blockquote>

<p>You can specify the number of processes to show by supplying a
numeric argument. By default, <em class="filename">top</em> refreshes its
display every second and sorts the list of processes by process ID
(PID) in descending order. You can set <em class="filename">top</em> to
sort by CPU utilization with -<em class="filename">u</em>, and you can
specify the refresh delay with the -<em class="filename">s </em>option.
<a href="ch08_01.htm#mosxgeeks-CHP-8-FIG-1">Figure 8-1</a> shows the output of <em class="filename">top -u 10
</em>(if you wanted to refresh the output every 3 seconds, you
could run <em class="filename">top -s3 -u 10</em>).
</p>

<a name="mosxgeeks-CHP-8-FIG-1" /><div class="figure"><img src="figs/mud_0801.gif" alt="Figure 8-1" width="432" /></div><h4 class="objtitle">Figure 8-1. Sample output from top</h4>

<p><a href="ch08_01.htm#mosxgeeks-CHP-8-TABLE-1">Table 8-1</a> describes the values shown in the top
region, and <a href="ch08_01.htm#mosxgeeks-CHP-8-TABLE-2">Table 8-2</a> describes the columns in the
bottom region (process information).
</p>

<a name="mosxgeeks-CHP-8-TABLE-1" /><h4 class="objtitle">Table 8-1. Memory information displayed by top </h4><table border="1" cellpadding="3">




<tr>
<th>
<p>Item number</p>
</th>
<th>
<p>Item</p>
</th>
<th>
<p>Description</p>
</th>
</tr>


<tr>
<td>
<blockquote><pre class="code">1</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">Processes</pre></blockquote>
</td>
<td>
<p>The number of processes and threads. A running process is currently
using CPU time, while a sleeping process is not.
</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">2</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">Load Avg.</pre></blockquote>
</td>
<td>
<p>The average system load (number of jobs vying for the
CPU's attention) over the last 1, 5, and 15 minutes.
</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">3</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">CPU usage</pre></blockquote>
</td>
<td>
<p>A breakdown of CPU usage, listing time spent in
<tt class="literal">user</tt> mode, kernel (<tt class="literal">sys</tt>) mode,
and <tt class="literal">idle</tt> time.
</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">4</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">SharedLibs</pre></blockquote>
</td>
<td>
<p>The number of shared libraries in use, along with their memory
utilization.
</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">5</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">MemRegions</pre></blockquote>
</td>
<td>
<p>The number of Mach virtual memory regions in use, along with memory
utilization details.
</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">6</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">PhysMem</pre></blockquote>
</td>
<td>
<p>The physical memory utilization. Memory that is
<tt class="literal">wired</tt> cannot be swapped to disk.
<tt class="literal">active</tt> memory is memory that's
currently being used, <tt class="literal">inactive</tt> memory is memory
that Mac OS X is keeping "on deck"
for processes that need it, and <tt class="literal">free</tt> memory is
memory that's not being used at all.
</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">7</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">VM</pre></blockquote>
</td>
<td>
<p>The virtual memory statistics, including the total amount of virtual
memory allocated (the sum of the <tt class="literal">VSIZE</tt> in the
process list), as well as paging activity (data paged in and out of
physical memory).
</p>
</td>
</tr>

</table><p>

<a name="mosxgeeks-CHP-8-TABLE-2" /><h4 class="objtitle">Table 8-2. Process information displayed by top </h4><table border="1" cellpadding="3">




<tr>
<th>
<p>Item number</p>
</th>
<th>
<p>Item</p>
</th>
<th>
<p>Description</p>
</th>
</tr>


<tr>
<td>
<blockquote><pre class="code">8</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">PID</pre></blockquote>
</td>
<td>
<p>Process ID</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">9</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">COMMAND</pre></blockquote>
</td>
<td>
<p>Program's name</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">10</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">%CPU</pre></blockquote>
</td>
<td>
<p>Percentage of the CPU that the process is using</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">11</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">TIME</pre></blockquote>
</td>
<td>
<p>Total amount of CPU time this process has used</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">12</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">#TH</pre></blockquote>
</td>
<td>
<p>Number of threads in this process</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">13</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">#PRTS</pre></blockquote>
</td>
<td>
<p>Number of Mach ports</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">14</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">#MREGS</pre></blockquote>
</td>
<td>
<p>Number of memory registers</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">15</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">RPRVT</pre></blockquote>
</td>
<td>
<p>Resident private memory</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">16</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">RSHRD</pre></blockquote>
</td>
<td>
<p>Resident shared memory</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">17</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">RSIZE</pre></blockquote>
</td>
<td>
<p>Resident memory</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">18</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">VSIZE</pre></blockquote>
</td>
<td>
<p>Process's total address space, including shared
memory<a name="IXTR3-694" /> <a name="IXTR3-695" /> <a name="IXTR3-696" /> 
</p>
</td>
</tr>

</table><p>

</div>
<a name="mosxgeeks-CHP-8-SECT-1.2" /><div class="sect2">
<h3 class="sect2">8.1.2. fs_usage</h3>

<p>The <em class="filename">fs_usage</em><a name="IXT-8-672" />
<a name="IXT-8-673" /> utility shows
a continuous display of filesystem-related system calls and page
faults. You must run <em class="filename">fs_usage</em> as
<em class="filename">root</em>. By default, it ignores anything
originating from <em class="filename">fs_usage</em>,
<em class="filename">Terminal</em>, <em class="filename">telnetd</em>,
<em class="filename">sshd</em>, <em class="filename">rlogind</em>,
<em class="filename">tcsh</em>, <em class="filename">csh</em>, or
<em class="filename">sh</em>.
</p>

<p><a href="ch08_01.htm#mosxgeeks-CHP-8-FIG-2">Figure 8-2</a> shows the output of
<em class="filename">fs_usage</em>, which displays the:
</p>

<ol><li>
<p>Timestamp</p>
</li><li>
<p>System call</p>
</li><li>
<p>Filename</p>
</li><li>
<p>Elapsed time</p>
</li><li>
<p>Name of the process</p>
</li></ol>
</div>
<a name="mosxgeeks-CHP-8-SECT-1.3" /><div class="sect2">
<h3 class="sect2">8.1.3. latency</h3>

<p><em class="filename">latency</em><a name="IXT-8-674" /> <a name="IXT-8-675" />
<a name="IXT-8-676" /> measures the number of context
switches and interrupts, and reports on the resulting delays,
updating the display once per second. This utility must be run as
<em class="filename">root</em>. <a href="ch08_01.htm#mosxgeeks-CHP-8-EX-1">Example 8-1</a> shows a
portion of its output.
</p>

<a name="mosxgeeks-CHP-8-EX-1" /><div class="example">
<h4 class="objtitle">Example 8-1. Partial output from latency  </h4>
<blockquote><pre class="code">Mon Apr  8 16:30:30                             0:01:58
                     SCHEDULER     INTERRUPTS
---------------------------------------------
total_samples            64431         179982

delays &lt;  10 usecs       38731         176120
delays &lt;  20 usecs       10763           2885
delays &lt;  30 usecs        2934            447
delays &lt;  40 usecs        1037            190
delays &lt;  50 usecs         718             93
delays &lt;  60 usecs         708             41
delays &lt;  70 usecs         540             32
delays &lt;  80 usecs         420             21
delays &lt;  90 usecs         310             30
delays &lt; 100 usecs         217             20
total  &lt; 100 usecs       56378         179879</pre></blockquote>
</div>

<p>The <tt class="literal">SCHEDULER</tt> column lists the number of context
switches and the <tt class="literal">INTERRUPTS</tt> column lists the
number of interrupts.
</p>

</div>
<a name="mosxgeeks-CHP-8-SECT-1.4" /><div class="sect2">
<h3 class="sect2">8.1.4. sc_usage</h3>

<p>The <em class="filename">sc_usage</em><a name="IXT-8-677" /> <a name="IXT-8-678" />
<a name="IXT-8-679" /> utility samples system calls and
page faults, displaying them onscreen. <em class="filename">sc_usage</em>
must be run by <em class="filename">root </em>or by someone who has
superuser privileges. The display is updated once per second. You
must specify a PID, a command name, or a program to execute with the
-<em class="filename">E </em>switch. For example, to monitor the Finder,
use <em class="filename">sc_usage Finder</em>. <a href="ch08_01.htm#mosxgeeks-CHP-8-FIG-2">Figure 8-2</a> shows the output of running
<em class="filename">sc_usage</em> on the Finder. <a href="ch08_01.htm#mosxgeeks-CHP-8-TABLE-3">Table 8-3</a> explains
<em class="filename">sc_usage</em>'s output.
</p>

<a name="mosxgeeks-CHP-8-FIG-2" /><div class="figure"><img src="figs/mud_0802.gif" alt="Figure 8-2" width="423" /></div><h4 class="objtitle">Figure 8-2. sc_usage monitoring the Finder</h4>

<a name="mosxgeeks-CHP-8-TABLE-3" /><h4 class="objtitle">Table 8-3. Information displayed by sc_usage </h4><table border="1" cellpadding="3">




<tr>
<th>
<p>Item number</p>
</th>
<th>
<p>Row</p>
</th>
<th>
<p>Description</p>
</th>
</tr>


<tr>
<td>
<blockquote><pre class="code">1</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">TYPE</pre></blockquote>
</td>
<td>
<p>The system call type</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">2</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">NUMBER</pre></blockquote>
</td>
<td>
<p>The system call count</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">3</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">CPU_TIME</pre></blockquote>
</td>
<td>
<p>The processor time used by the system call</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">4</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">WAIT_TIME</pre></blockquote>
</td>
<td>
<p>The absolute time that the process spent waiting</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">5</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">CURRENT_TYPE</pre></blockquote>
</td>
<td>
<p>The current system call type</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">6</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">LAST_PATHNAME_WAITED_FOR</pre></blockquote>
</td>
<td>
<p>The last file or directory that resulted in a blocked I/O operation
during a system call
</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">7</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">CUR_WAIT_TIME</pre></blockquote>
</td>
<td>
<p>The cumulative time spent blocked</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">8</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">THRD#</pre></blockquote>
</td>
<td>
<p>The thread ID</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">9</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">PRI</pre></blockquote>
</td>
<td>
<p>The scheduling priority</p>
</td>
</tr>

</table><p>

</div>
<a name="mosxgeeks-CHP-8-SECT-1.5" /><div class="sect2">
<h3 class="sect2">8.1.5. vm_stat</h3>

<p>The <em class="filename">vm_stat</em><a name="IXT-8-680" /> <a name="IXT-8-681" /> utility displays virtual memory
statistics. Unlike implementations of <em class="filename">vm_stat </em>in
other Unix systems, it does not default to continuous display.
Instead, it displays accumulated statistics.
</p>

<p>To obtain a continuous display, specify an interval argument (in
seconds), as in <em class="filename">vm_stat 1</em>. <a href="ch08_01.htm#mosxgeeks-CHP-8-FIG-3">Figure 8-3</a> shows the output of
<em class="filename">vm_stat</em> with no arguments, and <a href="ch08_01.htm#mosxgeeks-CHP-8-FIG-4">Figure 8-4</a> shows the output of <em class="filename">vm_stat
1</em>. <a href="ch08_01.htm#mosxgeeks-CHP-8-TABLE-4">Table 8-4</a> describes the information
that <em class="filename">vm_stat</em> displays (the item numbers
correspond to the callouts in both figures).
</p>

<a name="mosxgeeks-CHP-8-FIG-3" /><div class="figure"><img src="figs/mud_0803.gif" alt="Figure 8-3" width="421" /></div><h4 class="objtitle">Figure 8-3. vm_stat displaying accumulated statistics</h4>

<a name="mosxgeeks-CHP-8-FIG-4" /><div class="figure"><img src="figs/mud_0804.gif" alt="Figure 8-4" width="425" /></div><h4 class="objtitle">Figure 8-4. vm_stat's continuous output</h4>

<a name="mosxgeeks-CHP-8-TABLE-4" /><h4 class="objtitle">Table 8-4. Information displayed by vm_stat </h4><table border="1" cellpadding="3">





<tr>
<th>
<p>Item number</p>
</th>
<th>
<p>Accumulated mode</p>
</th>
<th>
<p>Continuous mode</p>
</th>
<th>
<p>Description</p>
</th>
</tr>


<tr>
<td>
<blockquote><pre class="code">1</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">Pages free</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">free</pre></blockquote>
</td>
<td>
<p>Total free pages</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">2</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">Pages active</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">active</pre></blockquote>
</td>
<td>
<p>Total pages in use that can be paged out</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">3</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">Pages inactive</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">inac</pre></blockquote>
</td>
<td>
<p>Total inactive pages</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">4</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">Pages wired down</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">wire</pre></blockquote>
</td>
<td>
<p>Total pages wired into memory (cannot be paged out)</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">5</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">Translation Faults</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">faults</pre></blockquote>
</td>
<td>
<p>Number of times <em class="filename">vm_fault</em> has been called</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">6</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">Pages copy-on-write</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">copy</pre></blockquote>
</td>
<td>
<p>Number of faults that resulted in a page being copied</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">7</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">Pages zero filled</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">zerofill</pre></blockquote>
</td>
<td>
<p>Number of pages that have been zero-filled</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">8</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">Pages Reactivated</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">reactive</pre></blockquote>
</td>
<td>
<p>Number of pages reclassified from inactive to active</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">9</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">Pageins</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">pagein</pre></blockquote>
</td>
<td>
<p>Number of pages moved into physical memory</p>
</td>
</tr>
<tr>
<td>
<blockquote><pre class="code">10</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">Pageouts</pre></blockquote>
</td>
<td>
<blockquote><pre class="code">pageout</pre></blockquote>
</td>
<td>
<p>Number of pages moved out of physical memory<a name="IXTR3-697" />
</p>
</td>
</tr>

</table><p>

</div>
</div>

<hr width="684" align="left" />
<div class="navbar"><table width="684" border="0"><tr><td align="left" valign="top" width="228"><a href="ch07_04.htm"><img src="../gifs/txtpreva.gif" alt="Previous" border="0" /></a></td><td align="center" valign="top" width="228"><a href="index.htm"><img src="../gifs/txthome.gif" alt="Home" border="0" /></a></td><td align="right" valign="top" width="228"><a href="ch08_02.htm"><img src="../gifs/txtnexta.gif" alt="Next" border="0" /></a></td></tr><tr><td align="left" valign="top" width="228">7.4. Kernel Configuration</td><td align="center" valign="top" width="228"><a href="index/index.htm"><img src="../gifs/index.gif" alt="Book Index" border="0" /></a></td><td align="right" valign="top" width="228">8.2. Kernel Utilities</td></tr></table></div>
<hr width="684" align="left" />

<img src="../gifs/navbar.gif" usemap="#library-map" border="0" alt="Library Navigation Links" />
<p><p><font size="-1"><a href="copyrght.htm">Copyright &copy; 2003</a> O'Reilly &amp; Associates. All rights reserved.</font></p>

<map name="library-map">
<area shape="rect" coords="1,0,88,96" href="../index.htm"><area shape="rect" coords="90,0,165,96" href="../upt/index.htm"><area shape="rect" coords="168,1,253,107" href="../mac/index.htm"><area shape="rect" coords="255,0,335,97" href="../korn/index.htm"><area shape="rect" coords="337,0,415,109" href="../unixnut/index.htm"><area shape="rect" coords="417,0,512,122" href="../sedawk/index.htm"><area shape="rect" coords="514,0,605,105" href="../lunix/index.htm"><area shape="rect" coords="611,2,694,121" href="../vi/index.htm">
      </map>

</body></html>