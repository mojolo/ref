<html><head><title>vi File Recovery Versus Networked Filesystems (Unix Power Tools, 3rd Edition)</title><link rel="stylesheet" type="text/css" href="../style/style1.css" />

<meta name="DC.Creator" content="Shelley Powers, Jerry Peek, Tim O'Reilly, Mike Loukides and  " /><meta name="DC.Format" content="text/xml" scheme="MIME" /><meta name="DC.Language" content="en-US" /><meta name="DC.Publisher" content="O'Reilly &amp; Associates, Inc." /><meta name="DC.Source" scheme="ISBN" content="0-596-00330-7" /><meta name="DC.Subject.Keyword" content="stuff" /><meta name="DC.Title" content="UNIX Power Tools, 3rd Edition" /><meta name="DC.Type" content="Text.Monograph" />

</head><body bgcolor="#ffffff">

<img src="gifs/smbanner.gif" usemap="#banner-map" border="0" alt="Unix Power Tools" /><map name="banner-map"><area shape="rect" coords="1,-2,616,66" href="index.htm" alt="Unix Power Tools" /><area shape="rect" coords="629,-11,726,25" href="jobjects/fsearch.htm" alt="Search this book" /></map>

<div class="navbar"><table width="684" border="0"><tr><td align="left" valign="top" width="228"><a href="ch17_18.htm"><img src="../gifs/txtpreva.gif" alt="Previous" border="0" /></a></td><td align="center" valign="top" width="228" /><td align="right" valign="top" width="228"><a href="ch17_20.htm"><img src="../gifs/txtnexta.gif" alt="Next" border="0" /></a></td></tr></table></div>



<h2 class="sect1">17.19. vi File Recovery Versus Networked Filesystems</h2>

<p><a name="IXT-17-1476" /> <a name="IXT-17-1477" /><a name="IXT-17-1478" />Have you ever used the <em class="emphasis">vi
-r</em> command to recover a file? <a name="IXT-17-1479" />It
lets you get a file back that you were editing when the system
crashed or something else killed your editor before you could save.
The system may send you an email message something like this:
</p>

<blockquote><pre class="code">Date: Thu, 19 Nov 1999 09:59:00 EST
To: jerry

A copy of an editor buffer of your file "afile"
was saved when the system went down.
This buffer can be retrieved using the "recover" command of the editor.
An easy way to do this is to give the command "vi -r afile".
This works for "edit" and "ex" also.</pre></blockquote>

<p><img src="figs/bomb.gif" alt="Figure " width="24" /> <a href="ch17_20.htm#upt3-CHP-17-SECT-20">Section 17.20</a></p>

<p>Your files are saved under a directory named something like
<em class="emphasis">/usr/preserve</em>. Follow the instructions and
you'll get back your file, more or less the way it was when you lost
it.
</p>

<p>If your computers have <a name="IXT-17-1480" />networked filesystems, such as NFS,
there's a wrinkle in the way that <em class="emphasis">vi -r</em> works.
It may only work right on the specific computer where you were
editing a file. For example, if you're editing the file
<em class="emphasis">foo</em> on the host named
<em class="emphasis">artemis</em> and it crashes, you may not be able to
log on to another host and do <em class="emphasis">vi -r foo</em> to
recover that file. That's because, on many hosts, temporary files
(like editor buffers) are stored on a local filesystem instead of on
the networked (shared) filesystems. On this kind of system, you may
need to log on to <em class="emphasis">artemis</em> to recover your lost
editor buffer.
</p>

<p>If you don't remember which computer you were using when the file was
lost, check the "Received:" lines
in the email message header;<a href="#FOOTNOTE-49">[49]</a> they'll often show from which machine the
message originally came. Also, if you don't remember what files are
saved on a machine, you can usually get a list of your saved files by
typing <em class="emphasis">vi -r</em> without a filename:
</p><blockquote class="footnote"> <a name="FOOTNOTE-49" /><p> [49]Many email programs hide
these header lines from you. You might need to set a
"show all header fields" option
first.</p> </blockquote>

<blockquote><pre class="code">% <tt class="userinput"><b>vi -r</b></tt>
/var/preserve/jerry:
On Wed Jul 17 at 08:02 saved 15 lines of file "/u/jerry/Mail/drafts/1"
On Sun Aug 25 at 18:42 saved 157 lines of file "doit"
/tmp:
No files saved.</pre></blockquote>

<p>Don't wait too long. Many Unix systems remove these saved editor
buffers every month, week, or sooner.
</p>

<p> <em class="emphasis">-- JP</em></p>



<hr width="684" align="left" />
<div class="navbar"><table width="684" border="0"><tr><td align="left" valign="top" width="228"><a href="ch17_18.htm"><img src="../gifs/txtpreva.gif" alt="Previous" border="0" /></a></td><td align="center" valign="top" width="228"><a href="index.htm"><img src="../gifs/txthome.gif" alt="Home" border="0" /></a></td><td align="right" valign="top" width="228"><a href="ch17_20.htm"><img src="../gifs/txtnexta.gif" alt="Next" border="0" /></a></td></tr><tr><td align="left" valign="top" width="228">17.18. Filtering Text Through a Unix Command</td><td align="center" valign="top" width="228"><a href="index/index.htm"><img src="../gifs/index.gif" alt="Book Index" border="0" /></a></td><td align="right" valign="top" width="228">17.20. Be Careful with vi -r Recovered Buffers</td></tr></table></div>
<hr width="684" align="left" />

<img src="../gifs/navbar.gif" usemap="#library-map" border="0" alt="Library Navigation Links" />
<p><p><font size="-1"><a href="copyrght.htm">Copyright &copy; 2003</a> O'Reilly &amp; Associates. All rights reserved.</font></p>

<map name="library-map">
<area shape="rect" coords="1,0,88,96" href="../index.htm"><area shape="rect" coords="90,0,165,96" href="../upt/index.htm"><area shape="rect" coords="168,1,253,107" href="../mac/index.htm"><area shape="rect" coords="255,0,335,97" href="../korn/index.htm"><area shape="rect" coords="337,0,415,109" href="../unixnut/index.htm"><area shape="rect" coords="417,0,512,122" href="../sedawk/index.htm"><area shape="rect" coords="514,0,605,105" href="../lunix/index.htm"><area shape="rect" coords="611,2,694,121" href="../vi/index.htm">
</map>

</body></html>