<html><head><title>A Multiline Context grep Using sed (Unix Power Tools, 3rd Edition)</title><link rel="stylesheet" type="text/css" href="../style/style1.css" />

<meta name="DC.Creator" content="Shelley Powers, Jerry Peek, Tim O'Reilly, Mike Loukides and  " /><meta name="DC.Format" content="text/xml" scheme="MIME" /><meta name="DC.Language" content="en-US" /><meta name="DC.Publisher" content="O'Reilly &amp; Associates, Inc." /><meta name="DC.Source" scheme="ISBN" content="0-596-00330-7" /><meta name="DC.Subject.Keyword" content="stuff" /><meta name="DC.Title" content="UNIX Power Tools, 3rd Edition" /><meta name="DC.Type" content="Text.Monograph" />

</head><body bgcolor="#ffffff">

<img src="gifs/smbanner.gif" usemap="#banner-map" border="0" alt="Unix Power Tools" /><map name="banner-map"><area shape="rect" coords="1,-2,616,66" href="index.htm" alt="Unix Power Tools" /><area shape="rect" coords="629,-11,726,25" href="jobjects/fsearch.htm" alt="Search this book" /></map>

<div class="navbar"><table width="684" border="0"><tr><td align="left" valign="top" width="228"><a href="ch13_08.htm"><img src="../gifs/txtpreva.gif" alt="Previous" border="0" /></a></td><td align="center" valign="top" width="228" /><td align="right" valign="top" width="228"><a href="ch13_10.htm"><img src="../gifs/txtnexta.gif" alt="Next" border="0" /></a></td></tr></table></div>



<h2 class="sect1">13.9. A Multiline Context grep Using sed</h2>

<p><a name="IXT-13-5893" /><a name="IXT-13-5894" />[One weakness of the
<i class="command">grep</i> family of programs is that they are line
oriented. They read only one line at a time, so they
can't find patterns (such as phrases) that are split
across two lines. <b class="emphasis-bold">agrep</b> (<a href="ch13_06.htm#upt3-CHP-13-SECT-6">Section 13.6</a>) can do multiline searches. One advantage of
the <em class="filename">cgrep</em><a name="IXT-13-5895" /><a name="IXT-13-5896" />
script is that it shows how to handle
<a name="IXT-13-5897" />multiple-line patterns in
<em class="filename">sed</em> and can be adapted for work other than
searches.  -- JP]
</p>

<p><img src="figs/www.gif" alt="Figure " width="25" /> Go to <a href="http://examples.oreilly.com/upt3">http://examples.oreilly.com/upt3</a> for more information on: cgrep</p>

<p>It may surprise you to learn that a fairly decent <b class="emphasis-bold">context grep</b> (<a href="ch13_08.htm#upt3-CHP-13-SECT-8">Section 13.8</a>)
program can be built using <i class="command">sed</i>. As an example, the
following command line:
</p>

<blockquote><pre class="code">$ <tt class="userinput"><b>cgrep -10 system main.c</b></tt></pre></blockquote>

<p>will find all lines containing the word <em class="emphasis">system</em>
in the file <em class="emphasis">main.c</em> and show ten additional lines
of context above and below each match. (The
-<em class="replaceable"><tt>context</tt></em> option must be at least one, and
it defaults to two lines.) If several matches occur within the same
context, the lines are printed as one large
"hunk" rather than repeated smaller
hunks. Each new block of context is preceded by the line number of
the first occurrence in that hunk. This script, which can also search
for patterns that span lines:
</p>

<blockquote><pre class="code">$ <tt class="userinput"><b>cgrep -3 "awk.*perl"</b></tt></pre></blockquote>

<p>will find all occurrences of the word
"awk" where it is followed by the
word "perl" somewhere within the
next three lines. The pattern can be any simple regular expression,
with one notable exception: because you can match across lines, you
should use <tt class="literal">\n</tt> in place of the <tt class="literal">^</tt>
and <tt class="literal">$</tt> metacharacters.
</p>

<p>[While this is a wonderful example of some neat sed techniques, if
this is all you're trying to do, use perl. It has
features designed to do exactly this sort of thing very efficiently,
and it will be much faster.  -- DH]
</p>

<p> <em class="emphasis">-- GU</em></p>



<hr width="684" align="left" />
<div class="navbar"><table width="684" border="0"><tr><td align="left" valign="top" width="228"><a href="ch13_08.htm"><img src="../gifs/txtpreva.gif" alt="Previous" border="0" /></a></td><td align="center" valign="top" width="228"><a href="index.htm"><img src="../gifs/txthome.gif" alt="Home" border="0" /></a></td><td align="right" valign="top" width="228"><a href="ch13_10.htm"><img src="../gifs/txtnexta.gif" alt="Next" border="0" /></a></td></tr><tr><td align="left" valign="top" width="228">13.8. GNU Context greps</td><td align="center" valign="top" width="228"><a href="index/index.htm"><img src="../gifs/index.gif" alt="Book Index" border="0" /></a></td><td align="right" valign="top" width="228">13.10. Compound Searches</td></tr></table></div>
<hr width="684" align="left" />

<img src="../gifs/navbar.gif" usemap="#library-map" border="0" alt="Library Navigation Links" />
<p><p><font size="-1"><a href="copyrght.htm">Copyright &copy; 2003</a> O'Reilly &amp; Associates. All rights reserved.</font></p>

<map name="library-map">
<area shape="rect" coords="1,0,88,96" href="../index.htm"><area shape="rect" coords="90,0,165,96" href="../upt/index.htm"><area shape="rect" coords="168,1,253,107" href="../mac/index.htm"><area shape="rect" coords="255,0,335,97" href="../korn/index.htm"><area shape="rect" coords="337,0,415,109" href="../unixnut/index.htm"><area shape="rect" coords="417,0,512,122" href="../sedawk/index.htm"><area shape="rect" coords="514,0,605,105" href="../lunix/index.htm"><area shape="rect" coords="611,2,694,121" href="../vi/index.htm">
</map>

</body></html>