<html><head><title>Improvements for Editing (Learning the vi Editor, Sixth Edition)</title><link rel="stylesheet" type="text/css" href="../style/style1.css" />

<meta name="DC.Creator" content="Linda Lamb and Arnold Robbins" /><meta name="DC.Format" content="text/xml" scheme="MIME" /><meta name="DC.Language" content="en-US" /><meta name="DC.Publisher" content="O'Reilly &amp; Associates, Inc." /><meta name="DC.Source" scheme="ISBN" content="1-56592-426-6" /><meta name="DC.Subject.Keyword" content="stuff" /><meta name="DC.Title" content="Learning the vi Editor, Sixth Edition" /><meta name="DC.Type" content="Text.Monograph" />

</head><body bgcolor="#ffffff">

<img src="gifs/smbanner.gif" usemap="#banner-map" border="0" alt="Book Home" /><map name="banner-map"><area shape="rect" coords="1,-2,616,66" href="index.htm" alt="Learning the vi Editor" /><area shape="rect" coords="629,-11,726,25" href="jobjects/fsearch.htm" alt="Search this book" /></map>

<div class="navbar"><table width="684" border="0"><tr><td align="left" valign="top" width="228"><a href="ch09_07.htm"><img src="../gifs/txtpreva.gif" alt="Previous" border="0" /></a></td><td align="center" valign="top" width="228" /><td align="right" valign="top" width="228"><a href="ch09_09.htm"><img src="../gifs/txtnexta.gif" alt="Next" border="0" /></a></td></tr></table></div>



<h2 class="sect1">9.8. Improvements for Editing</h2>

<p>
<a name="ch09.facil1" />
<a name="ch09.facil2" />
<a name="ch09.facil3" />
This section describes the features of <em class="emphasis">nvi</em>
that make simple text editing easier and more powerful.</p>

<a name="vi6-ch-9-sect-7.1" /><div class="sect2">
<h3 class="sect2">9.8.1. Command-Line History and Completion</h3>

<p>
<a name="IXT-9-281336" />
<a name="IXT-9-281337" />
<a name="IXT-9-281338" />
<a name="IXT-9-281339" />
<a name="IXT-9-281340" />
<a name="IXT-9-281341" />
<a name="IXT-9-281342" />
<em class="emphasis">nvi</em> saves your <em class="emphasis">ex</em> command
lines, and makes it possible to edit them for resubmission.</p>

<p>This facility is controlled with the <tt class="literal">cedit</tt> option.</p>

<p>When you type the
first character of this string on the colon
command line, <em class="emphasis">nvi</em> opens a new window on the command
history that you can then edit. When you hit <span class="keycap">RETURN</span>
on any given line, <em class="emphasis">nvi</em> executes that line.
<span class="keycap">ESC</span> is a good choice for this option.
(Use <tt class="literal">^V ^[</tt> to enter it.)</p>

<p>Because the <span class="keycap">RETURN</span> key actually executes the
command, be careful to use either the <tt class="literal">j</tt>
or <img src="figs/U2193.gif" alt="Figure " /> keys to move down from one line to the next.</p>

<p>In addition to being able to edit your command line, you can
also do filename expansion.
This feature is controlled with the <tt class="literal">filec</tt> option.
<a name="IXT-9-281343" /></p>

<p>When you type the
first character of this string on the colon
command line, <em class="emphasis">nvi</em> treats the blank delimited word
in front of the cursor as if it had an <tt class="literal">*</tt> appended
to it and does shell-style filename expansion.
<span class="keycap">ESC</span> is also a good choice for this option.<a href="#FOOTNOTE-51">[51]</a>
(Use <tt class="literal">^V ^[</tt> to enter it.)
When this character is the same as for the <tt class="literal">cedit</tt> option,
the command-line editing is performed only when it is entered
as the first character on the colon command line.</p><blockquote class="footnote">

<a name="FOOTNOTE-51" /><p> [51]Although the <em class="emphasis">nvi</em> documentation indicates that
<span class="keycap">TAB</span> is another common choice, we could not get
that to work.
In practice, using <span class="keycap">ESC</span> for both options
works well.</p>

</blockquote>

<p>It is easiest to set these options in your <em class="filename">.nexrc</em> file:</p>

<blockquote><pre class="code">set cedit=^[
set filec=^[</pre></blockquote>
</div>




<a name="vi6-ch-9-sect-7.2" /><div class="sect2">
<h3 class="sect2">9.8.2. Tag Stacks</h3>

<p>
<a name="ch09.stack1" />
<a name="ch09.stack2" />
<a name="ch09.stack3" />
<a name="ch09.stack4" />
Tag stacking is described in <a href="ch08_05.htm#vi6-ch-8-sect-5.2">Section 8.5.3</a>.  <em class="emphasis">nvi</em>'s tag stack
is the simplest of the
four clones. <a href="ch09_08.htm#vi6-ch-9-tab-2">Table 9.2</a> and 
<a href="ch09_08.htm#vi6-ch-9-tab-3">Table 9.3</a> show the commands it uses.</p>

<a name="vi6-ch-9-tab-2" /><h4 class="objtitle">Table 9.2. nvi Tag Commands</h4><table border="1" cellpadding="3">

<tr>
<th>Command</th>
<th>Function</th>
</tr>




<tr>
<td><tt class="literal">di</tt>[<tt class="literal">splay</tt>] <tt class="literal">t</tt>[<tt class="literal">ags</tt>]</td>
<td><p>Display the tag stack.
<a name="IXT-9-281344" />
<a name="IXT-9-281345" /></p></td>
</tr>

<tr>
<td><tt class="literal">ta</tt>[<tt class="literal">g</tt>][<tt class="literal">!</tt>] <em class="replaceable"><tt>tagstring</tt></em></td>
<td><p>Edit the file containing
<em class="emphasis">tagstring</em> as defined in the <em class="filename">tags</em>
<a name="IXT-9-281346" />
file. The <tt class="literal">!</tt> forces <em class="emphasis">nvi</em> to
switch to the new file if the current buffer has been modified
but not saved.</p></td>
</tr>

<tr>
<td><tt class="literal">Ta</tt>[<tt class="literal">g</tt>][<tt class="literal">!</tt>] <em class="replaceable"><tt>tagstring</tt></em></td>
<td><p>Just like <tt class="literal">:tag</tt>,
<a name="IXT-9-281347" />
except that the file is edited in a new window.</p></td>
</tr>

<tr>
<td><tt class="literal">tagp</tt>[<tt class="literal">op</tt>][<tt class="literal">!</tt>] <em class="replaceable"><tt>tagloc</tt></em></td>
<td><p>Pop to the given tag, or to the most
<a name="IXT-9-281348" />
recently used tag if no <em class="emphasis">tagloc</em> is supplied. The
location may be either a filename of the tag of interest
or a number indicating a position in the stack.</p></td>
</tr>

<tr>
<td><tt class="literal">tagt</tt>[<tt class="literal">op</tt>][<tt class="literal">!</tt>]</td>
<td><p>Pop to the oldest tag in the stack,
<a name="IXT-9-281349" />
clearing the stack in the process.</p></td>
</tr>


</table><p><p>

<a name="vi6-ch-9-tab-3" /><h4 class="objtitle">Table 9.3. nvi Command Mode Tag Commands</h4><table border="1" cellpadding="3">

<tr>
<th>Command</th>
<th>Function</th>
</tr>




<tr>
<td><tt class="literal">^]</tt></td>
<td><p>Look up the location of the identifier
<a name="IXT-9-281350" />
under the cursor in the <em class="filename">tags</em> file, and move to that
location. The current location is automatically pushed onto the
tag stack.</p></td>
</tr>

<tr>
<td><tt class="literal">^T</tt></td>
<td><p>Return to the previous location
in the tag stack, i.e., pop off one element.
<a name="IXT-9-281351" /></p></td>
</tr>


</table><p><p>

<p>
<a name="IXT-9-281352" />
You can set the <tt class="literal">tags</tt> option to a list of file names
where <em class="emphasis">nvi</em> should look for a tag. This provides a
simplistic search path mechanism. The default value is
<tt class="literal">"tags /var/db/libc.tags /sys/kern/tags"</tt>, which on a
4.4<em class="emphasis">BSD</em> system looks in the current
directory, and then in the files for the C library and the
operating system source code.</p>

<p>
<a name="IXT-9-281353" />
The <tt class="literal">taglength</tt> option controls how many
characters in a tagstring are significant. The default value of
zero means to use all the characters.</p>

<p><em class="emphasis">nvi</em> behaves like <em class="emphasis">vi</em>; it uses
the "word"
under the cursor starting at the current cursor position.
If your cursor is on the <em class="emphasis">i</em> in <em class="emphasis">main</em>,
<em class="emphasis">nvi</em> will search for the identifier <em class="emphasis">in</em>,
not <em class="emphasis">main</em>.</p>

<p>
<a name="IXT-9-281354" />
<em class="emphasis">nvi</em> relies on the traditional <em class="filename">tags</em>
file format. Unfortunately, this format is very limited.
In particular, it has no concept of programming language
<em class="emphasis">scope</em>,
which allows the same identifier to be used in different contexts to
mean different things.
The problem is exacerbated by C++, which explicitly allows function
name <em class="emphasis">overloading</em>, i.e., the use of the same name
for different functions.</p>

<p><em class="emphasis">nvi</em> gets around the <em class="filename">tags</em> file
limitations by using a different mechanism entirely: the
<a name="IXT-9-281355" />
<em class="emphasis">cscope</em> program.
<em class="emphasis">cscope</em> is a proprietary but relatively
inexpensive program available from
the Bell Labs Software Toolchest.
It reads C source files and builds a database
describing the program. <em class="emphasis">nvi</em> provides commands that
query the database and allow you to process the results.
Because <em class="emphasis">cscope</em> is not universally available,
we do not cover its use here.
Details of the <em class="emphasis">nvi</em> commands
are provided in the <em class="emphasis">nvi</em> documentation.</p>

<p>
<a name="IXT-9-281356" />
<a name="IXT-9-281357" />
<a name="IXT-9-281358" />
The extended <em class="filename">tags</em> file format produced by
Exuberant <em class="emphasis">ctags</em> does not produce any errors with
<em class="emphasis">nvi</em> 1.79; however, <em class="emphasis">nvi</em> does
not take advantage of this format either.</p>

<a name="IXT-9-281359" />
<a name="IXT-9-281360" />
<a name="IXT-9-281361" />
<a name="IXT-9-281362" />
</div>




<a name="vi6-ch-9-sect-7.3" /><div class="sect2">
<h3 class="sect2">9.8.3. Infinite Undo</h3>

<p>
<a name="IXT-9-281363" />
<a name="IXT-9-281364" />
<a name="IXT-9-281365" />
<a name="IXT-9-281366" />
In <em class="emphasis">vi</em>, the dot (<tt class="literal">.</tt>) command generally
acts as the "do again" command; it repeats the last
editing action you performed, be it a deletion, insertion, or
replacement.</p>

<p><em class="emphasis">nvi</em> generalizes the dot command
into a full "redo" command, applying it even if the
last command was <tt class="literal">u</tt> for "undo."</p>

<p>Thus, to begin a series of "undo" commands, first type a
<tt class="literal">u</tt>.  Then, for each <tt class="literal">.</tt> (dot) that you
type, <em class="emphasis">nvi</em> will continue to undo changes, moving
the file progressively closer to its original state.</p>

<p>Eventually, you will reach the initial state of your file. At
that point, typing <tt class="literal">.</tt> will just ring the bell
(or flash the screen). You can now begin redoing by typing
<tt class="literal">u</tt> to "undo the undos" and then
using <tt class="literal">.</tt> to reapply successive changes.
</p>

<p><em class="emphasis">nvi</em> does not allow you to provide a count to either
the <tt class="literal">u</tt> or <tt class="literal">.</tt> command.</p>


</div>




<a name="vi6-ch-9-sect-7.4" /><div class="sect2">
<h3 class="sect2">9.8.4. Arbitrary Length Lines and Binary Data</h3>

<p>
<a name="IXT-9-281367" />
<a name="IXT-9-281368" />
<a name="IXT-9-281369" />
<a name="IXT-9-281370" />
<a name="IXT-9-281371" />
<em class="emphasis">nvi</em> can edit files with arbitrary length
lines and with an arbitrary number of lines.</p>

<p><em class="emphasis">nvi</em> automatically handles binary data.
No special command-line options
or <em class="emphasis">ex</em> options are required.
You use <tt class="literal">^X</tt> followed by one or two
hexadecimal digits to enter any 8-bit character into your file.</p>
</div>




<a name="vi6-ch-9-sect-7.5" /><div class="sect2">
<h3 class="sect2">9.8.5. Incremental Searching</h3>

<p>
<a name="IXT-9-281372" />
<a name="IXT-9-281373" />
<a name="IXT-9-281374" />
<a name="IXT-9-281375" />
As mentioned in
<a href="ch08_06.htm#vi6-ch-8-sect-6.4">Section 8.6.4</a>,
you enable
incremental searching in <em class="emphasis">nvi</em> using
<tt class="literal">:set searchincr</tt>.</p>

<p>The cursor moves through the
file as you type, always being placed on the first character of
the text that matches.</p>
</div>




<a name="vi6-ch-9-sect-7.6" /><div class="sect2">
<h3 class="sect2">9.8.6. Left-Right Scrolling</h3>

<p>
<a name="IXT-9-281376" />
<a name="IXT-9-281377" />
<a name="IXT-9-281378" />
<a name="IXT-9-281379" />
<a name="IXT-9-281380" />
<a name="IXT-9-281381" />
As mentioned in
<a href="ch08_06.htm#vi6-ch-8-sect-6.5">Section 8.6.5</a>,
you enable
left-right scrolling in <em class="emphasis">nvi</em> using
<a name="IXT-9-281382" />
<a name="IXT-9-281383" />
<tt class="literal">:set leftright</tt>. The value of
<tt class="literal">sidescroll</tt> controls the number of characters
by which <em class="emphasis">nvi</em> shifts the screen when scrolling
left to right.</p>
</div>




<a name="IXT-9-281384" />
<a name="IXT-9-281385" />
<a name="IXT-9-281386" />


<hr width="684" align="left" />
<div class="navbar"><table width="684" border="0"><tr><td align="left" valign="top" width="228"><a href="ch09_07.htm"><img src="../gifs/txtpreva.gif" alt="Previous" border="0" /></a></td><td align="center" valign="top" width="228"><a href="index.htm"><img src="../gifs/txthome.gif" alt="Home" border="0" /></a></td><td align="right" valign="top" width="228"><a href="ch09_09.htm"><img src="../gifs/txtnexta.gif" alt="Next" border="0" /></a></td></tr><tr><td align="left" valign="top" width="228">9.7. Extended Regular Expressions</td><td align="center" valign="top" width="228"><a href="index/index.htm"><img src="../gifs/index.gif" alt="Book Index" border="0" /></a></td><td align="right" valign="top" width="228">9.9. Programming Assistance</td></tr></table></div>
<hr width="684" align="left" />

<img src="../gifs/navbar.gif" usemap="#library-map" border="0" alt="Library Navigation Links" />
<p><p><font size="-1"><a href="copyrght.htm">Copyright &copy; 2003</a> O'Reilly &amp; Associates. All rights reserved.</font></p>

<map name="library-map">
<area shape="rect" coords="1,0,88,96" href="../index.htm"><area shape="rect" coords="90,0,165,96" href="../upt/index.htm"><area shape="rect" coords="168,1,253,107" href="../mac/index.htm"><area shape="rect" coords="255,0,335,97" href="../korn/index.htm"><area shape="rect" coords="337,0,415,109" href="../unixnut/index.htm"><area shape="rect" coords="417,0,512,122" href="../sedawk/index.htm"><area shape="rect" coords="514,0,605,105" href="../lunix/index.htm"><area shape="rect" coords="611,2,694,121" href="../vi/index.htm">
</map>

</body></html>