<html><head><title>Improved Editing Facilities (Learning the vi Editor, Sixth Edition)</title><link rel="stylesheet" type="text/css" href="../style/style1.css" />

<meta name="DC.Creator" content="Linda Lamb and Arnold Robbins" /><meta name="DC.Format" content="text/xml" scheme="MIME" /><meta name="DC.Language" content="en-US" /><meta name="DC.Publisher" content="O'Reilly &amp; Associates, Inc." /><meta name="DC.Source" scheme="ISBN" content="1-56592-426-6" /><meta name="DC.Subject.Keyword" content="stuff" /><meta name="DC.Title" content="Learning the vi Editor, Sixth Edition" /><meta name="DC.Type" content="Text.Monograph" />

</head><body bgcolor="#ffffff">

<img src="gifs/smbanner.gif" usemap="#banner-map" border="0" alt="Book Home" /><map name="banner-map"><area shape="rect" coords="1,-2,616,66" href="index.htm" alt="Learning the vi Editor" /><area shape="rect" coords="629,-11,726,25" href="jobjects/fsearch.htm" alt="Search this book" /></map>

<div class="navbar"><table width="684" border="0"><tr><td align="left" valign="top" width="228"><a href="ch10_07.htm"><img src="../gifs/txtpreva.gif" alt="Previous" border="0" /></a></td><td align="center" valign="top" width="228" /><td align="right" valign="top" width="228"><a href="ch10_09.htm"><img src="../gifs/txtnexta.gif" alt="Next" border="0" /></a></td></tr></table></div>



<h2 class="sect1">10.8. Improved Editing Facilities</h2>

<p>
<a name="ch10.facil1" />
<a name="ch10.facil2" />
<a name="ch10.facil3" />
This section describes the features of <em class="emphasis">elvis</em>
that make simple text editing easier and more powerful.</p>

<a name="vi6-ch-10-sect-8.1" /><div class="sect2">
<h3 class="sect2">10.8.1. Command-Line History and Completion</h3>

<p>
<a name="IXT-10-281492" />
<a name="IXT-10-281493" />
<a name="IXT-10-281494" />
<a name="IXT-10-281495" />
<a name="IXT-10-281496" />
<a name="IXT-10-281497" />
<a name="IXT-10-281498" />
<a name="IXT-10-281499" />
Everything you type on the <em class="emphasis">ex</em> command line is
saved in a buffer named <tt class="literal">Elvis ex history</tt>.
This is accessible like any other <em class="emphasis">elvis</em> buffer,
but is not directly useful when just viewed in a window.</p>

<p>In order to access the history, you use the arrow keys
on your terminal to display previous commands and to edit them.
Use <img src="figs/U2191.gif" alt="Figure " /> and <img src="figs/U2193.gif" alt="Figure " /> to page through the list, and <img src="figs/U2190.gif" alt="Figure " /> and <img src="figs/U2192.gif" alt="Figure " /> to
move around on a command line. You can insert characters by typing
and erase them by backspacing over them.
Much as when editing in a regular <em class="emphasis">vi</em> buffer,
the backspace does remove the characters, but the
line is not updated as you type, so be careful!</p>

<p>When entering text into the <tt class="literal">Elvis ex history</tt>
buffer (i.e., on the colon command line), the <span class="keycap">TAB</span>
key can be used for filename expansion.
The preceding word is assumed to be a partial filename,
and <em class="emphasis">elvis</em> searches
for all matching files.
If there are multiple matches, it fills in as many characters of the
name as possible, and then beeps;
or, if no additional characters are implied by the matching filenames,
<em class="emphasis">elvis</em> lists all matching names and
redisplays the command line.
If there is a single match, <em class="emphasis">elvis</em>
completes the name and appends a tab character.
If there are no matches,
<em class="emphasis">elvis</em> simply inserts a tab character.</p>

<p>To get a real tab character, precede it with a <tt class="literal">^V</tt>.
You can also disable filename completion entirely by setting the
<a name="IXT-10-281500" />
<tt class="literal">Elvis ex history</tt> buffer's
<tt class="literal">inputtab</tt>
option to <tt class="literal">tab</tt>, via the following command:</p>

<blockquote><pre class="code">:(Elvis ex history)set inputtab=tab</pre></blockquote>
</div>




<a name="vi6-ch-10-sect-8.2" /><div class="sect2">
<h3 class="sect2">10.8.2. Tag Stacks</h3>

<p>
<a name="IXT-10-281501" />
<a name="IXT-10-281502" />
<a name="IXT-10-281503" />
<a name="IXT-10-281504" />
Tag stacking is described in <a href="ch08_05.htm#vi6-ch-8-sect-5.2">Section 8.5.3</a>. In <em class="emphasis">elvis</em>, tag stacking is very straightforward, 
as shown in <a href="ch10_08.htm#vi6-ch-10-tab-5">Table 10.5</a> and 
<a href="ch10_08.htm#vi6-ch-10-tab-6">Table 10.6</a>.</p>

<a name="vi6-ch-10-tab-5" /><h4 class="objtitle">Table 10.5. elvis Tag Commands</h4><table border="1" cellpadding="3">

<tr>
<th>Command</th>
<th>Function</th>
</tr>




<tr>
<td><tt class="literal">ta</tt>[<tt class="literal">g</tt>][<tt class="literal">!</tt>] [<em class="replaceable"><tt>tagstring</tt></em>]</td>
<td><p><em class="emphasis" />Edit the file containing
<em class="emphasis">tagstring</em> as defined in the <em class="filename">tags</em>
<a name="IXT-10-281505" />
file. The <tt class="literal">!</tt> forces <em class="emphasis">elvis</em> to
switch to the new file if the current buffer has been modified
but not saved.</p></td>
</tr>

<tr>
<td><tt class="literal">stac</tt>[<tt class="literal">k</tt>]</td>
<td><p><em class="emphasis" />Display the current
<a name="IXT-10-281506" />
tag stack.</p></td>
</tr>

<tr>
<td><tt class="literal">po</tt>[<tt class="literal">p</tt>][<tt class="literal">!</tt>]</td>
<td><p><em class="emphasis" />Pop a cursor position off the stack,
<a name="IXT-10-281507" />
restoring the cursor to its previous position.</p></td>
</tr>


</table><p>

<a name="vi6-ch-10-tab-6" /><h4 class="objtitle">Table 10.6. elvis Command Mode Tag Commands</h4><table border="1" cellpadding="3">

<tr>
<th>Command</th>
<th>Function</th>
</tr>




<tr>
<td><tt class="literal">^]</tt></td>
<td><p><em class="emphasis" />Look up the location of the identifier
<a name="IXT-10-281508" />
under the cursor in the <em class="filename">tags</em> file, and move to that
location. The current location is automatically pushed onto the
tag stack.</p></td>
</tr>

<tr>
<td><tt class="literal">^T</tt></td>
<td><p><em class="emphasis" />Return to the previous location
<a name="IXT-10-281509" />
in the tag stack, i.e., pop off one element.</p></td>
</tr>


</table><p>

<p>Unlike traditional <em class="emphasis">vi</em>,
when you type <tt class="literal">^]</tt>,
<em class="emphasis">elvis</em>
looks up the entire word
containing the cursor, not just the part of the word from the
cursor location forward.</p>

<p>
<a name="IXT-10-281510" />
In HTML mode (discussed in
<a href="ch10_10.htm#vi6-ch-10-sect-10.1">Section 10.10.1</a>),
the commands all work the same except that <tt class="literal">:tag</tt> expects to
be given a URL instead of a tag name.
URLs don't depend on having a <em class="filename">tags</em> file,
so the <em class="filename">tags</em> file is ignored
when in HTML mode.
<em class="emphasis">elvis</em> 2.0
doesn't support any network protocols,<a href="#FOOTNOTE-54">[54]</a>
so its URLs can only consist
of a file name and/or an HTML <tt class="literal">#label</tt>.</p><blockquote class="footnote">

<a name="FOOTNOTE-54" /><p> [54]This is no longer true in <em class="emphasis">elvis</em> 2.1; see
<a href="ch10_11.htm#vi6-ch-10-sect-11">Section 10.11</a>
for details.</p>

</blockquote>

<p>Several <tt class="literal">:set</tt> options affect how <em class="emphasis">elvis</em>
works with tags, as described in
<a href="ch10_08.htm#vi6-ch-10-tab-7">Table 10.7</a>.</p>

<a name="vi6-ch-10-tab-7" /><h4 class="objtitle">Table 10.7. elvis Options for Tag Management</h4><table border="1" cellpadding="3">

<tr>
<th>Option</th>
<th>Function</th>
</tr>




<tr>
<td><tt class="literal">taglength</tt>, <tt class="literal">tl</tt></td>
<td><p><em class="emphasis" />Control the number of significant
<a name="IXT-10-281511" />
<a name="IXT-10-281512" />
characters in a tag
that is to be looked up. The default value of zero indicates that all
characters are significant.</p></td>
</tr>

<tr>
<td><tt class="literal">tags</tt>, <tt class="literal">tagpath</tt></td>
<td><p><em class="emphasis" />The value is a list of directory
<a name="IXT-10-281513" />
<a name="IXT-10-281514" />
and/or filenames in which to look for <em class="filename">tags</em> files.
<em class="emphasis">elvis</em> looks for a file named <em class="filename">tags</em>
in any entry that is a directory.
Entries in the list are colon-separated (or semicolon on DOS/Windows),
in order to allow spaces in directory names.
The default value is just
<tt class="literal">"tags"</tt>, which looks for a file named
<em class="filename">tags</em> in the current directory.
This can be overridden by setting the <tt class="literal">TAGPATH</tt>
environment variable.</p></td>
</tr>

<tr>
<td><tt class="literal">tagstack</tt></td>
<td><p><em class="emphasis" />When set to true,
<em class="emphasis">elvis</em> stacks each location on the tag stack.
<a name="IXT-10-281515" />
<a name="IXT-10-281516" />
Use <tt class="literal">:set notagstack</tt> to disable tag stacking.</p></td>
</tr>


</table><p>

<p>
<a name="IXT-10-281517" />
<a name="IXT-10-281518" />
<a name="IXT-10-281519" />
Version 2.1 of <em class="emphasis">elvis</em> (in beta test as of this
writing) supports the extended <em class="filename">tags</em> file
format described earlier.  <em class="emphasis">elvis</em> comes with its
own version of <em class="emphasis">ctags</em>. The version in
<em class="emphasis">elvis</em> 2.1 generates the enhanced format described
earlier. Here is an example of the special <tt class="literal">!_TAG_</tt>
lines it produces:</p>

<blockquote><pre class="code">!_TAG_FILE_FORMAT       2       /supported features/
!_TAG_FILE_SORTED       1       /0=unsorted, 1=sorted/
!_TAG_PROGRAM_AUTHOR    Steve Kirkendall        /kirkenda@cs.pdx.edu/
!_TAG_PROGRAM_NAME      Elvis Ctags     //
!_TAG_PROGRAM_URL       ftp://ftp.cs.pdx.edu/pub/elvis/README.html  //
!_TAG_PROGRAM_VERSION   2.1     //</pre></blockquote>

<p>Finally, in <em class="emphasis">elvis</em>, each window has its own
tag stack.</p>
</div>




<a name="vi6-ch-10-sect-8.3" /><div class="sect2">
<h3 class="sect2">10.8.3. Infinite Undo</h3>

<p>
<a name="IXT-10-281520" />
<a name="IXT-10-281521" />
With <em class="emphasis">elvis</em>,
before being able to undo and redo multiple levels of changes,
<a name="IXT-10-281522" />
you must first set the <tt class="literal">undolevels</tt> option to
the number of levels of "undo" that <em class="emphasis">elvis</em>
should allow.
A negative value disallows <em class="emphasis">any</em> undoing (which is
not terribly useful).
The <em class="emphasis">elvis</em> documentation warns that each level of undo
uses around 6K bytes of the session file (the file that describes
your editing session), and thus can eat up disk space rather quickly.
It recommends not setting <tt class="literal">undolevels</tt> any
higher than 100 and "probably much lower."</p>

<p>Once you've set <tt class="literal">undolevels</tt> to a non-zero
value, you enter text as normal. Then each successive <tt class="literal">u</tt>
command undoes one change.
To redo (undo the undo), you use the
(rather mnemonic) <span class="keycap">CTRL-R</span> command.</p>

<p>In <em class="emphasis">elvis</em>,
the default value of <tt class="literal">undolevels</tt>
is zero, which causes <em class="emphasis">elvis</em> to
mimic UNIX <em class="emphasis">vi</em>.
The option applies per buffer being edited; see
<a href="ch10_04.htm#vi6-ch-10-sect-4.2">Section 10.4.2</a>
for a description
of how to set it for every file that you edit.</p>

<p>Once <tt class="literal">undolevels</tt> has been set, a count to either
the <tt class="literal">u</tt> or <tt class="literal">^R</tt> commands undoes or
redoes the given number of changes.</p>
</div>




<a name="vi6-ch-10-sect-8.4" /><div class="sect2">
<h3 class="sect2">10.8.4. Arbitrary Length Lines and Binary Data</h3>

<p>
<a name="IXT-10-281523" />
<a name="IXT-10-281524" />
<a name="IXT-10-281525" />
<a name="IXT-10-281526" />
<a name="IXT-10-281527" />
<em class="emphasis">elvis</em> can edit files with arbitrary length
lines, and with an arbitrary number of lines.</p>

<p>Under UNIX, <em class="emphasis">elvis</em>
does not treat a binary file differently from any other file.
On other systems, it uses the <em class="filename">elvis.brf</em>
<a name="IXT-10-281528" />
<a name="IXT-10-281529" />
file to set the <tt class="literal">binary</tt> option.
This avoids newline translation issues.
You can enter eight-bit text by typing <tt class="literal">^X</tt>
followed by two hexadecimal digits.
<a name="IXT-10-281530" />
Using the <tt class="literal">hex</tt> display mode is an excellent
way to edit binary files.
(The <em class="filename">elvis.brf</em> file and the <tt class="literal">hex</tt>
display mode are described in
<a href="ch10_10.htm#vi6-ch-10-sect-10">Section 10.10</a>.)</p>


</div>




<a name="vi6-ch-10-sect-8.5" /><div class="sect2">
<h3 class="sect2">10.8.5. Left-Right Scrolling</h3>

<p>
<a name="IXT-10-281531" />
<a name="IXT-10-281532" />
<a name="IXT-10-281533" />
<a name="IXT-10-281534" />
<a name="IXT-10-281535" />
<a name="IXT-10-281536" />
As mentioned in
<a href="ch08_06.htm#vi6-ch-8-sect-6.4">Section 8.6.4</a>,
you enable
left-right scrolling in <em class="emphasis">elvis</em> using
<a name="IXT-10-281537" />
<a name="IXT-10-281538" />
<tt class="literal">:set nowrap</tt>. The value of
<tt class="literal">sidescroll</tt> controls the number of characters
by which <em class="emphasis">elvis</em> shifts the screen when scrolling
left to right.
The <tt class="literal">^W S</tt> command toggles the value of this option.</p>
</div>




<a name="vi6-ch-10-sect-8.6" /><div class="sect2">
<h3 class="sect2">10.8.6. Visual Mode</h3>

<p>
<a name="IXT-10-281539" />
<a name="IXT-10-281540" />
<em class="emphasis">elvis</em> allows you
to select regions one character at a time, one line at a time,
or rectangularly, using the commands shown in <a href="ch10_08.htm#vi6-ch-10-tab-8">Table 10.8</a>.</p>

<a name="vi6-ch-10-tab-8" /><h4 class="objtitle">Table 10.8. elvis Block Mode Command Characters</h4><table border="1" cellpadding="3">

<tr>
<th>Command</th>
<th>Function</th>
</tr>




<tr>
<td><tt class="literal">v</tt></td>
<td><p><em class="emphasis" />Start region selection,
<a name="IXT-10-281541" />
character at a time mode.</p></td>
</tr>

<tr>
<td><tt class="literal">V</tt></td>
<td><p><em class="emphasis" />Start region selection,
line at a time mode.</p></td>
</tr>

<tr>
<td><tt class="literal">^V</tt></td>
<td><p><em class="emphasis" />Start region selection,
<a name="IXT-10-281542" />
rectangular mode.</p></td>
</tr>


</table><p>

<p><em class="emphasis">elvis</em>
highlights (using reverse video) the text as you are selecting.
To make your selection, simply use the normal motion keys.
The screen below shows a rectangular region:</p>

<blockquote><pre class="code"><?troff .nr boxwidth \w'book into the late 19'?>
<?troff .sp -1v?>The 6th edition of &lt;citetitle&gt;Learning the vi Editor&lt;/citetitle&gt;
brings the <em class="emphasis">book into the late 19</em>90&amp;rsquo;s.
<?troff .nr boxwidth \w'ar, besides the &ldqu'?>
<?troff .sp -1v?>
In particul<em class="emphasis">ar, besides the &amp;ldqu</em>o;original&amp;rdquo; version of
<?troff .nr boxwidth \w'nncommandn that comes'?>
<?troff .sp -1v?>
&lt;command&gt;vi<em class="emphasis">&lt;/command&gt; that comes</em> as a standard part of every UNIX
<?troff .nr boxwidth \w're are now a number o'?>
<?troff .sp -2v?>
 
system, the<em class="emphasis">re are now a number o</em>f freely available &amp;ldquo;clones&amp;rdquo;
or work-alike editors.</pre></blockquote>

<p><em class="emphasis">elvis</em> only permits a few operations on selected
areas of text.
Some operations work only on whole lines,
even if you've selected a region that does not contain whole
lines (see <a href="ch10_08.htm#vi6-ch-10-tab-9">Table 10.9</a>).</p>

<a name="vi6-ch-10-tab-9" /><h4 class="objtitle">Table 10.9. elvis Block Mode Operations</h4><table border="1" cellpadding="3">

<tr>
<th>Command</th>
<th>Operation</th>
</tr>




<tr>
<td><tt class="literal">c</tt>, <tt class="literal">d</tt>, <tt class="literal">y</tt></td>
<td><p><em class="emphasis" />Change, delete, or yank text. Only
<tt class="literal">d</tt> works exactly on rectangles.</p></td>
</tr>

<tr>
<td><tt class="literal">&lt;</tt>, <tt class="literal">&gt;</tt>, <tt class="literal">!</tt></td>
<td><p><em class="emphasis" />Shift text left or right, filter
text. These operate on the whole lines
containing the marked region.</p></td>
</tr>


</table><p>

<p>After using the <tt class="literal">d</tt> command to delete the
region, the screen now looks like this:</p>

<blockquote><pre class="code">The 6th edition of &lt;citetitle&gt;Learning the vi Editor&lt;/citetitle&gt;
<u class="emphasis-underline">b</u>rings the 90&amp;rsquo;s.
In particulo;original&amp;rdquo; version of
&lt;command&gt;vi as a standard part of every
system, there are n available &amp;ldquo;clones&amp;rdquo;
or work-alike editors.</pre></blockquote>
</div>




<a name="IXT-10-281543" />
<a name="IXT-10-281544" />
<a name="IXT-10-281545" />


<hr width="684" align="left" />
<div class="navbar"><table width="684" border="0"><tr><td align="left" valign="top" width="228"><a href="ch10_07.htm"><img src="../gifs/txtpreva.gif" alt="Previous" border="0" /></a></td><td align="center" valign="top" width="228"><a href="index.htm"><img src="../gifs/txthome.gif" alt="Home" border="0" /></a></td><td align="right" valign="top" width="228"><a href="ch10_09.htm"><img src="../gifs/txtnexta.gif" alt="Next" border="0" /></a></td></tr><tr><td align="left" valign="top" width="228">10.7. Extended Regular Expressions</td><td align="center" valign="top" width="228"><a href="index/index.htm"><img src="../gifs/index.gif" alt="Book Index" border="0" /></a></td><td align="right" valign="top" width="228">10.9. Programming Assistance</td></tr></table></div>
<hr width="684" align="left" />

<img src="../gifs/navbar.gif" usemap="#library-map" border="0" alt="Library Navigation Links" />
<p><p><font size="-1"><a href="copyrght.htm">Copyright &copy; 2003</a> O'Reilly &amp; Associates. All rights reserved.</font></p>

<map name="library-map">
<area shape="rect" coords="1,0,88,96" href="../index.htm"><area shape="rect" coords="90,0,165,96" href="../upt/index.htm"><area shape="rect" coords="168,1,253,107" href="../mac/index.htm"><area shape="rect" coords="255,0,335,97" href="../korn/index.htm"><area shape="rect" coords="337,0,415,109" href="../unixnut/index.htm"><area shape="rect" coords="417,0,512,122" href="../sedawk/index.htm"><area shape="rect" coords="514,0,605,105" href="../lunix/index.htm"><area shape="rect" coords="611,2,694,121" href="../vi/index.htm">
</map>

</body></html>